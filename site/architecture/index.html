<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Production-ready MCP OAuth 2.1 server with analytics and security monitoring"><meta name=author content="raxIT AI"><link href=https://raxitai.github.io/mcp-oauth-sample/architecture/ rel=canonical><link href=../setup/ rel=prev><link href=../security/ rel=next><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.15"><title>System Design - MCP OAuth Sample Documentation</title><link rel=stylesheet href=../assets/stylesheets/main.342714a4.min.css><link rel=stylesheet href=../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../stylesheets/extra.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#mcp-oauth-21-server-architecture-documentation class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="MCP OAuth Sample Documentation" class="md-header__button md-logo" aria-label="MCP OAuth Sample Documentation" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> MCP OAuth Sample Documentation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> System Design </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media=(prefers-color-scheme) data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=blue aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=blue aria-label="Switch to system preference" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to system preference" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/raxITai/mcp-oauth-sample title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> raxITai/mcp-oauth-sample </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../setup/ class=md-tabs__link> Getting Started </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=./ class=md-tabs__link> Architecture </a> </li> <li class=md-tabs__item> <a href=../analytics/ class=md-tabs__link> Features </a> </li> <li class=md-tabs__item> <a href=../deployment/ class=md-tabs__link> Operations </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="MCP OAuth Sample Documentation" class="md-nav__button md-logo" aria-label="MCP OAuth Sample Documentation" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> MCP OAuth Sample Documentation </label> <div class=md-nav__source> <a href=https://github.com/raxITai/mcp-oauth-sample title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> raxITai/mcp-oauth-sample </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../setup/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Architecture </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Architecture </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> System Design </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> System Design </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#table-of-contents class=md-nav__link> <span class=md-ellipsis> Table of Contents </span> </a> </li> <li class=md-nav__item> <a href=#system-architecture-overview class=md-nav__link> <span class=md-ellipsis> System Architecture Overview </span> </a> <nav class=md-nav aria-label="System Architecture Overview"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#high-level-architecture class=md-nav__link> <span class=md-ellipsis> High-Level Architecture </span> </a> </li> <li class=md-nav__item> <a href=#core-design-principles class=md-nav__link> <span class=md-ellipsis> Core Design Principles </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#oauth-21-implementation-details class=md-nav__link> <span class=md-ellipsis> OAuth 2.1 Implementation Details </span> </a> <nav class=md-nav aria-label="OAuth 2.1 Implementation Details"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#oauth-21-features-implemented class=md-nav__link> <span class=md-ellipsis> OAuth 2.1 Features Implemented </span> </a> <nav class=md-nav aria-label="OAuth 2.1 Features Implemented"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#core-grant-types class=md-nav__link> <span class=md-ellipsis> Core Grant Types </span> </a> </li> <li class=md-nav__item> <a href=#security-enhancements-oauth-21 class=md-nav__link> <span class=md-ellipsis> Security Enhancements (OAuth 2.1) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#oauth-flow-diagram class=md-nav__link> <span class=md-ellipsis> OAuth Flow Diagram </span> </a> </li> <li class=md-nav__item> <a href=#pkce-implementation class=md-nav__link> <span class=md-ellipsis> PKCE Implementation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#mcp-protocol-integration class=md-nav__link> <span class=md-ellipsis> MCP Protocol Integration </span> </a> <nav class=md-nav aria-label="MCP Protocol Integration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#mcp-server-architecture class=md-nav__link> <span class=md-ellipsis> MCP Server Architecture </span> </a> <nav class=md-nav aria-label="MCP Server Architecture"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#mcp-handler-components class=md-nav__link> <span class=md-ellipsis> MCP Handler Components </span> </a> </li> <li class=md-nav__item> <a href=#authentication-middleware class=md-nav__link> <span class=md-ellipsis> Authentication Middleware </span> </a> </li> <li class=md-nav__item> <a href=#tool-implementation class=md-nav__link> <span class=md-ellipsis> Tool Implementation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#mcp-transport-support class=md-nav__link> <span class=md-ellipsis> MCP Transport Support </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#database-schema-and-models class=md-nav__link> <span class=md-ellipsis> Database Schema and Models </span> </a> <nav class=md-nav aria-label="Database Schema and Models"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#schema-overview class=md-nav__link> <span class=md-ellipsis> Schema Overview </span> </a> </li> <li class=md-nav__item> <a href=#key-design-decisions class=md-nav__link> <span class=md-ellipsis> Key Design Decisions </span> </a> </li> <li class=md-nav__item> <a href=#indexes-and-performance class=md-nav__link> <span class=md-ellipsis> Indexes and Performance </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#api-endpoints-architecture class=md-nav__link> <span class=md-ellipsis> API Endpoints Architecture </span> </a> <nav class=md-nav aria-label="API Endpoints Architecture"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#endpoint-categories class=md-nav__link> <span class=md-ellipsis> Endpoint Categories </span> </a> <nav class=md-nav aria-label="Endpoint Categories"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#oauth-21-endpoints class=md-nav__link> <span class=md-ellipsis> OAuth 2.1 Endpoints </span> </a> </li> <li class=md-nav__item> <a href=#mcp-server-endpoints class=md-nav__link> <span class=md-ellipsis> MCP Server Endpoints </span> </a> </li> <li class=md-nav__item> <a href=#analytics-endpoints class=md-nav__link> <span class=md-ellipsis> Analytics Endpoints </span> </a> </li> <li class=md-nav__item> <a href=#authentication-endpoints-nextauth class=md-nav__link> <span class=md-ellipsis> Authentication Endpoints (NextAuth) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#requestresponse-flow class=md-nav__link> <span class=md-ellipsis> Request/Response Flow </span> </a> </li> <li class=md-nav__item> <a href=#error-handling-strategy class=md-nav__link> <span class=md-ellipsis> Error Handling Strategy </span> </a> <nav class=md-nav aria-label="Error Handling Strategy"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#oauth-error-responses class=md-nav__link> <span class=md-ellipsis> OAuth Error Responses </span> </a> </li> <li class=md-nav__item> <a href=#mcp-error-responses class=md-nav__link> <span class=md-ellipsis> MCP Error Responses </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#authentication-authorization-flow class=md-nav__link> <span class=md-ellipsis> Authentication &amp; Authorization Flow </span> </a> <nav class=md-nav aria-label="Authentication & Authorization Flow"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#multi-layer-security-model class=md-nav__link> <span class=md-ellipsis> Multi-Layer Security Model </span> </a> </li> <li class=md-nav__item> <a href=#detailed-authorization-flow class=md-nav__link> <span class=md-ellipsis> Detailed Authorization Flow </span> </a> <nav class=md-nav aria-label="Detailed Authorization Flow"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-user-authentication-nextauthjs class=md-nav__link> <span class=md-ellipsis> 1. User Authentication (NextAuth.js) </span> </a> </li> <li class=md-nav__item> <a href=#2-client-authentication-oauth-21 class=md-nav__link> <span class=md-ellipsis> 2. Client Authentication (OAuth 2.1) </span> </a> </li> <li class=md-nav__item> <a href=#3-authorization-code-flow class=md-nav__link> <span class=md-ellipsis> 3. Authorization Code Flow </span> </a> </li> <li class=md-nav__item> <a href=#4-token-exchange-and-validation class=md-nav__link> <span class=md-ellipsis> 4. Token Exchange and Validation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#security-context-propagation class=md-nav__link> <span class=md-ellipsis> Security Context Propagation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#security-architecture class=md-nav__link> <span class=md-ellipsis> Security Architecture </span> </a> <nav class=md-nav aria-label="Security Architecture"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#defense-in-depth-strategy class=md-nav__link> <span class=md-ellipsis> Defense in Depth Strategy </span> </a> <nav class=md-nav aria-label="Defense in Depth Strategy"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-transport-security class=md-nav__link> <span class=md-ellipsis> 1. Transport Security </span> </a> </li> <li class=md-nav__item> <a href=#2-authentication-security class=md-nav__link> <span class=md-ellipsis> 2. Authentication Security </span> </a> </li> <li class=md-nav__item> <a href=#3-authorization-security class=md-nav__link> <span class=md-ellipsis> 3. Authorization Security </span> </a> </li> <li class=md-nav__item> <a href=#4-application-security class=md-nav__link> <span class=md-ellipsis> 4. Application Security </span> </a> </li> <li class=md-nav__item> <a href=#5-infrastructure-security class=md-nav__link> <span class=md-ellipsis> 5. Infrastructure Security </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#security-monitoring class=md-nav__link> <span class=md-ellipsis> Security Monitoring </span> </a> </li> <li class=md-nav__item> <a href=#security-event-types class=md-nav__link> <span class=md-ellipsis> Security Event Types </span> </a> </li> <li class=md-nav__item> <a href=#risk-scoring-algorithm class=md-nav__link> <span class=md-ellipsis> Risk Scoring Algorithm </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#analytics-system-design class=md-nav__link> <span class=md-ellipsis> Analytics System Design </span> </a> <nav class=md-nav aria-label="Analytics System Design"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#analytics-architecture class=md-nav__link> <span class=md-ellipsis> Analytics Architecture </span> </a> </li> <li class=md-nav__item> <a href=#performance-optimizations class=md-nav__link> <span class=md-ellipsis> Performance Optimizations </span> </a> <nav class=md-nav aria-label="Performance Optimizations"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#batched-data-collection class=md-nav__link> <span class=md-ellipsis> Batched Data Collection </span> </a> </li> <li class=md-nav__item> <a href=#efficient-database-queries class=md-nav__link> <span class=md-ellipsis> Efficient Database Queries </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#key-metrics-tracked class=md-nav__link> <span class=md-ellipsis> Key Metrics Tracked </span> </a> <nav class=md-nav aria-label="Key Metrics Tracked"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#performance-metrics class=md-nav__link> <span class=md-ellipsis> Performance Metrics </span> </a> </li> <li class=md-nav__item> <a href=#security-metrics class=md-nav__link> <span class=md-ellipsis> Security Metrics </span> </a> </li> <li class=md-nav__item> <a href=#business-metrics class=md-nav__link> <span class=md-ellipsis> Business Metrics </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#data-retention-and-cleanup class=md-nav__link> <span class=md-ellipsis> Data Retention and Cleanup </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#technology-stack class=md-nav__link> <span class=md-ellipsis> Technology Stack </span> </a> <nav class=md-nav aria-label="Technology Stack"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#core-technologies class=md-nav__link> <span class=md-ellipsis> Core Technologies </span> </a> <nav class=md-nav aria-label="Core Technologies"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#frontend-technologies class=md-nav__link> <span class=md-ellipsis> Frontend Technologies </span> </a> </li> <li class=md-nav__item> <a href=#backend-technologies class=md-nav__link> <span class=md-ellipsis> Backend Technologies </span> </a> </li> <li class=md-nav__item> <a href=#database-technologies class=md-nav__link> <span class=md-ellipsis> Database Technologies </span> </a> </li> <li class=md-nav__item> <a href=#security-technologies class=md-nav__link> <span class=md-ellipsis> Security Technologies </span> </a> </li> <li class=md-nav__item> <a href=#mcp-technologies class=md-nav__link> <span class=md-ellipsis> MCP Technologies </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#architectural-patterns class=md-nav__link> <span class=md-ellipsis> Architectural Patterns </span> </a> <nav class=md-nav aria-label="Architectural Patterns"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#design-patterns-used class=md-nav__link> <span class=md-ellipsis> Design Patterns Used </span> </a> </li> <li class=md-nav__item> <a href=#architectural-patterns_1 class=md-nav__link> <span class=md-ellipsis> Architectural Patterns </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#development-tools class=md-nav__link> <span class=md-ellipsis> Development Tools </span> </a> <nav class=md-nav aria-label="Development Tools"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#code-quality class=md-nav__link> <span class=md-ellipsis> Code Quality </span> </a> </li> <li class=md-nav__item> <a href=#testing-framework class=md-nav__link> <span class=md-ellipsis> Testing Framework </span> </a> </li> <li class=md-nav__item> <a href=#devops-tools class=md-nav__link> <span class=md-ellipsis> DevOps Tools </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#file-structure-and-organization class=md-nav__link> <span class=md-ellipsis> File Structure and Organization </span> </a> <nav class=md-nav aria-label="File Structure and Organization"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#project-structure class=md-nav__link> <span class=md-ellipsis> Project Structure </span> </a> </li> <li class=md-nav__item> <a href=#code-organization-principles class=md-nav__link> <span class=md-ellipsis> Code Organization Principles </span> </a> <nav class=md-nav aria-label="Code Organization Principles"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#separation-of-concerns class=md-nav__link> <span class=md-ellipsis> Separation of Concerns </span> </a> </li> <li class=md-nav__item> <a href=#module-boundaries class=md-nav__link> <span class=md-ellipsis> Module Boundaries </span> </a> </li> <li class=md-nav__item> <a href=#naming-conventions class=md-nav__link> <span class=md-ellipsis> Naming Conventions </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#key-files-explained class=md-nav__link> <span class=md-ellipsis> Key Files Explained </span> </a> <nav class=md-nav aria-label="Key Files Explained"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#core-configuration-files class=md-nav__link> <span class=md-ellipsis> Core Configuration Files </span> </a> </li> <li class=md-nav__item> <a href=#api-implementation-files class=md-nav__link> <span class=md-ellipsis> API Implementation Files </span> </a> </li> <li class=md-nav__item> <a href=#analytics-and-security-files class=md-nav__link> <span class=md-ellipsis> Analytics and Security Files </span> </a> </li> <li class=md-nav__item> <a href=#ui-and-dashboard-files class=md-nav__link> <span class=md-ellipsis> UI and Dashboard Files </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#development-workflow class=md-nav__link> <span class=md-ellipsis> Development Workflow </span> </a> <nav class=md-nav aria-label="Development Workflow"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#local-development-setup class=md-nav__link> <span class=md-ellipsis> Local Development Setup </span> </a> </li> <li class=md-nav__item> <a href=#production-deployment class=md-nav__link> <span class=md-ellipsis> Production Deployment </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#conclusion class=md-nav__link> <span class=md-ellipsis> Conclusion </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../security/ class=md-nav__link> <span class=md-ellipsis> Security Model </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../analytics/ class=md-nav__link> <span class=md-ellipsis> Features </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../deployment/ class=md-nav__link> <span class=md-ellipsis> Operations </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/raxITai/mcp-oauth-sample/edit/main/docs/architecture.md title="Edit this page" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"/></svg> </a> <a href=https://github.com/raxITai/mcp-oauth-sample/raw/main/docs/architecture.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5 5 5 0 0 1 5-5 5 5 0 0 1 5 5 5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5"/></svg> </a> <h1 id=mcp-oauth-21-server-architecture-documentation>MCP OAuth 2.1 Server Architecture Documentation<a class=headerlink href=#mcp-oauth-21-server-architecture-documentation title="Permanent link">&para;</a></h1> <h2 id=table-of-contents>Table of Contents<a class=headerlink href=#table-of-contents title="Permanent link">&para;</a></h2> <ol> <li><a href=#system-architecture-overview>System Architecture Overview</a></li> <li><a href=#oauth-21-implementation-details>OAuth 2.1 Implementation Details</a></li> <li><a href=#mcp-protocol-integration>MCP Protocol Integration</a></li> <li><a href=#database-schema-and-models>Database Schema and Models</a></li> <li><a href=#api-endpoints-architecture>API Endpoints Architecture</a></li> <li><a href=#authentication--authorization-flow>Authentication &amp; Authorization Flow</a></li> <li><a href=#security-architecture>Security Architecture</a></li> <li><a href=#analytics-system-design>Analytics System Design</a></li> <li><a href=#technology-stack>Technology Stack</a></li> <li><a href=#file-structure-and-organization>File Structure and Organization</a></li> </ol> <hr> <h2 id=system-architecture-overview>System Architecture Overview<a class=headerlink href=#system-architecture-overview title="Permanent link">&para;</a></h2> <p>The MCP OAuth 2.1 Server is a comprehensive authentication and authorization system designed to secure Model Context Protocol (MCP) interactions. The system implements OAuth 2.1 with PKCE (Proof Key for Code Exchange) to provide secure authentication for MCP clients while maintaining compatibility with modern security standards.</p> <h3 id=high-level-architecture>High-Level Architecture<a class=headerlink href=#high-level-architecture title="Permanent link">&para;</a></h3> <pre class=mermaid><code>graph TB
    subgraph "Client Layer"
        MC[MCP Client]
        WC[Web Client]
        API[API Client]
    end

    subgraph "Next.js Application"
        subgraph "Authentication Layer"
            NA[NextAuth.js]
            GA[Google OAuth]
        end

        subgraph "OAuth 2.1 Server"
            AR["Client Registration&lt;br/&gt;/api/oauth/register"]
            AT["Token Endpoint&lt;br/&gt;/api/oauth/token"]
            AZ["Authorization&lt;br/&gt;/oauth/authorize"]
        end

        subgraph "MCP Server"
            MH[MCP Handler]
            TL[Tool Library]
            AU[Auth Middleware]
        end

        subgraph "Analytics Engine"
            AC[Analytics Collector]
            SM[Security Monitor]
            RL[Request Logger]
        end
    end

    subgraph "Data Layer"
        PG[(PostgreSQL)]
        RD[(Redis)]
    end

    subgraph "External Services"
        GO[Google OAuth]
        GEO[IP Geolocation]
    end

    MC --&gt; MH
    WC --&gt; NA
    API --&gt; AR

    AR --&gt; PG
    AT --&gt; PG
    AZ --&gt; PG

    MH --&gt; AU
    AU --&gt; PG
    MH --&gt; TL

    NA --&gt; GA
    GA --&gt; GO

    AC --&gt; PG
    SM --&gt; PG
    RL --&gt; PG

    MH --&gt; RD
    AC --&gt; GEO</code></pre> <h3 id=core-design-principles>Core Design Principles<a class=headerlink href=#core-design-principles title="Permanent link">&para;</a></h3> <ol> <li><strong>Security-First Design</strong>: All components implement security by default with OAuth 2.1 and PKCE</li> <li><strong>Scalable Architecture</strong>: Built on Next.js with edge-ready components and efficient database queries</li> <li><strong>Comprehensive Monitoring</strong>: Full request lifecycle tracking with security event monitoring</li> <li><strong>Standards Compliance</strong>: Adheres to OAuth 2.1 RFC and MCP protocol specifications</li> <li><strong>Performance Optimization</strong>: Batched analytics, connection pooling, and efficient caching</li> </ol> <hr> <h2 id=oauth-21-implementation-details>OAuth 2.1 Implementation Details<a class=headerlink href=#oauth-21-implementation-details title="Permanent link">&para;</a></h2> <h3 id=oauth-21-features-implemented>OAuth 2.1 Features Implemented<a class=headerlink href=#oauth-21-features-implemented title="Permanent link">&para;</a></h3> <p>The system implements OAuth 2.1 as defined in <a href=https://tools.ietf.org/html/rfc6749>RFC 6749</a> with <a href=https://tools.ietf.org/html/draft-ietf-oauth-security-topics-19>OAuth 2.1 Security Best Practices</a>:</p> <h4 id=core-grant-types>Core Grant Types<a class=headerlink href=#core-grant-types title="Permanent link">&para;</a></h4> <ul> <li><strong>Authorization Code Grant with PKCE</strong>: Primary flow for MCP clients</li> <li><strong>Refresh Token Grant</strong>: Token rotation for long-lived sessions</li> <li><strong>Dynamic Client Registration</strong>: RFC 7591 compliant client registration</li> </ul> <h4 id=security-enhancements-oauth-21>Security Enhancements (OAuth 2.1)<a class=headerlink href=#security-enhancements-oauth-21 title="Permanent link">&para;</a></h4> <ul> <li><strong>Mandatory PKCE</strong>: S256 code challenge method for public clients</li> <li><strong>Refresh Token Rotation</strong>: Automatic rotation for public clients</li> <li><strong>Token Audience Validation</strong>: Prevents cross-resource token misuse</li> <li><strong>Short-lived Access Tokens</strong>: 5-minute expiry for enhanced security</li> </ul> <h3 id=oauth-flow-diagram>OAuth Flow Diagram<a class=headerlink href=#oauth-flow-diagram title="Permanent link">&para;</a></h3> <pre class=mermaid><code>sequenceDiagram
    participant C as MCP Client
    participant AS as OAuth Server
    participant RS as MCP Resource Server
    participant U as User

    Note over C,U: 1. Client Registration
    C-&gt;&gt;AS: POST /api/oauth/register
    AS-&gt;&gt;AS: Generate client_id &amp; client_secret
    AS-&gt;&gt;C: Return credentials

    Note over C,U: 2. Authorization Code Flow with PKCE
    C-&gt;&gt;C: Generate code_verifier &amp; code_challenge
    C-&gt;&gt;AS: GET /oauth/authorize?client_id=...&amp;code_challenge=...
    AS-&gt;&gt;U: Redirect to login (NextAuth)
    U-&gt;&gt;AS: Authenticate via Google OAuth
    AS-&gt;&gt;U: Show consent screen
    U-&gt;&gt;AS: Grant consent
    AS-&gt;&gt;C: Redirect with authorization code

    Note over C,U: 3. Token Exchange
    C-&gt;&gt;AS: POST /api/oauth/token with code &amp; code_verifier
    AS-&gt;&gt;AS: Verify PKCE challenge
    AS-&gt;&gt;AS: Generate access &amp; refresh tokens
    AS-&gt;&gt;C: Return tokens

    Note over C,U: 4. Resource Access
    C-&gt;&gt;RS: MCP request with Bearer token
    RS-&gt;&gt;AS: Validate token (internal)
    AS-&gt;&gt;RS: Token validation response
    RS-&gt;&gt;C: MCP response

    Note over C,U: 5. Token Refresh
    C-&gt;&gt;AS: POST /api/oauth/token with refresh_token
    AS-&gt;&gt;AS: Rotate refresh token (public clients)
    AS-&gt;&gt;C: Return new tokens</code></pre> <h3 id=pkce-implementation>PKCE Implementation<a class=headerlink href=#pkce-implementation title="Permanent link">&para;</a></h3> <p>The system implements PKCE (Proof Key for Code Exchange) as specified in <a href=https://tools.ietf.org/html/rfc7636>RFC 7636</a>:</p> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=c1>// PKCE validation in token endpoint</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>authCode</span><span class=p>.</span><span class=nx>codeChallenge</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>authCode</span><span class=p>.</span><span class=nx>codeChallengeMethod</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s1>&#39;S256&#39;</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>hash</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createHash</span><span class=p>(</span><span class=s1>&#39;sha256&#39;</span><span class=p>).</span><span class=nx>update</span><span class=p>(</span><span class=nx>code_verifier</span><span class=p>).</span><span class=nx>digest</span><span class=p>();</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>base64url</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>hash</span><span class=p>.</span><span class=nx>toString</span><span class=p>(</span><span class=s1>&#39;base64&#39;</span><span class=p>)</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=w>      </span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/\+/g</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;-&#39;</span><span class=p>)</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=w>      </span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/\//g</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;_&#39;</span><span class=p>)</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=w>      </span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/=+$/</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>);</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=w>    </span><span class=nx>pkceValid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>base64url</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=nx>authCode</span><span class=p>.</span><span class=nx>codeChallenge</span><span class=p>;</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=p>}</span>
</span></code></pre></div> <hr> <h2 id=mcp-protocol-integration>MCP Protocol Integration<a class=headerlink href=#mcp-protocol-integration title="Permanent link">&para;</a></h2> <h3 id=mcp-server-architecture>MCP Server Architecture<a class=headerlink href=#mcp-server-architecture title="Permanent link">&para;</a></h3> <p>The MCP server is implemented using the <code>@vercel/mcp-adapter</code> and provides secure access to tools and resources through OAuth 2.1 authentication.</p> <h4 id=mcp-handler-components>MCP Handler Components<a class=headerlink href=#mcp-handler-components title="Permanent link">&para;</a></h4> <pre class=mermaid><code>graph LR
    subgraph "MCP Handler"
        REQ[Request]
        AUTH[Auth Middleware]
        TOOLS[Tool Registry]
        RESP[Response]
    end

    subgraph "Tool Library"
        T1[add_numbers]
        T2[calculate_circle_area]
        T3[generate_random_number]
        T4[format_text]
        T5[check_prime_number]
        T6[trigger_security_events]
    end

    REQ --&gt; AUTH
    AUTH --&gt; TOOLS
    TOOLS --&gt; T1
    TOOLS --&gt; T2
    TOOLS --&gt; T3
    TOOLS --&gt; T4
    TOOLS --&gt; T5
    TOOLS --&gt; T6
    TOOLS --&gt; RESP</code></pre> <h4 id=authentication-middleware>Authentication Middleware<a class=headerlink href=#authentication-middleware title="Permanent link">&para;</a></h4> <p>The MCP server implements comprehensive authentication middleware:</p> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=k>async</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>authenticateRequest</span><span class=p>(</span><span class=nx>request</span><span class=o>:</span><span class=w> </span><span class=kt>NextRequest</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>authHeader</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>request</span><span class=p>.</span><span class=nx>headers</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;authorization&#39;</span><span class=p>);</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>token</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>authHeader</span><span class=o>?</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s1>&#39; &#39;</span><span class=p>)[</span><span class=mf>1</span><span class=p>];</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=w>  </span><span class=c1>// Validate token against database</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>accessToken</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>prisma</span><span class=p>.</span><span class=nx>accessToken</span><span class=p>.</span><span class=nx>findUnique</span><span class=p>({</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=w>    </span><span class=nx>where</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>token</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=w>    </span><span class=nx>include</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>client</span><span class=o>:</span><span class=w> </span><span class=kt>true</span><span class=p>,</span><span class=w> </span><span class=nx>user</span><span class=o>:</span><span class=w> </span><span class=kt>true</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=w>  </span><span class=c1>// Check expiration</span>
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>accessToken</span><span class=p>.</span><span class=nx>expiresAt</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nb>Date</span><span class=p>())</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-13><a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>null</span><span class=p>;</span>
</span><span id=__span-1-14><a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-1-15><a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a>
</span><span id=__span-1-16><a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a><span class=w>  </span><span class=c1>// Validate token audience (critical security requirement)</span>
</span><span id=__span-1-17><a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>currentResource</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=sb>`</span><span class=si>${</span><span class=nx>protocol</span><span class=si>}</span><span class=sb>://</span><span class=si>${</span><span class=nx>host</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span><span id=__span-1-18><a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>accessToken</span><span class=p>.</span><span class=nx>resource</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nx>accessToken</span><span class=p>.</span><span class=nx>resource</span><span class=w> </span><span class=o>!==</span><span class=w> </span><span class=nx>currentResource</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-19><a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>null</span><span class=p>;</span>
</span><span id=__span-1-20><a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-1-21><a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a>
</span><span id=__span-1-22><a id=__codelineno-1-22 name=__codelineno-1-22 href=#__codelineno-1-22></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>accessToken</span><span class=p>;</span>
</span><span id=__span-1-23><a id=__codelineno-1-23 name=__codelineno-1-23 href=#__codelineno-1-23></a><span class=p>}</span>
</span></code></pre></div> <h4 id=tool-implementation>Tool Implementation<a class=headerlink href=#tool-implementation title="Permanent link">&para;</a></h4> <p>Tools are implemented using Zod schema validation and provide structured responses:</p> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=nx>server</span><span class=p>.</span><span class=nx>tool</span><span class=p>(</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=w>  </span><span class=s2>&quot;add_numbers&quot;</span><span class=p>,</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=w>  </span><span class=s2>&quot;Adds two numbers together and returns the sum&quot;</span><span class=p>,</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=w>  </span><span class=p>{</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=w>    </span><span class=nx>a</span><span class=o>:</span><span class=w> </span><span class=kt>z.number</span><span class=p>().</span><span class=nx>describe</span><span class=p>(</span><span class=s2>&quot;First number to add&quot;</span><span class=p>),</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=w>    </span><span class=nx>b</span><span class=o>:</span><span class=w> </span><span class=kt>z.number</span><span class=p>().</span><span class=nx>describe</span><span class=p>(</span><span class=s2>&quot;Second number to add&quot;</span><span class=p>),</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=w>  </span><span class=k>async</span><span class=w> </span><span class=p>({</span><span class=w> </span><span class=nx>a</span><span class=p>,</span><span class=w> </span><span class=nx>b</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=w>      </span><span class=nx>content</span><span class=o>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=w>        </span><span class=p>{</span>
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a><span class=w>          </span><span class=kr>type</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;text&quot;</span><span class=p>,</span>
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a><span class=w>          </span><span class=nx>text</span><span class=o>:</span><span class=w> </span><span class=sb>`The sum of </span><span class=si>${</span><span class=nx>a</span><span class=si>}</span><span class=sb> and </span><span class=si>${</span><span class=nx>b</span><span class=si>}</span><span class=sb> is </span><span class=si>${</span><span class=nx>a</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>b</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span>
</span><span id=__span-2-14><a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-2-15><a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a><span class=w>      </span><span class=p>],</span>
</span><span id=__span-2-16><a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a><span class=w>    </span><span class=p>};</span>
</span><span id=__span-2-17><a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-2-18><a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a><span class=p>);</span>
</span></code></pre></div> <h3 id=mcp-transport-support>MCP Transport Support<a class=headerlink href=#mcp-transport-support title="Permanent link">&para;</a></h3> <p>The system supports multiple MCP transport mechanisms:</p> <ul> <li><strong>SSE Transport</strong>: <code>/mcp/sse</code> - Server-Sent Events for real-time communication</li> <li><strong>HTTP Transport</strong>: <code>/mcp/mcp</code> - Standard HTTP request/response</li> <li><strong>WebSocket Transport</strong>: Future implementation planned</li> </ul> <hr> <h2 id=database-schema-and-models>Database Schema and Models<a class=headerlink href=#database-schema-and-models title="Permanent link">&para;</a></h2> <h3 id=schema-overview>Schema Overview<a class=headerlink href=#schema-overview title="Permanent link">&para;</a></h3> <p>The database schema is designed to support both OAuth 2.1 requirements and comprehensive analytics collection:</p> <pre class=mermaid><code>erDiagram
    User {
        string id PK
        string name
        string email UK
        datetime emailVerified
        string image
    }

    Account {
        string id PK
        string userId FK
        string provider
        string providerAccountId
        string refresh_token
        string access_token
    }

    Client {
        string id PK
        string clientId UK
        string clientSecret
        string name
        string[] redirectUris
        string userId FK
        datetime createdAt
        datetime updatedAt
    }

    AccessToken {
        string id PK
        string token UK
        datetime expiresAt
        string clientId FK
        string userId FK
        string resource
        datetime createdAt
    }

    AuthCode {
        string id PK
        string code UK
        datetime expiresAt
        string clientId FK
        string userId FK
        string redirectUri
        string codeChallenge
        string codeChallengeMethod
        string resource
        datetime createdAt
    }

    RefreshToken {
        string id PK
        string token UK
        datetime expiresAt
        string clientId FK
        string userId FK
        string resource
        datetime createdAt
    }

    AnalyticsRequest {
        string id PK
        datetime timestamp
        string endpoint
        string method
        int statusCode
        int responseTime
        string clientId FK
        string userId FK
        string mcpServerId FK
        string ipAddress
        string userAgent
        string mcpMethod
        string toolName
        string oauthGrantType
        boolean usePKCE
        datetime expiresAt
    }

    AnalyticsSecurity {
        string id PK
        datetime timestamp
        SecurityEventType eventType
        string severity
        string userId FK
        string clientId FK
        string ipAddress
        string userAgent
        json details
        int riskScore
        boolean resolved
        datetime expiresAt
    }

    MCPServer {
        string id PK
        string name
        string identifier UK
        string description
        string version
        datetime createdAt
        datetime updatedAt
    }

    User ||--o{ Account : "has"
    User ||--o{ Client : "owns"
    User ||--o{ AccessToken : "has"
    User ||--o{ AuthCode : "has"
    User ||--o{ RefreshToken : "has"
    User ||--o{ AnalyticsRequest : "generates"
    User ||--o{ AnalyticsSecurity : "triggers"

    Client ||--o{ AccessToken : "issues"
    Client ||--o{ AuthCode : "issues"
    Client ||--o{ RefreshToken : "issues"
    Client ||--o{ AnalyticsRequest : "generates"
    Client ||--o{ AnalyticsSecurity : "triggers"

    MCPServer ||--o{ AnalyticsRequest : "serves"
    MCPServer ||--o{ AnalyticsSecurity : "monitors"</code></pre> <h3 id=key-design-decisions>Key Design Decisions<a class=headerlink href=#key-design-decisions title="Permanent link">&para;</a></h3> <ol> <li><strong>Separate Token Models</strong>: Distinct models for access tokens, refresh tokens, and auth codes for better security and performance</li> <li><strong>PKCE Support</strong>: Built-in code challenge and method fields in AuthCode model</li> <li><strong>Resource Audience</strong>: Token audience validation to prevent cross-resource attacks</li> <li><strong>Analytics Integration</strong>: Comprehensive request and security event tracking</li> <li><strong>TTL Management</strong>: Automatic expiration using PostgreSQL intervals</li> </ol> <h3 id=indexes-and-performance>Indexes and Performance<a class=headerlink href=#indexes-and-performance title="Permanent link">&para;</a></h3> <p>Critical indexes for optimal performance:</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=c1>-- Request analytics indexes</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_analytics_timestamp</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;AnalyticsRequest&quot;</span><span class=p>(</span><span class=k>timestamp</span><span class=p>);</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_analytics_endpoint</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;AnalyticsRequest&quot;</span><span class=p>(</span><span class=n>endpoint</span><span class=p>);</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_analytics_client_time</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;AnalyticsRequest&quot;</span><span class=p>(</span><span class=k>timestamp</span><span class=p>,</span><span class=w> </span><span class=ss>&quot;clientId&quot;</span><span class=p>);</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_analytics_user_time</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;AnalyticsRequest&quot;</span><span class=p>(</span><span class=k>timestamp</span><span class=p>,</span><span class=w> </span><span class=ss>&quot;userId&quot;</span><span class=p>);</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=c1>-- Security event indexes</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_security_timestamp</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;AnalyticsSecurity&quot;</span><span class=p>(</span><span class=k>timestamp</span><span class=p>);</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_security_event_type</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;AnalyticsSecurity&quot;</span><span class=p>(</span><span class=ss>&quot;eventType&quot;</span><span class=p>);</span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_security_risk_score</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;AnalyticsSecurity&quot;</span><span class=p>(</span><span class=ss>&quot;riskScore&quot;</span><span class=p>);</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a><span class=c1>-- OAuth token indexes</span>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a><span class=k>CREATE</span><span class=w> </span><span class=k>UNIQUE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_access_token</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;AccessToken&quot;</span><span class=p>(</span><span class=n>token</span><span class=p>);</span>
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_access_token_expiry</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;AccessToken&quot;</span><span class=p>(</span><span class=ss>&quot;expiresAt&quot;</span><span class=p>);</span>
</span><span id=__span-3-15><a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a><span class=k>CREATE</span><span class=w> </span><span class=k>UNIQUE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_refresh_token</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=ss>&quot;RefreshToken&quot;</span><span class=p>(</span><span class=n>token</span><span class=p>);</span>
</span></code></pre></div> <hr> <h2 id=api-endpoints-architecture>API Endpoints Architecture<a class=headerlink href=#api-endpoints-architecture title="Permanent link">&para;</a></h2> <h3 id=endpoint-categories>Endpoint Categories<a class=headerlink href=#endpoint-categories title="Permanent link">&para;</a></h3> <p>The API is organized into several logical categories:</p> <h4 id=oauth-21-endpoints>OAuth 2.1 Endpoints<a class=headerlink href=#oauth-21-endpoints title="Permanent link">&para;</a></h4> <table> <thead> <tr> <th>Endpoint</th> <th>Method</th> <th>Purpose</th> <th>OAuth 2.1 Spec</th> </tr> </thead> <tbody> <tr> <td><code>/api/oauth/register</code></td> <td>POST</td> <td>Dynamic client registration</td> <td>RFC 7591</td> </tr> <tr> <td><code>/api/oauth/token</code></td> <td>POST</td> <td>Token exchange and refresh</td> <td>RFC 6749</td> </tr> <tr> <td><code>/oauth/authorize</code></td> <td>GET</td> <td>Authorization endpoint</td> <td>RFC 6749</td> </tr> </tbody> </table> <h4 id=mcp-server-endpoints>MCP Server Endpoints<a class=headerlink href=#mcp-server-endpoints title="Permanent link">&para;</a></h4> <table> <thead> <tr> <th>Endpoint</th> <th>Method</th> <th>Purpose</th> <th>Transport</th> </tr> </thead> <tbody> <tr> <td><code>/mcp/sse</code></td> <td>GET/POST</td> <td>MCP over Server-Sent Events</td> <td>SSE</td> </tr> <tr> <td><code>/mcp/mcp</code></td> <td>GET/POST</td> <td>MCP over HTTP</td> <td>HTTP</td> </tr> </tbody> </table> <h4 id=analytics-endpoints>Analytics Endpoints<a class=headerlink href=#analytics-endpoints title="Permanent link">&para;</a></h4> <table> <thead> <tr> <th>Endpoint</th> <th>Method</th> <th>Purpose</th> <th>Access</th> </tr> </thead> <tbody> <tr> <td><code>/api/analytics/collect</code></td> <td>POST</td> <td>Request analytics collection</td> <td>Internal</td> </tr> <tr> <td><code>/api/analytics/security</code></td> <td>POST</td> <td>Security event logging</td> <td>Internal</td> </tr> <tr> <td><code>/api/analytics</code></td> <td>GET</td> <td>Analytics dashboard data</td> <td>Authenticated</td> </tr> </tbody> </table> <h4 id=authentication-endpoints-nextauth>Authentication Endpoints (NextAuth)<a class=headerlink href=#authentication-endpoints-nextauth title="Permanent link">&para;</a></h4> <table> <thead> <tr> <th>Endpoint</th> <th>Method</th> <th>Purpose</th> <th>Provider</th> </tr> </thead> <tbody> <tr> <td><code>/api/auth/signin</code></td> <td>GET/POST</td> <td>User authentication</td> <td>Google OAuth</td> </tr> <tr> <td><code>/api/auth/callback</code></td> <td>GET/POST</td> <td>OAuth callback</td> <td>Google OAuth</td> </tr> <tr> <td><code>/api/auth/signout</code></td> <td>POST</td> <td>User sign out</td> <td>NextAuth</td> </tr> </tbody> </table> <h3 id=requestresponse-flow>Request/Response Flow<a class=headerlink href=#requestresponse-flow title="Permanent link">&para;</a></h3> <pre class=mermaid><code>sequenceDiagram
    participant C as Client
    participant MW as Middleware
    participant EP as Endpoint
    participant DB as Database
    participant AN as Analytics

    C-&gt;&gt;MW: HTTP Request
    MW-&gt;&gt;MW: CORS handling
    MW-&gt;&gt;MW: Rate limiting
    MW-&gt;&gt;EP: Forward request
    EP-&gt;&gt;DB: Database operations
    DB-&gt;&gt;EP: Response data
    EP-&gt;&gt;AN: Log request (async)
    AN-&gt;&gt;DB: Store analytics
    EP-&gt;&gt;MW: Response
    MW-&gt;&gt;C: HTTP Response</code></pre> <h3 id=error-handling-strategy>Error Handling Strategy<a class=headerlink href=#error-handling-strategy title="Permanent link">&para;</a></h3> <p>The system implements comprehensive error handling following OAuth 2.1 specifications:</p> <h4 id=oauth-error-responses>OAuth Error Responses<a class=headerlink href=#oauth-error-responses title="Permanent link">&para;</a></h4> <div class="language-json highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=p>{</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=w>  </span><span class=nt>&quot;error&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;invalid_client&quot;</span><span class=p>,</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=w>  </span><span class=nt>&quot;error_description&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Client authentication failed&quot;</span><span class=p>,</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=w>  </span><span class=nt>&quot;error_uri&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;https://example.com/errors#invalid_client&quot;</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=p>}</span>
</span></code></pre></div> <h4 id=mcp-error-responses>MCP Error Responses<a class=headerlink href=#mcp-error-responses title="Permanent link">&para;</a></h4> <div class="language-json highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=p>{</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=w>  </span><span class=nt>&quot;jsonrpc&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;2.0&quot;</span><span class=p>,</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=w>  </span><span class=nt>&quot;id&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;request_id&quot;</span><span class=p>,</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=w>  </span><span class=nt>&quot;error&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=w>    </span><span class=nt>&quot;code&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>-32600</span><span class=p>,</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=w>    </span><span class=nt>&quot;message&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Invalid Request&quot;</span><span class=p>,</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=w>    </span><span class=nt>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nt>&quot;details&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Authentication required&quot;</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=p>}</span>
</span></code></pre></div> <hr> <h2 id=authentication-authorization-flow>Authentication &amp; Authorization Flow<a class=headerlink href=#authentication-authorization-flow title="Permanent link">&para;</a></h2> <h3 id=multi-layer-security-model>Multi-Layer Security Model<a class=headerlink href=#multi-layer-security-model title="Permanent link">&para;</a></h3> <p>The system implements a multi-layer security model combining user authentication, client authentication, and resource authorization:</p> <pre class=mermaid><code>graph TD
    subgraph "User Authentication Layer"
        UA[User Login]
        GO[Google OAuth]
        SE[Session Management]
    end

    subgraph "Client Authentication Layer"
        CR[Client Registration]
        CC[Client Credentials]
        PKCE[PKCE Verification]
    end

    subgraph "Resource Authorization Layer"
        TA[Token Validation]
        AU[Audience Validation]
        SC[Scope Checking]
    end

    subgraph "Security Monitoring Layer"
        SM[Security Monitor]
        AL[Audit Logging]
        TH[Threat Detection]
    end

    UA --&gt; GO
    GO --&gt; SE
    SE --&gt; CR
    CR --&gt; CC
    CC --&gt; PKCE
    PKCE --&gt; TA
    TA --&gt; AU
    AU --&gt; SC
    SC --&gt; SM
    SM --&gt; AL
    AL --&gt; TH</code></pre> <h3 id=detailed-authorization-flow>Detailed Authorization Flow<a class=headerlink href=#detailed-authorization-flow title="Permanent link">&para;</a></h3> <h4 id=1-user-authentication-nextauthjs>1. User Authentication (NextAuth.js)<a class=headerlink href=#1-user-authentication-nextauthjs title="Permanent link">&para;</a></h4> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=c1>// NextAuth configuration</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=k>export</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=nx>authConfig</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=w>  </span><span class=nx>adapter</span><span class=o>:</span><span class=w> </span><span class=kt>PrismaAdapter</span><span class=p>(</span><span class=nx>prisma</span><span class=p>),</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=w>  </span><span class=nx>providers</span><span class=o>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=w>    </span><span class=nx>Google</span><span class=p>({</span>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=w>      </span><span class=nx>clientId</span><span class=o>:</span><span class=w> </span><span class=kt>process.env.GOOGLE_CLIENT_ID</span><span class=o>!</span><span class=p>,</span>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=w>      </span><span class=nx>clientSecret</span><span class=o>:</span><span class=w> </span><span class=kt>process.env.GOOGLE_CLIENT_SECRET</span><span class=o>!</span><span class=p>,</span>
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=w>    </span><span class=p>}),</span>
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class=w>  </span><span class=p>],</span>
</span><span id=__span-6-10><a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=w>  </span><span class=nx>callbacks</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-11><a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a><span class=w>    </span><span class=c1>// Session and JWT callbacks for enhanced security</span>
</span><span id=__span-6-12><a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-6-13><a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a><span class=w>  </span><span class=nx>trustHost</span><span class=o>:</span><span class=w> </span><span class=kt>true</span><span class=p>,</span>
</span><span id=__span-6-14><a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a><span class=p>};</span>
</span></code></pre></div> <h4 id=2-client-authentication-oauth-21>2. Client Authentication (OAuth 2.1)<a class=headerlink href=#2-client-authentication-oauth-21 title="Permanent link">&para;</a></h4> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=c1>// Dynamic client registration</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=kd>const</span><span class=w> </span><span class=nx>newClient</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>prisma</span><span class=p>.</span><span class=nx>client</span><span class=p>.</span><span class=nx>create</span><span class=p>({</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=w>  </span><span class=nx>data</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=w>    </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=kt>client_name</span><span class=p>,</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=w>    </span><span class=nx>redirectUris</span><span class=o>:</span><span class=w> </span><span class=kt>redirect_uris</span><span class=p>,</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=w>    </span><span class=nx>clientSecret</span><span class=o>:</span><span class=w> </span><span class=kt>clientSecret</span><span class=p>,</span><span class=w> </span><span class=c1>// Hashed in production</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=w>    </span><span class=nx>userId</span><span class=o>:</span><span class=w> </span><span class=kt>null</span><span class=p>,</span><span class=w> </span><span class=c1>// Allow unauthenticated clients</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=p>});</span>
</span></code></pre></div> <h4 id=3-authorization-code-flow>3. Authorization Code Flow<a class=headerlink href=#3-authorization-code-flow title="Permanent link">&para;</a></h4> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=c1>// Authorization endpoint with PKCE</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=kd>const</span><span class=w> </span><span class=nx>authorizationCode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>randomBytes</span><span class=p>(</span><span class=mf>16</span><span class=p>).</span><span class=nx>toString</span><span class=p>(</span><span class=s1>&#39;hex&#39;</span><span class=p>);</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=k>await</span><span class=w> </span><span class=nx>prisma</span><span class=p>.</span><span class=nx>authCode</span><span class=p>.</span><span class=nx>create</span><span class=p>({</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=w>  </span><span class=nx>data</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=w>    </span><span class=nx>code</span><span class=o>:</span><span class=w> </span><span class=kt>authorizationCode</span><span class=p>,</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=w>    </span><span class=nx>expiresAt</span><span class=o>:</span><span class=w> </span><span class=kt>new</span><span class=w> </span><span class=nb>Date</span><span class=p>(</span><span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mf>10</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mf>60</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mf>1000</span><span class=p>),</span><span class=w> </span><span class=c1>// 10 minutes</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=w>    </span><span class=nx>clientId</span><span class=o>:</span><span class=w> </span><span class=kt>client.id</span><span class=p>,</span>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=w>    </span><span class=nx>userId</span><span class=o>:</span><span class=w> </span><span class=kt>session.user.id</span><span class=p>,</span>
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class=w>    </span><span class=nx>redirectUri</span><span class=o>:</span><span class=w> </span><span class=kt>redirectUri</span><span class=p>,</span>
</span><span id=__span-8-10><a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=w>    </span><span class=nx>codeChallenge</span><span class=o>:</span><span class=w> </span><span class=kt>code_challenge</span><span class=p>,</span>
</span><span id=__span-8-11><a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a><span class=w>    </span><span class=nx>codeChallengeMethod</span><span class=o>:</span><span class=w> </span><span class=kt>code_challenge_method</span><span class=p>,</span>
</span><span id=__span-8-12><a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a><span class=w>    </span><span class=nx>resource</span><span class=o>:</span><span class=w> </span><span class=kt>resource</span><span class=p>,</span>
</span><span id=__span-8-13><a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-8-14><a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a><span class=p>});</span>
</span></code></pre></div> <h4 id=4-token-exchange-and-validation>4. Token Exchange and Validation<a class=headerlink href=#4-token-exchange-and-validation title="Permanent link">&para;</a></h4> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=c1>// Token exchange with PKCE verification</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>authCode</span><span class=p>.</span><span class=nx>codeChallenge</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>authCode</span><span class=p>.</span><span class=nx>codeChallengeMethod</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s1>&#39;S256&#39;</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>hash</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createHash</span><span class=p>(</span><span class=s1>&#39;sha256&#39;</span><span class=p>).</span><span class=nx>update</span><span class=p>(</span><span class=nx>code_verifier</span><span class=p>).</span><span class=nx>digest</span><span class=p>();</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>base64url</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>hash</span><span class=p>.</span><span class=nx>toString</span><span class=p>(</span><span class=s1>&#39;base64&#39;</span><span class=p>)</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=w>      </span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/\+/g</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;-&#39;</span><span class=p>)</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=w>      </span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/\//g</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;_&#39;</span><span class=p>)</span>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=w>      </span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/=+$/</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>);</span>
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=w>    </span><span class=nx>pkceValid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>base64url</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=nx>authCode</span><span class=p>.</span><span class=nx>codeChallenge</span><span class=p>;</span>
</span><span id=__span-9-10><a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-9-11><a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a><span class=p>}</span>
</span></code></pre></div> <h3 id=security-context-propagation>Security Context Propagation<a class=headerlink href=#security-context-propagation title="Permanent link">&para;</a></h3> <p>The system maintains security context across all layers:</p> <ol> <li><strong>User Context</strong>: User identity, roles, and permissions</li> <li><strong>Client Context</strong>: Client identity, type (public/confidential), and allowed resources</li> <li><strong>Request Context</strong>: IP address, user agent, geographic location</li> <li><strong>Resource Context</strong>: Target resource, required scopes, and access policies</li> </ol> <hr> <h2 id=security-architecture>Security Architecture<a class=headerlink href=#security-architecture title="Permanent link">&para;</a></h2> <h3 id=defense-in-depth-strategy>Defense in Depth Strategy<a class=headerlink href=#defense-in-depth-strategy title="Permanent link">&para;</a></h3> <p>The system implements multiple layers of security controls:</p> <h4 id=1-transport-security>1. Transport Security<a class=headerlink href=#1-transport-security title="Permanent link">&para;</a></h4> <ul> <li><strong>HTTPS Everywhere</strong>: All communication encrypted in transit</li> <li><strong>HSTS Headers</strong>: HTTP Strict Transport Security</li> <li><strong>Certificate Pinning</strong>: For high-security deployments</li> </ul> <h4 id=2-authentication-security>2. Authentication Security<a class=headerlink href=#2-authentication-security title="Permanent link">&para;</a></h4> <ul> <li><strong>Multi-Factor Authentication</strong>: Google OAuth with optional 2FA</li> <li><strong>Session Management</strong>: Secure session handling with NextAuth.js</li> <li><strong>Token Security</strong>: Short-lived access tokens with refresh rotation</li> </ul> <h4 id=3-authorization-security>3. Authorization Security<a class=headerlink href=#3-authorization-security title="Permanent link">&para;</a></h4> <ul> <li><strong>PKCE Mandatory</strong>: Proof Key for Code Exchange for all flows</li> <li><strong>Audience Validation</strong>: Prevents token misuse across resources</li> <li><strong>Scope Enforcement</strong>: Granular permission control</li> </ul> <h4 id=4-application-security>4. Application Security<a class=headerlink href=#4-application-security title="Permanent link">&para;</a></h4> <ul> <li><strong>Input Validation</strong>: Zod schema validation for all inputs</li> <li><strong>SQL Injection Prevention</strong>: Parameterized queries with Prisma</li> <li><strong>XSS Protection</strong>: Content Security Policy and input sanitization</li> </ul> <h4 id=5-infrastructure-security>5. Infrastructure Security<a class=headerlink href=#5-infrastructure-security title="Permanent link">&para;</a></h4> <ul> <li><strong>Rate Limiting</strong>: Request throttling and abuse prevention</li> <li><strong>CORS Configuration</strong>: Secure cross-origin resource sharing</li> <li><strong>Security Headers</strong>: Comprehensive security header implementation</li> </ul> <h3 id=security-monitoring>Security Monitoring<a class=headerlink href=#security-monitoring title="Permanent link">&para;</a></h3> <pre class=mermaid><code>graph LR
    subgraph "Security Events"
        AF[Auth Failures]
        IT[Invalid Tokens]
        SA[Suspicious Activity]
        RL[Rate Limit Exceeded]
        UA[Unauthorized Access]
    end

    subgraph "Detection Engine"
        ER[Event Rules]
        RS[Risk Scoring]
        TH[Threat Hunting]
    end

    subgraph "Response Actions"
        AL[Alert Generation]
        BL[Blacklisting]
        TR[Token Revocation]
        IN[Incident Response]
    end

    AF --&gt; ER
    IT --&gt; ER
    SA --&gt; ER
    RL --&gt; ER
    UA --&gt; ER

    ER --&gt; RS
    RS --&gt; TH
    TH --&gt; AL
    TH --&gt; BL
    TH --&gt; TR
    TH --&gt; IN</code></pre> <h3 id=security-event-types>Security Event Types<a class=headerlink href=#security-event-types title="Permanent link">&para;</a></h3> <p>The system monitors and responds to various security events:</p> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=kd>enum</span><span class=w> </span><span class=nx>SecurityEventType</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=w>  </span><span class=nx>AUTH_FAILURE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;AUTH_FAILURE&quot;</span><span class=p>,</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=w>  </span><span class=nx>INVALID_TOKEN</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;INVALID_TOKEN&quot;</span><span class=p>,</span><span class=w> </span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=w>  </span><span class=nx>SUSPICIOUS_ACTIVITY</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;SUSPICIOUS_ACTIVITY&quot;</span><span class=p>,</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=w>  </span><span class=nx>RATE_LIMIT_EXCEEDED</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;RATE_LIMIT_EXCEEDED&quot;</span><span class=p>,</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=w>  </span><span class=nx>UNAUTHORIZED_ACCESS</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;UNAUTHORIZED_ACCESS&quot;</span><span class=p>,</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=w>  </span><span class=nx>TOKEN_REUSE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;TOKEN_REUSE&quot;</span><span class=p>,</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=w>  </span><span class=nx>UNUSUAL_LOCATION</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;UNUSUAL_LOCATION&quot;</span><span class=p>,</span>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=w>  </span><span class=nx>PRIVILEGE_ESCALATION</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;PRIVILEGE_ESCALATION&quot;</span><span class=p>,</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=w>  </span><span class=nx>MALFORMED_REQUEST</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;MALFORMED_REQUEST&quot;</span><span class=p>,</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=w>  </span><span class=nx>BRUTE_FORCE_ATTEMPT</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;BRUTE_FORCE_ATTEMPT&quot;</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=p>}</span>
</span></code></pre></div> <h3 id=risk-scoring-algorithm>Risk Scoring Algorithm<a class=headerlink href=#risk-scoring-algorithm title="Permanent link">&para;</a></h3> <p>Security events are scored based on multiple factors:</p> <ol> <li><strong>Event Severity</strong>: Critical, High, Medium, Low</li> <li><strong>User Risk Profile</strong>: Historical behavior, privilege level</li> <li><strong>Client Risk Profile</strong>: Client type, registration age, usage patterns</li> <li><strong>Context Risk</strong>: Geographic location, time of day, device fingerprint</li> <li><strong>Behavioral Analysis</strong>: Deviation from normal patterns</li> </ol> <hr> <h2 id=analytics-system-design>Analytics System Design<a class=headerlink href=#analytics-system-design title="Permanent link">&para;</a></h2> <h3 id=analytics-architecture>Analytics Architecture<a class=headerlink href=#analytics-architecture title="Permanent link">&para;</a></h3> <p>The analytics system is designed for high-performance data collection and real-time analysis:</p> <pre class=mermaid><code>graph TB
    subgraph "Data Collection Layer"
        RC[Request Collector]
        SC[Security Collector]
        BC[Batch Processor]
    end

    subgraph "Data Processing Layer"
        AE[Analytics Engine]
        GE[Geography Enricher]
        RS[Risk Scorer]
    end

    subgraph "Data Storage Layer"
        PG[(PostgreSQL)]
        TS[(Time Series)]
        CH[(ClickHouse)]
    end

    subgraph "Analysis Layer"
        RT[Real-time Analytics]
        BA[Batch Analytics]
        ML[Machine Learning]
    end

    subgraph "Presentation Layer"
        DB[Dashboard]
        AL[Alerts]
        RP[Reports]
    end

    RC --&gt; BC
    SC --&gt; BC
    BC --&gt; AE
    AE --&gt; GE
    AE --&gt; RS
    GE --&gt; PG
    RS --&gt; PG

    PG --&gt; RT
    PG --&gt; BA
    BA --&gt; ML

    RT --&gt; DB
    RT --&gt; AL
    BA --&gt; RP
    ML --&gt; AL</code></pre> <h3 id=performance-optimizations>Performance Optimizations<a class=headerlink href=#performance-optimizations title="Permanent link">&para;</a></h3> <h4 id=batched-data-collection>Batched Data Collection<a class=headerlink href=#batched-data-collection title="Permanent link">&para;</a></h4> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=kd>class</span><span class=w> </span><span class=nx>OptimizedAnalyticsCollector</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=w>  </span><span class=k>private</span><span class=w> </span><span class=nx>requestBatch</span><span class=o>:</span><span class=w> </span><span class=kt>RequestAnalytics</span><span class=p>[]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[];</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=w>  </span><span class=k>private</span><span class=w> </span><span class=k>readonly</span><span class=w> </span><span class=nx>BATCH_SIZE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>100</span><span class=p>;</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=w>  </span><span class=k>private</span><span class=w> </span><span class=k>readonly</span><span class=w> </span><span class=nx>FLUSH_INTERVAL</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>15000</span><span class=p>;</span><span class=w> </span><span class=c1>// 15 seconds</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=w>  </span><span class=k>async</span><span class=w> </span><span class=nx>logRequest</span><span class=p>(</span><span class=nx>data</span><span class=o>:</span><span class=w> </span><span class=kt>RequestAnalytics</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=w>    </span><span class=k>this</span><span class=p>.</span><span class=nx>requestBatch</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>data</span><span class=p>);</span>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a>
</span><span id=__span-11-9><a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>requestBatch</span><span class=p>.</span><span class=nx>length</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=nx>BATCH_SIZE</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-11-10><a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a><span class=w>      </span><span class=k>await</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=nx>flushRequests</span><span class=p>();</span>
</span><span id=__span-11-11><a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-11-12><a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-11-13><a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a>
</span><span id=__span-11-14><a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a><span class=w>  </span><span class=k>private</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=nx>flushRequests</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-11-15><a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a><span class=w>    </span><span class=k>await</span><span class=w> </span><span class=nx>prisma</span><span class=p>.</span><span class=nx>$transaction</span><span class=p>(</span><span class=k>async</span><span class=w> </span><span class=p>(</span><span class=nx>tx</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-11-16><a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a><span class=w>      </span><span class=k>await</span><span class=w> </span><span class=nx>tx</span><span class=p>.</span><span class=nx>analyticsRequest</span><span class=p>.</span><span class=nx>createMany</span><span class=p>({</span>
</span><span id=__span-11-17><a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a><span class=w>        </span><span class=nx>data</span><span class=o>:</span><span class=w> </span><span class=kt>this.requestBatch.map</span><span class=p>(</span><span class=nx>req</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>({...</span><span class=nx>req</span><span class=p>})),</span>
</span><span id=__span-11-18><a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a><span class=w>        </span><span class=nx>skipDuplicates</span><span class=o>:</span><span class=w> </span><span class=kt>true</span>
</span><span id=__span-11-19><a id=__codelineno-11-19 name=__codelineno-11-19 href=#__codelineno-11-19></a><span class=w>      </span><span class=p>});</span>
</span><span id=__span-11-20><a id=__codelineno-11-20 name=__codelineno-11-20 href=#__codelineno-11-20></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-11-21><a id=__codelineno-11-21 name=__codelineno-11-21 href=#__codelineno-11-21></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-11-22><a id=__codelineno-11-22 name=__codelineno-11-22 href=#__codelineno-11-22></a><span class=p>}</span>
</span></code></pre></div> <h4 id=efficient-database-queries>Efficient Database Queries<a class=headerlink href=#efficient-database-queries title="Permanent link">&para;</a></h4> <div class="language-sql highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=c1>-- Optimized performance metrics query</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=k>SELECT</span><span class=w> </span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=w>  </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>total_requests</span><span class=p>,</span>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=w>  </span><span class=k>AVG</span><span class=p>(</span><span class=ss>&quot;responseTime&quot;</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>avg_response_time</span><span class=p>,</span>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=w>  </span><span class=n>PERCENTILE_CONT</span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>95</span><span class=p>)</span><span class=w> </span><span class=n>WITHIN</span><span class=w> </span><span class=k>GROUP</span><span class=w> </span><span class=p>(</span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=ss>&quot;responseTime&quot;</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>p95_response_time</span><span class=p>,</span>
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=w>  </span><span class=k>CASE</span><span class=w> </span>
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=w>    </span><span class=k>WHEN</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=mi>0</span>
</span><span id=__span-12-8><a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=w>    </span><span class=k>ELSE</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=k>CASE</span><span class=w> </span><span class=k>WHEN</span><span class=w> </span><span class=ss>&quot;statusCode&quot;</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mi>400</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>END</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mi>100</span><span class=p>.</span><span class=mi>0</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span>
</span><span id=__span-12-9><a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a><span class=w>  </span><span class=k>END</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>error_rate</span>
</span><span id=__span-12-10><a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a><span class=k>FROM</span><span class=w> </span><span class=ss>&quot;AnalyticsRequest&quot;</span>
</span><span id=__span-12-11><a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a><span class=k>WHERE</span><span class=w> </span><span class=k>timestamp</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=err>$</span><span class=mi>1</span><span class=p>;</span>
</span></code></pre></div> <h3 id=key-metrics-tracked>Key Metrics Tracked<a class=headerlink href=#key-metrics-tracked title="Permanent link">&para;</a></h3> <h4 id=performance-metrics>Performance Metrics<a class=headerlink href=#performance-metrics title="Permanent link">&para;</a></h4> <ul> <li><strong>Request Volume</strong>: Requests per second, hourly, daily</li> <li><strong>Response Times</strong>: Average, P95, P99 response times</li> <li><strong>Error Rates</strong>: 4xx and 5xx error percentages</li> <li><strong>Throughput</strong>: Data transfer rates</li> </ul> <h4 id=security-metrics>Security Metrics<a class=headerlink href=#security-metrics title="Permanent link">&para;</a></h4> <ul> <li><strong>Authentication Failures</strong>: Failed login attempts</li> <li><strong>Token Abuse</strong>: Invalid or expired token usage</li> <li><strong>Geographic Anomalies</strong>: Unusual access patterns</li> <li><strong>Risk Scores</strong>: Calculated security risk levels</li> </ul> <h4 id=business-metrics>Business Metrics<a class=headerlink href=#business-metrics title="Permanent link">&para;</a></h4> <ul> <li><strong>User Engagement</strong>: Active users, session duration</li> <li><strong>API Usage</strong>: Tool usage patterns, popular endpoints</li> <li><strong>Client Activity</strong>: OAuth client usage statistics</li> <li><strong>Growth Metrics</strong>: User acquisition, retention rates</li> </ul> <h3 id=data-retention-and-cleanup>Data Retention and Cleanup<a class=headerlink href=#data-retention-and-cleanup title="Permanent link">&para;</a></h3> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=c1>// Automatic data cleanup with TTL</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=nx>model</span><span class=w> </span><span class=nx>AnalyticsRequest</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=w>  </span><span class=c1>// TTL field - automatically set to 14 days from creation</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=w>  </span><span class=nx>expiresAt</span><span class=w> </span><span class=nx>DateTime</span><span class=w> </span><span class=kd>@default</span><span class=p>(</span><span class=nx>dbgenerated</span><span class=p>(</span><span class=s2>&quot;NOW() + INTERVAL &#39;14 days&#39;&quot;</span><span class=p>))</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=w>  </span><span class=err>@</span><span class=kd>@index</span><span class=p>([</span><span class=nx>expiresAt</span><span class=p>])</span>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=p>}</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a>
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=c1>// Cleanup job</span>
</span><span id=__span-13-10><a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a><span class=k>async</span><span class=w> </span><span class=nx>cleanupOldData</span><span class=p>(</span><span class=nx>daysOld</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>30</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-13-11><a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>cutoff</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nb>Date</span><span class=p>(</span><span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=nx>daysOld</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mf>24</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mf>60</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mf>60</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mf>1000</span><span class=p>);</span>
</span><span id=__span-13-12><a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a>
</span><span id=__span-13-13><a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=w>  </span><span class=k>await</span><span class=w> </span><span class=nx>prisma</span><span class=p>.</span><span class=nx>analyticsRequest</span><span class=p>.</span><span class=nx>deleteMany</span><span class=p>({</span>
</span><span id=__span-13-14><a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a><span class=w>    </span><span class=nx>where</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>timestamp</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>lt</span><span class=o>:</span><span class=w> </span><span class=kt>cutoff</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-13-15><a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-13-16><a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a><span class=p>}</span>
</span></code></pre></div> <hr> <h2 id=technology-stack>Technology Stack<a class=headerlink href=#technology-stack title="Permanent link">&para;</a></h2> <h3 id=core-technologies>Core Technologies<a class=headerlink href=#core-technologies title="Permanent link">&para;</a></h3> <h4 id=frontend-technologies>Frontend Technologies<a class=headerlink href=#frontend-technologies title="Permanent link">&para;</a></h4> <ul> <li><strong>Next.js 15</strong>: React framework with App Router</li> <li><strong>TypeScript</strong>: Type-safe JavaScript development</li> <li><strong>Tailwind CSS</strong>: Utility-first CSS framework</li> <li><strong>Radix UI</strong>: Accessible component library</li> <li><strong>Framer Motion</strong>: Animation library</li> </ul> <h4 id=backend-technologies>Backend Technologies<a class=headerlink href=#backend-technologies title="Permanent link">&para;</a></h4> <ul> <li><strong>Node.js</strong>: JavaScript runtime environment</li> <li><strong>Next.js API Routes</strong>: Serverless API endpoints</li> <li><strong>Prisma ORM</strong>: Type-safe database toolkit</li> <li><strong>NextAuth.js</strong>: Authentication library</li> <li><strong>Zod</strong>: Runtime type validation</li> </ul> <h4 id=database-technologies>Database Technologies<a class=headerlink href=#database-technologies title="Permanent link">&para;</a></h4> <ul> <li><strong>PostgreSQL</strong>: Primary relational database</li> <li><strong>Redis</strong>: Caching and session storage (optional)</li> <li><strong>Prisma Client</strong>: Generated database client</li> </ul> <h4 id=security-technologies>Security Technologies<a class=headerlink href=#security-technologies title="Permanent link">&para;</a></h4> <ul> <li><strong>OAuth 2.1</strong>: Authorization framework</li> <li><strong>PKCE</strong>: Proof Key for Code Exchange</li> <li><strong>Google OAuth</strong>: Identity provider</li> <li><strong>JWT</strong>: JSON Web Tokens for sessions</li> </ul> <h4 id=mcp-technologies>MCP Technologies<a class=headerlink href=#mcp-technologies title="Permanent link">&para;</a></h4> <ul> <li><strong><a class="magiclink magiclink-github magiclink-repository" href=https://github.com/modelcontextprotocol/sdk title="GitHub Repository: modelcontextprotocol/sdk">modelcontextprotocol/sdk</a></strong>: MCP protocol implementation</li> <li><strong><a class="magiclink magiclink-github magiclink-repository" href=https://github.com/vercel/mcp-adapter title="GitHub Repository: vercel/mcp-adapter">vercel/mcp-adapter</a></strong>: MCP server adapter</li> <li><strong>Server-Sent Events</strong>: Real-time communication</li> <li><strong>WebSocket</strong>: Bidirectional communication (future)</li> </ul> <h3 id=architectural-patterns>Architectural Patterns<a class=headerlink href=#architectural-patterns title="Permanent link">&para;</a></h3> <h4 id=design-patterns-used>Design Patterns Used<a class=headerlink href=#design-patterns-used title="Permanent link">&para;</a></h4> <ol> <li><strong>Repository Pattern</strong>: Data access abstraction</li> <li><strong>Factory Pattern</strong>: Client and token creation</li> <li><strong>Observer Pattern</strong>: Analytics event handling</li> <li><strong>Adapter Pattern</strong>: MCP protocol adaptation</li> <li><strong>Middleware Pattern</strong>: Request/response processing</li> </ol> <h4 id=architectural-patterns_1>Architectural Patterns<a class=headerlink href=#architectural-patterns_1 title="Permanent link">&para;</a></h4> <ol> <li><strong>Layered Architecture</strong>: Clear separation of concerns</li> <li><strong>Microservices</strong>: Modular service decomposition</li> <li><strong>Event-Driven Architecture</strong>: Asynchronous event processing</li> <li><strong>CQRS</strong>: Command Query Responsibility Segregation for analytics</li> <li><strong>Saga Pattern</strong>: Distributed transaction management</li> </ol> <h3 id=development-tools>Development Tools<a class=headerlink href=#development-tools title="Permanent link">&para;</a></h3> <h4 id=code-quality>Code Quality<a class=headerlink href=#code-quality title="Permanent link">&para;</a></h4> <ul> <li><strong>ESLint</strong>: JavaScript/TypeScript linting</li> <li><strong>Prettier</strong>: Code formatting</li> <li><strong>TypeScript</strong>: Static type checking</li> <li><strong>Husky</strong>: Git hooks for quality gates</li> </ul> <h4 id=testing-framework>Testing Framework<a class=headerlink href=#testing-framework title="Permanent link">&para;</a></h4> <ul> <li><strong>Jest</strong>: Unit testing framework</li> <li><strong>React Testing Library</strong>: Component testing</li> <li><strong>Cypress</strong>: End-to-end testing</li> <li><strong>Playwright</strong>: Cross-browser testing</li> </ul> <h4 id=devops-tools>DevOps Tools<a class=headerlink href=#devops-tools title="Permanent link">&para;</a></h4> <ul> <li><strong>Docker</strong>: Containerization</li> <li><strong>Vercel</strong>: Deployment platform</li> <li><strong>GitHub Actions</strong>: CI/CD pipeline</li> <li><strong>Prisma Migrate</strong>: Database migrations</li> </ul> <hr> <h2 id=file-structure-and-organization>File Structure and Organization<a class=headerlink href=#file-structure-and-organization title="Permanent link">&para;</a></h2> <h3 id=project-structure>Project Structure<a class=headerlink href=#project-structure title="Permanent link">&para;</a></h3> <div class="language-text highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a>mcp-oauth-sample/
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>├── app/                          # Next.js App Router
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>│   ├── api/                      # API routes
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a>│   │   ├── auth/                 # NextAuth.js endpoints
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a>│   │   │   └── [...nextauth]/    # Dynamic auth routes
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a>│   │   ├── oauth/                # OAuth 2.1 endpoints
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a>│   │   │   ├── register/         # Client registration
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a>│   │   │   └── token/            # Token endpoint
</span><span id=__span-14-9><a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a>│   │   ├── analytics/            # Analytics endpoints
</span><span id=__span-14-10><a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a>│   │   │   ├── collect/          # Data collection
</span><span id=__span-14-11><a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a>│   │   │   ├── security/         # Security events
</span><span id=__span-14-12><a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a>│   │   │   └── generate-threats/ # Test data generation
</span><span id=__span-14-13><a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a>│   │   └── cleanup/              # Data cleanup jobs
</span><span id=__span-14-14><a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a>│   ├── mcp/                      # MCP server implementation
</span><span id=__span-14-15><a id=__codelineno-14-15 name=__codelineno-14-15 href=#__codelineno-14-15></a>│   │   └── [transport]/          # Dynamic transport routes
</span><span id=__span-14-16><a id=__codelineno-14-16 name=__codelineno-14-16 href=#__codelineno-14-16></a>│   ├── oauth/                    # OAuth UI pages
</span><span id=__span-14-17><a id=__codelineno-14-17 name=__codelineno-14-17 href=#__codelineno-14-17></a>│   │   └── authorize/            # Authorization consent
</span><span id=__span-14-18><a id=__codelineno-14-18 name=__codelineno-14-18 href=#__codelineno-14-18></a>│   ├── analytics/                # Analytics dashboard
</span><span id=__span-14-19><a id=__codelineno-14-19 name=__codelineno-14-19 href=#__codelineno-14-19></a>│   ├── auth.ts                   # NextAuth configuration
</span><span id=__span-14-20><a id=__codelineno-14-20 name=__codelineno-14-20 href=#__codelineno-14-20></a>│   ├── prisma.ts                 # Prisma client setup
</span><span id=__span-14-21><a id=__codelineno-14-21 name=__codelineno-14-21 href=#__codelineno-14-21></a>│   ├── layout.tsx                # Root layout component
</span><span id=__span-14-22><a id=__codelineno-14-22 name=__codelineno-14-22 href=#__codelineno-14-22></a>│   └── page.tsx                  # Home page
</span><span id=__span-14-23><a id=__codelineno-14-23 name=__codelineno-14-23 href=#__codelineno-14-23></a>├── components/                   # Reusable React components
</span><span id=__span-14-24><a id=__codelineno-14-24 name=__codelineno-14-24 href=#__codelineno-14-24></a>│   ├── analytics/                # Analytics components
</span><span id=__span-14-25><a id=__codelineno-14-25 name=__codelineno-14-25 href=#__codelineno-14-25></a>│   │   ├── dashboard-header.tsx  # Dashboard header
</span><span id=__span-14-26><a id=__codelineno-14-26 name=__codelineno-14-26 href=#__codelineno-14-26></a>│   │   ├── metric-card.tsx       # Metric display cards
</span><span id=__span-14-27><a id=__codelineno-14-27 name=__codelineno-14-27 href=#__codelineno-14-27></a>│   │   ├── oauth-overview.tsx    # OAuth metrics
</span><span id=__span-14-28><a id=__codelineno-14-28 name=__codelineno-14-28 href=#__codelineno-14-28></a>│   │   ├── security-panel.tsx    # Security dashboard
</span><span id=__span-14-29><a id=__codelineno-14-29 name=__codelineno-14-29 href=#__codelineno-14-29></a>│   │   └── tool-usage-panel.tsx  # MCP tool usage
</span><span id=__span-14-30><a id=__codelineno-14-30 name=__codelineno-14-30 href=#__codelineno-14-30></a>│   ├── ui/                       # Base UI components
</span><span id=__span-14-31><a id=__codelineno-14-31 name=__codelineno-14-31 href=#__codelineno-14-31></a>│   │   ├── button.tsx            # Button component
</span><span id=__span-14-32><a id=__codelineno-14-32 name=__codelineno-14-32 href=#__codelineno-14-32></a>│   │   ├── card.tsx              # Card component
</span><span id=__span-14-33><a id=__codelineno-14-33 name=__codelineno-14-33 href=#__codelineno-14-33></a>│   │   ├── chart.tsx             # Chart components
</span><span id=__span-14-34><a id=__codelineno-14-34 name=__codelineno-14-34 href=#__codelineno-14-34></a>│   │   └── ...                   # Other UI components
</span><span id=__span-14-35><a id=__codelineno-14-35 name=__codelineno-14-35 href=#__codelineno-14-35></a>│   ├── theme-provider.tsx        # Theme context
</span><span id=__span-14-36><a id=__codelineno-14-36 name=__codelineno-14-36 href=#__codelineno-14-36></a>│   └── theme-toggle.tsx          # Dark/light mode toggle
</span><span id=__span-14-37><a id=__codelineno-14-37 name=__codelineno-14-37 href=#__codelineno-14-37></a>├── lib/                          # Utility libraries
</span><span id=__span-14-38><a id=__codelineno-14-38 name=__codelineno-14-38 href=#__codelineno-14-38></a>│   ├── analytics-db.ts           # Analytics database layer
</span><span id=__span-14-39><a id=__codelineno-14-39 name=__codelineno-14-39 href=#__codelineno-14-39></a>│   ├── security-monitor.ts       # Security monitoring
</span><span id=__span-14-40><a id=__codelineno-14-40 name=__codelineno-14-40 href=#__codelineno-14-40></a>│   └── utils.ts                  # General utilities
</span><span id=__span-14-41><a id=__codelineno-14-41 name=__codelineno-14-41 href=#__codelineno-14-41></a>├── prisma/                       # Database schema and migrations
</span><span id=__span-14-42><a id=__codelineno-14-42 name=__codelineno-14-42 href=#__codelineno-14-42></a>│   └── schema.prisma             # Prisma schema definition
</span><span id=__span-14-43><a id=__codelineno-14-43 name=__codelineno-14-43 href=#__codelineno-14-43></a>├── docs/                         # Documentation
</span><span id=__span-14-44><a id=__codelineno-14-44 name=__codelineno-14-44 href=#__codelineno-14-44></a>│   ├── architecture.md           # This file
</span><span id=__span-14-45><a id=__codelineno-14-45 name=__codelineno-14-45 href=#__codelineno-14-45></a>│   └── setup.md                  # Setup instructions
</span><span id=__span-14-46><a id=__codelineno-14-46 name=__codelineno-14-46 href=#__codelineno-14-46></a>├── middleware.ts                 # Next.js middleware
</span><span id=__span-14-47><a id=__codelineno-14-47 name=__codelineno-14-47 href=#__codelineno-14-47></a>├── next.config.ts                # Next.js configuration
</span><span id=__span-14-48><a id=__codelineno-14-48 name=__codelineno-14-48 href=#__codelineno-14-48></a>├── package.json                  # Dependencies and scripts
</span><span id=__span-14-49><a id=__codelineno-14-49 name=__codelineno-14-49 href=#__codelineno-14-49></a>├── tailwind.config.js            # Tailwind CSS configuration
</span><span id=__span-14-50><a id=__codelineno-14-50 name=__codelineno-14-50 href=#__codelineno-14-50></a>├── tsconfig.json                 # TypeScript configuration
</span><span id=__span-14-51><a id=__codelineno-14-51 name=__codelineno-14-51 href=#__codelineno-14-51></a>└── README.md                     # Project overview
</span></code></pre></div> <h3 id=code-organization-principles>Code Organization Principles<a class=headerlink href=#code-organization-principles title="Permanent link">&para;</a></h3> <h4 id=separation-of-concerns>Separation of Concerns<a class=headerlink href=#separation-of-concerns title="Permanent link">&para;</a></h4> <ul> <li><strong>API Layer</strong>: Handle HTTP requests and responses</li> <li><strong>Business Logic</strong>: Implement core authentication and authorization</li> <li><strong>Data Layer</strong>: Manage database operations and caching</li> <li><strong>Presentation Layer</strong>: Render UI components and manage state</li> </ul> <h4 id=module-boundaries>Module Boundaries<a class=headerlink href=#module-boundaries title="Permanent link">&para;</a></h4> <ul> <li><strong>Authentication Module</strong>: NextAuth.js integration and session management</li> <li><strong>OAuth Module</strong>: OAuth 2.1 server implementation</li> <li><strong>MCP Module</strong>: Model Context Protocol server and tools</li> <li><strong>Analytics Module</strong>: Data collection and analysis</li> <li><strong>Security Module</strong>: Threat detection and monitoring</li> </ul> <h4 id=naming-conventions>Naming Conventions<a class=headerlink href=#naming-conventions title="Permanent link">&para;</a></h4> <ul> <li><strong>Files</strong>: kebab-case for component files, camelCase for utilities</li> <li><strong>Components</strong>: PascalCase for React components</li> <li><strong>Functions</strong>: camelCase for function names</li> <li><strong>Constants</strong>: UPPER_SNAKE_CASE for constants</li> <li><strong>Types</strong>: PascalCase for TypeScript types and interfaces</li> </ul> <h3 id=key-files-explained>Key Files Explained<a class=headerlink href=#key-files-explained title="Permanent link">&para;</a></h3> <h4 id=core-configuration-files>Core Configuration Files<a class=headerlink href=#core-configuration-files title="Permanent link">&para;</a></h4> <p><strong><code>app/auth.ts</code></strong> - NextAuth.js configuration with Google OAuth provider and Prisma adapter</p> <p><strong><code>app/prisma.ts</code></strong> - Prisma client singleton with optimized connection handling</p> <p><strong><code>prisma/schema.prisma</code></strong> - Complete database schema with OAuth 2.1 and analytics models</p> <h4 id=api-implementation-files>API Implementation Files<a class=headerlink href=#api-implementation-files title="Permanent link">&para;</a></h4> <p><strong><code>app/api/oauth/token/route.ts</code></strong> - OAuth 2.1 token endpoint with PKCE support and refresh token rotation</p> <p><strong><code>app/api/oauth/register/route.ts</code></strong> - Dynamic client registration per RFC 7591</p> <p><strong><code>app/mcp/[transport]/route.ts</code></strong> - MCP server with authentication middleware and tool implementations</p> <h4 id=analytics-and-security-files>Analytics and Security Files<a class=headerlink href=#analytics-and-security-files title="Permanent link">&para;</a></h4> <p><strong><code>lib/analytics-db.ts</code></strong> - High-performance analytics collection with batching and optimized queries</p> <p><strong><code>lib/security-monitor.ts</code></strong> - Security event detection and threat analysis</p> <p><strong><code>app/api/analytics/collect/route.ts</code></strong> - Analytics data collection endpoint</p> <h4 id=ui-and-dashboard-files>UI and Dashboard Files<a class=headerlink href=#ui-and-dashboard-files title="Permanent link">&para;</a></h4> <p><strong><code>app/analytics/page.tsx</code></strong> - Main analytics dashboard with real-time metrics</p> <p><strong><code>components/analytics/</code></strong> - Specialized analytics components for different metric types</p> <p><strong><code>app/oauth/authorize/page.tsx</code></strong> - OAuth authorization consent screen</p> <h3 id=development-workflow>Development Workflow<a class=headerlink href=#development-workflow title="Permanent link">&para;</a></h3> <h4 id=local-development-setup>Local Development Setup<a class=headerlink href=#local-development-setup title="Permanent link">&para;</a></h4> <ol> <li><strong>Environment Setup</strong>: Configure PostgreSQL, Redis, and environment variables</li> <li><strong>Database Migration</strong>: Run Prisma migrations and generate client</li> <li><strong>Development Server</strong>: Start Next.js development server</li> <li><strong>Testing</strong>: Run unit tests and end-to-end tests</li> </ol> <h4 id=production-deployment>Production Deployment<a class=headerlink href=#production-deployment title="Permanent link">&para;</a></h4> <ol> <li><strong>Build Process</strong>: Generate optimized production build</li> <li><strong>Database Deployment</strong>: Apply migrations to production database</li> <li><strong>Security Configuration</strong>: Configure security headers and SSL</li> <li><strong>Monitoring Setup</strong>: Deploy analytics and monitoring infrastructure</li> </ol> <hr> <h2 id=conclusion>Conclusion<a class=headerlink href=#conclusion title="Permanent link">&para;</a></h2> <p>This MCP OAuth 2.1 Server represents a comprehensive implementation of modern authentication and authorization patterns specifically designed for Model Context Protocol interactions. The architecture emphasizes security, performance, and observability while maintaining compliance with relevant standards and specifications.</p> <p>The system's modular design allows for easy extension and customization, while the comprehensive analytics and security monitoring provide the visibility needed for production deployment. The technology choices reflect current best practices in web development, security, and database design.</p> <p>For questions or contributions, please refer to the project documentation and follow the established development workflows.</p> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../setup/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Setup Guide"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Setup Guide </div> </div> </a> <a href=../security/ class="md-footer__link md-footer__link--next" aria-label="Next: Security Model"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Security Model </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024 raxIT AI – <a href=#__consent>Change cookie settings</a> </div> </div> <div class=md-social> <a href=https://github.com/raxITai/mcp-oauth-sample target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://www.linkedin.com/company/raxit-ai target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> <a href=https://x.com/raxit_ai target=_blank rel=noopener title=x.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9zm-24.8 373.8h39.1L151.1 88h-42z"/></svg> </a> <a href=https://bsky.app/profile/raxit.ai target=_blank rel=noopener title=bsky.app class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M111.8 62.2C170.2 105.9 233 194.7 256 242.4c23-47.6 85.8-136.4 144.2-180.2 42.1-31.6 110.3-56 110.3 21.8 0 15.5-8.9 130.5-14.1 149.2-18.2 64.8-84.4 81.4-143.3 71.3C456 322 482.2 380 425.6 438c-107.4 110.2-154.3-27.6-166.3-62.9-1.7-4.9-2.6-7.8-3.3-7.8s-1.6 3-3.3 7.8c-12 35.3-59 173.1-166.3 62.9-56.5-58-30.4-116 72.5-133.5C100 314.6 33.8 298 15.7 233.1 10.4 214.4 1.5 99.4 1.5 83.9c0-77.8 68.2-53.4 110.3-21.8z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"base": "..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "content.tabs.link", "content.tooltips", "header.autohide", "navigation.expand", "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.prune", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow", "toc.integrate"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../assets/javascripts/bundle.56ea9cef.min.js></script> <script src=../javascripts/mathjax.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>