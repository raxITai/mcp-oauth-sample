<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Production-ready MCP OAuth 2.1 server with analytics and security monitoring"><meta name=author content="raxIT AI"><link href=https://raxitai.github.io/mcp-oauth-sample/troubleshooting/ rel=canonical><link href=../development/ rel=prev><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.15"><title>Troubleshooting - MCP OAuth Sample Documentation</title><link rel=stylesheet href=../assets/stylesheets/main.342714a4.min.css><link rel=stylesheet href=../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../stylesheets/extra.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#mcp-oauth-server-troubleshooting-guide class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="MCP OAuth Sample Documentation" class="md-header__button md-logo" aria-label="MCP OAuth Sample Documentation" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> MCP OAuth Sample Documentation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Troubleshooting </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media=(prefers-color-scheme) data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=blue aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=blue aria-label="Switch to system preference" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to system preference" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/raxITai/mcp-oauth-sample title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> raxITai/mcp-oauth-sample </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../setup/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../architecture/ class=md-tabs__link> Architecture </a> </li> <li class=md-tabs__item> <a href=../analytics/ class=md-tabs__link> Features </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../deployment/ class=md-tabs__link> Operations </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="MCP OAuth Sample Documentation" class="md-nav__button md-logo" aria-label="MCP OAuth Sample Documentation" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> MCP OAuth Sample Documentation </label> <div class=md-nav__source> <a href=https://github.com/raxITai/mcp-oauth-sample title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> raxITai/mcp-oauth-sample </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../setup/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../architecture/ class=md-nav__link> <span class=md-ellipsis> Architecture </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../analytics/ class=md-nav__link> <span class=md-ellipsis> Features </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex> <span class=md-ellipsis> Operations </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=true> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Operations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../deployment/ class=md-nav__link> <span class=md-ellipsis> Deployment </span> </a> </li> <li class=md-nav__item> <a href=../development/ class=md-nav__link> <span class=md-ellipsis> Development </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Troubleshooting </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Troubleshooting </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#table-of-contents class=md-nav__link> <span class=md-ellipsis> Table of Contents </span> </a> </li> <li class=md-nav__item> <a href=#common-setup-issues class=md-nav__link> <span class=md-ellipsis> Common Setup Issues </span> </a> <nav class=md-nav aria-label="Common Setup Issues"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#issue-prisma-client-generation-fails class=md-nav__link> <span class=md-ellipsis> Issue: Prisma Client Generation Fails </span> </a> </li> <li class=md-nav__item> <a href=#issue-nextjs-development-server-wont-start class=md-nav__link> <span class=md-ellipsis> Issue: Next.js Development Server Won't Start </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#database-connection-problems class=md-nav__link> <span class=md-ellipsis> Database Connection Problems </span> </a> <nav class=md-nav aria-label="Database Connection Problems"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#issue-postgresql-connection-refused class=md-nav__link> <span class=md-ellipsis> Issue: PostgreSQL Connection Refused </span> </a> </li> <li class=md-nav__item> <a href=#issue-database-schema-out-of-sync class=md-nav__link> <span class=md-ellipsis> Issue: Database Schema Out of Sync </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#oauth-flow-errors class=md-nav__link> <span class=md-ellipsis> OAuth Flow Errors </span> </a> <nav class=md-nav aria-label="OAuth Flow Errors"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#issue-invalid-client-error class=md-nav__link> <span class=md-ellipsis> Issue: Invalid Client Error </span> </a> </li> <li class=md-nav__item> <a href=#issue-pkce-validation-failure class=md-nav__link> <span class=md-ellipsis> Issue: PKCE Validation Failure </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#mcp-client-integration-issues class=md-nav__link> <span class=md-ellipsis> MCP Client Integration Issues </span> </a> <nav class=md-nav aria-label="MCP Client Integration Issues"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#issue-mcp-client-authentication-fails class=md-nav__link> <span class=md-ellipsis> Issue: MCP Client Authentication Fails </span> </a> </li> <li class=md-nav__item> <a href=#issue-mcp-transport-configuration class=md-nav__link> <span class=md-ellipsis> Issue: MCP Transport Configuration </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#authentication-failures class=md-nav__link> <span class=md-ellipsis> Authentication Failures </span> </a> <nav class=md-nav aria-label="Authentication Failures"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#issue-nextauth-google-oauth-not-working class=md-nav__link> <span class=md-ellipsis> Issue: NextAuth Google OAuth Not Working </span> </a> </li> <li class=md-nav__item> <a href=#issue-session-management-problems class=md-nav__link> <span class=md-ellipsis> Issue: Session Management Problems </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#api-endpoint-errors class=md-nav__link> <span class=md-ellipsis> API Endpoint Errors </span> </a> <nav class=md-nav aria-label="API Endpoint Errors"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#issue-cors-errors-in-browser class=md-nav__link> <span class=md-ellipsis> Issue: CORS Errors in Browser </span> </a> </li> <li class=md-nav__item> <a href=#issue-api-rate-limiting-errors class=md-nav__link> <span class=md-ellipsis> Issue: API Rate Limiting Errors </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#analytics-dashboard-problems class=md-nav__link> <span class=md-ellipsis> Analytics Dashboard Problems </span> </a> <nav class=md-nav aria-label="Analytics Dashboard Problems"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#issue-dashboard-data-not-loading class=md-nav__link> <span class=md-ellipsis> Issue: Dashboard Data Not Loading </span> </a> </li> <li class=md-nav__item> <a href=#issue-chart-rendering-problems class=md-nav__link> <span class=md-ellipsis> Issue: Chart Rendering Problems </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#performance-issues class=md-nav__link> <span class=md-ellipsis> Performance Issues </span> </a> <nav class=md-nav aria-label="Performance Issues"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#issue-slow-database-queries class=md-nav__link> <span class=md-ellipsis> Issue: Slow Database Queries </span> </a> </li> <li class=md-nav__item> <a href=#issue-memory-leaks-and-high-cpu-usage class=md-nav__link> <span class=md-ellipsis> Issue: Memory Leaks and High CPU Usage </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#security-related-errors class=md-nav__link> <span class=md-ellipsis> Security-Related Errors </span> </a> <nav class=md-nav aria-label="Security-Related Errors"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#issue-token-security-violations class=md-nav__link> <span class=md-ellipsis> Issue: Token Security Violations </span> </a> </li> <li class=md-nav__item> <a href=#issue-csrf-and-xss-vulnerabilities class=md-nav__link> <span class=md-ellipsis> Issue: CSRF and XSS Vulnerabilities </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#production-deployment-issues class=md-nav__link> <span class=md-ellipsis> Production Deployment Issues </span> </a> <nav class=md-nav aria-label="Production Deployment Issues"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#issue-environment-specific-configuration-errors class=md-nav__link> <span class=md-ellipsis> Issue: Environment-Specific Configuration Errors </span> </a> </li> <li class=md-nav__item> <a href=#issue-docker-deployment-problems class=md-nav__link> <span class=md-ellipsis> Issue: Docker Deployment Problems </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#environment-variable-problems class=md-nav__link> <span class=md-ellipsis> Environment Variable Problems </span> </a> <nav class=md-nav aria-label="Environment Variable Problems"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#issue-missing-or-invalid-environment-variables class=md-nav__link> <span class=md-ellipsis> Issue: Missing or Invalid Environment Variables </span> </a> </li> <li class=md-nav__item> <a href=#issue-environment-variable-security class=md-nav__link> <span class=md-ellipsis> Issue: Environment Variable Security </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#debugging-tools-and-techniques class=md-nav__link> <span class=md-ellipsis> Debugging Tools and Techniques </span> </a> <nav class=md-nav aria-label="Debugging Tools and Techniques"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#development-debugging-tools class=md-nav__link> <span class=md-ellipsis> Development Debugging Tools </span> </a> </li> <li class=md-nav__item> <a href=#production-monitoring class=md-nav__link> <span class=md-ellipsis> Production Monitoring </span> </a> </li> <li class=md-nav__item> <a href=#debugging-checklist class=md-nav__link> <span class=md-ellipsis> Debugging Checklist </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#quick-reference class=md-nav__link> <span class=md-ellipsis> Quick Reference </span> </a> <nav class=md-nav aria-label="Quick Reference"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#common-error-codes class=md-nav__link> <span class=md-ellipsis> Common Error Codes </span> </a> </li> <li class=md-nav__item> <a href=#important-log-locations class=md-nav__link> <span class=md-ellipsis> Important Log Locations </span> </a> </li> <li class=md-nav__item> <a href=#emergency-procedures class=md-nav__link> <span class=md-ellipsis> Emergency Procedures </span> </a> </li> <li class=md-nav__item> <a href=#support-resources class=md-nav__link> <span class=md-ellipsis> Support Resources </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/raxITai/mcp-oauth-sample/edit/main/docs/troubleshooting.md title="Edit this page" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"/></svg> </a> <a href=https://github.com/raxITai/mcp-oauth-sample/raw/main/docs/troubleshooting.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5 5 5 0 0 1 5-5 5 5 0 0 1 5 5 5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5"/></svg> </a> <h1 id=mcp-oauth-server-troubleshooting-guide>MCP OAuth Server Troubleshooting Guide<a class=headerlink href=#mcp-oauth-server-troubleshooting-guide title="Permanent link">&para;</a></h1> <p>This comprehensive guide covers common issues, debugging procedures, and solutions for the MCP OAuth server implementation.</p> <h2 id=table-of-contents>Table of Contents<a class=headerlink href=#table-of-contents title="Permanent link">&para;</a></h2> <ol> <li><a href=#common-setup-issues>Common Setup Issues</a></li> <li><a href=#database-connection-problems>Database Connection Problems</a></li> <li><a href=#oauth-flow-errors>OAuth Flow Errors</a></li> <li><a href=#mcp-client-integration-issues>MCP Client Integration Issues</a></li> <li><a href=#authentication-failures>Authentication Failures</a></li> <li><a href=#api-endpoint-errors>API Endpoint Errors</a></li> <li><a href=#analytics-dashboard-problems>Analytics Dashboard Problems</a></li> <li><a href=#performance-issues>Performance Issues</a></li> <li><a href=#security-related-errors>Security-Related Errors</a></li> <li><a href=#production-deployment-issues>Production Deployment Issues</a></li> <li><a href=#environment-variable-problems>Environment Variable Problems</a></li> <li><a href=#debugging-tools-and-techniques>Debugging Tools and Techniques</a></li> </ol> <hr> <h2 id=common-setup-issues>Common Setup Issues<a class=headerlink href=#common-setup-issues title="Permanent link">&para;</a></h2> <h3 id=issue-prisma-client-generation-fails>Issue: Prisma Client Generation Fails<a class=headerlink href=#issue-prisma-client-generation-fails title="Permanent link">&para;</a></h3> <p><strong>Problem Description:</strong> Prisma client fails to generate during <code>pnpm install</code> or <code>pnpm build</code>.</p> <p><strong>Symptoms:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>Error:<span class=w> </span>Cannot<span class=w> </span>find<span class=w> </span>module<span class=w> </span><span class=s1>&#39;generated/prisma&#39;</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>PrismaClientInitializationError:<span class=w> </span>Prisma<span class=w> </span>has<span class=w> </span>detected<span class=w> </span>that<span class=w> </span>this<span class=w> </span>project<span class=w> </span>uses<span class=w> </span>a<span class=w> </span>custom<span class=w> </span>output<span class=w> </span>path
</span></code></pre></div></p> <p><strong>Root Cause Analysis:</strong> - Custom Prisma client output path is not properly configured - Missing Prisma generate step in build process - Node modules corruption</p> <p><strong>Step-by-step Solution:</strong> 1. Check Prisma schema configuration: <div class="language-text highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>generator client {
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>  provider = &quot;prisma-client-js&quot;
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>  output   = &quot;../generated/prisma&quot;
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>  engineType = &quot;library&quot;
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>}
</span></code></pre></div></p> <ol> <li> <p>Manually generate Prisma client: <div class="language-bash highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>pnpm<span class=w> </span>prisma<span class=w> </span>generate
</span></code></pre></div></p> </li> <li> <p>Clear and reinstall dependencies: <div class="language-bash highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>rm<span class=w> </span>-rf<span class=w> </span>node_modules<span class=w> </span>pnpm-lock.yaml
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>rm<span class=w> </span>-rf<span class=w> </span>generated/
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>pnpm<span class=w> </span>install
</span></code></pre></div></p> </li> <li> <p>Verify build script includes Prisma generation: <div class="language-json highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=p>{</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=w>  </span><span class=nt>&quot;scripts&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=w>    </span><span class=nt>&quot;build&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;prisma generate --no-engine &amp;&amp; next build&quot;</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=p>}</span>
</span></code></pre></div></p> </li> </ol> <p><strong>Prevention Tips:</strong> - Always run <code>pnpm prisma generate</code> after schema changes - Include postinstall script for automatic generation - Use <code>--no-engine</code> flag in production builds</p> <p><strong>Related Issues:</strong> - <a href=#database-connection-problems>Database Connection Problems</a> - <a href=#production-deployment-issues>Production Deployment Issues</a></p> <hr> <h3 id=issue-nextjs-development-server-wont-start>Issue: Next.js Development Server Won't Start<a class=headerlink href=#issue-nextjs-development-server-wont-start title="Permanent link">&para;</a></h3> <p><strong>Problem Description:</strong> Development server fails to start with various port or configuration errors.</p> <p><strong>Symptoms:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>Error:<span class=w> </span>listen<span class=w> </span>EADDRINUSE:<span class=w> </span>address<span class=w> </span>already<span class=w> </span><span class=k>in</span><span class=w> </span>use<span class=w> </span>:::3000
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>Error:<span class=w> </span>Invalid<span class=w> </span>configuration<span class=w> </span>object
</span></code></pre></div></p> <p><strong>Root Cause Analysis:</strong> - Port 3000 already in use - Invalid Next.js configuration - Missing environment variables</p> <p><strong>Step-by-step Solution:</strong> 1. Check for processes using port 3000: <div class="language-bash highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>lsof<span class=w> </span>-ti:3000
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=nb>kill</span><span class=w> </span>-9<span class=w> </span><span class=k>$(</span>lsof<span class=w> </span>-ti:3000<span class=k>)</span>
</span></code></pre></div></p> <ol> <li> <p>Use alternative port: <div class="language-bash highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a>pnpm<span class=w> </span>dev<span class=w> </span>--<span class=w> </span>-p<span class=w> </span><span class=m>3001</span>
</span></code></pre></div></p> </li> <li> <p>Verify Next.js configuration (<code>next.config.ts</code>): <div class="language-typescript highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=kd>const</span><span class=w> </span><span class=nx>nextConfig</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=w>  </span><span class=nx>experimental</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=w>    </span><span class=nx>serverComponentsExternalPackages</span><span class=o>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;@prisma/client&#39;</span><span class=p>]</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=p>};</span>
</span></code></pre></div></p> </li> <li> <p>Check TypeScript configuration: <div class="language-bash highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a>pnpm<span class=w> </span>tsc<span class=w> </span>--noEmit
</span></code></pre></div></p> </li> </ol> <p><strong>Prevention Tips:</strong> - Use port management tools like <code>fkill-cli</code> - Regularly validate configuration files - Keep dependencies updated</p> <hr> <h2 id=database-connection-problems>Database Connection Problems<a class=headerlink href=#database-connection-problems title="Permanent link">&para;</a></h2> <h3 id=issue-postgresql-connection-refused>Issue: PostgreSQL Connection Refused<a class=headerlink href=#issue-postgresql-connection-refused title="Permanent link">&para;</a></h3> <p><strong>Problem Description:</strong> Application cannot connect to PostgreSQL database.</p> <p><strong>Symptoms:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>PrismaClientInitializationError:<span class=w> </span>Can<span class=err>&#39;</span>t<span class=w> </span>reach<span class=w> </span>database<span class=w> </span>server
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>Error:<span class=w> </span>connect<span class=w> </span>ECONNREFUSED<span class=w> </span><span class=m>127</span>.0.0.1:5432
</span></code></pre></div></p> <p><strong>Root Cause Analysis:</strong> - PostgreSQL service not running - Incorrect database URL - Firewall blocking connection - Wrong database credentials</p> <p><strong>Step-by-step Solution:</strong> 1. Check PostgreSQL service status: <div class="language-bash highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=c1># macOS with Homebrew</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>brew<span class=w> </span>services<span class=w> </span>list<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>postgresql
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>brew<span class=w> </span>services<span class=w> </span>start<span class=w> </span>postgresql@14
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=c1># Linux systemd</span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>sudo<span class=w> </span>systemctl<span class=w> </span>status<span class=w> </span>postgresql
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a>sudo<span class=w> </span>systemctl<span class=w> </span>start<span class=w> </span>postgresql
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a>
</span><span id=__span-11-9><a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=c1># Docker</span>
</span><span id=__span-11-10><a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a>docker<span class=w> </span>ps<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>postgres
</span><span id=__span-11-11><a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a>docker<span class=w> </span>start<span class=w> </span>postgres-container
</span></code></pre></div></p> <ol> <li> <p>Verify database URL format: <div class="language-bash highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=c1># Correct format</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=nv>DATABASE_URL</span><span class=o>=</span><span class=s2>&quot;postgresql://username:password@localhost:5432/database_name&quot;</span>
</span></code></pre></div></p> </li> <li> <p>Test direct connection: <div class="language-bash highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a>psql<span class=w> </span>-h<span class=w> </span>localhost<span class=w> </span>-p<span class=w> </span><span class=m>5432</span><span class=w> </span>-U<span class=w> </span>username<span class=w> </span>-d<span class=w> </span>database_name
</span></code></pre></div></p> </li> <li> <p>Check database existence: <div class="language-bash highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a>psql<span class=w> </span>-U<span class=w> </span>postgres<span class=w> </span>-c<span class=w> </span><span class=s2>&quot;\l&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>your_database
</span></code></pre></div></p> </li> <li> <p>Create database if missing: <div class="language-bash highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a>createdb<span class=w> </span>-U<span class=w> </span>postgres<span class=w> </span>your_database_name
</span></code></pre></div></p> </li> </ol> <p><strong>Prevention Tips:</strong> - Use Docker Compose for consistent database setup - Implement database health checks - Monitor database service status</p> <p><strong>Related Issues:</strong> - <a href=#environment-variable-problems>Environment Variable Problems</a> - <a href=#production-deployment-issues>Production Deployment Issues</a></p> <hr> <h3 id=issue-database-schema-out-of-sync>Issue: Database Schema Out of Sync<a class=headerlink href=#issue-database-schema-out-of-sync title="Permanent link">&para;</a></h3> <p><strong>Problem Description:</strong> Database schema doesn't match Prisma schema, causing query failures.</p> <p><strong>Symptoms:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a>PrismaClientValidationError:<span class=w> </span>Invalid<span class=w> </span><span class=sb>`</span>prisma.client.findUnique<span class=o>()</span><span class=sb>`</span><span class=w> </span>invocation
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>Table<span class=w> </span><span class=s1>&#39;Client&#39;</span><span class=w> </span>doesn<span class=err>&#39;</span>t<span class=w> </span>exist<span class=w> </span><span class=k>in</span><span class=w> </span>the<span class=w> </span>current<span class=w> </span>database
</span></code></pre></div></p> <p><strong>Root Cause Analysis:</strong> - Schema changes not applied to database - Missing migrations - Database reset without applying schema</p> <p><strong>Step-by-step Solution:</strong> 1. Check current database schema: <div class="language-bash highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a>pnpm<span class=w> </span>prisma<span class=w> </span>db<span class=w> </span>pull
</span></code></pre></div></p> <ol> <li> <p>Generate and apply migration: <div class="language-bash highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a>pnpm<span class=w> </span>prisma<span class=w> </span>migrate<span class=w> </span>dev<span class=w> </span>--name<span class=w> </span>init
</span></code></pre></div></p> </li> <li> <p>Force push schema (development only): <div class="language-bash highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a>pnpm<span class=w> </span>prisma<span class=w> </span>db<span class=w> </span>push
</span></code></pre></div></p> </li> <li> <p>Reset database and reapply schema: <div class="language-bash highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a>pnpm<span class=w> </span>prisma<span class=w> </span>migrate<span class=w> </span>reset
</span></code></pre></div></p> </li> <li> <p>Verify schema sync: <div class="language-bash highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a>pnpm<span class=w> </span>prisma<span class=w> </span>studio
</span></code></pre></div></p> </li> </ol> <p><strong>Prevention Tips:</strong> - Always create migrations for schema changes - Use <code>prisma migrate dev</code> in development - Use <code>prisma migrate deploy</code> in production</p> <hr> <h2 id=oauth-flow-errors>OAuth Flow Errors<a class=headerlink href=#oauth-flow-errors title="Permanent link">&para;</a></h2> <h3 id=issue-invalid-client-error>Issue: Invalid Client Error<a class=headerlink href=#issue-invalid-client-error title="Permanent link">&para;</a></h3> <p><strong>Problem Description:</strong> OAuth authorization fails with "invalid_client" error.</p> <p><strong>Symptoms:</strong> <div class="language-json highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=p>{</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=w>  </span><span class=nt>&quot;error&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;invalid_client&quot;</span><span class=p>,</span>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=w>  </span><span class=nt>&quot;error_description&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Client authentication failed&quot;</span>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=p>}</span>
</span></code></pre></div></p> <p><strong>Root Cause Analysis:</strong> - Client not registered in database - Incorrect client_id or client_secret - Client registration incomplete</p> <p><strong>Step-by-step Solution:</strong> 1. Verify client exists in database: <div class="language-bash highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a>pnpm<span class=w> </span>prisma<span class=w> </span>studio
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=c1># Check Client table for your client_id</span>
</span></code></pre></div></p> <ol> <li> <p>Register new OAuth client: <div class="language-bash highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a>curl<span class=w> </span>-X<span class=w> </span>POST<span class=w> </span>http://localhost:3000/api/oauth/register<span class=w> </span><span class=se>\</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=w>  </span>-H<span class=w> </span><span class=s2>&quot;Content-Type: application/json&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=w>  </span>-d<span class=w> </span><span class=s1>&#39;{</span>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=s1>    &quot;name&quot;: &quot;Test Client&quot;,</span>
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=s1>    &quot;redirectUris&quot;: [&quot;http://localhost:8080/callback&quot;]</span>
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a><span class=s1>  }&#39;</span>
</span></code></pre></div></p> </li> <li> <p>Check client credentials: <div class="language-sql highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=k>SELECT</span><span class=w> </span><span class=n>clientId</span><span class=p>,</span><span class=w> </span><span class=n>clientSecret</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>Client</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>clientId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;your-client-id&#39;</span><span class=p>;</span>
</span></code></pre></div></p> </li> <li> <p>Verify redirect URI matches registration: <div class="language-sql highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=k>SELECT</span><span class=w> </span><span class=n>redirectUris</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>Client</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>clientId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;your-client-id&#39;</span><span class=p>;</span>
</span></code></pre></div></p> </li> </ol> <p><strong>Prevention Tips:</strong> - Store client credentials securely - Validate redirect URIs during registration - Implement client credential rotation</p> <p><strong>Related Issues:</strong> - <a href=#authentication-failures>Authentication Failures</a> - <a href=#security-related-errors>Security-Related Errors</a></p> <hr> <h3 id=issue-pkce-validation-failure>Issue: PKCE Validation Failure<a class=headerlink href=#issue-pkce-validation-failure title="Permanent link">&para;</a></h3> <p><strong>Problem Description:</strong> Authorization code exchange fails with PKCE validation error.</p> <p><strong>Symptoms:</strong> <div class="language-json highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=p>{</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=w>  </span><span class=nt>&quot;error&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;invalid_grant&quot;</span><span class=p>,</span>
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a><span class=w>  </span><span class=nt>&quot;error_description&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;PKCE validation failed&quot;</span>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=p>}</span>
</span></code></pre></div></p> <p><strong>Root Cause Analysis:</strong> - Code verifier doesn't match code challenge - Incorrect PKCE method (S256 vs plain) - Missing code_verifier in token request</p> <p><strong>Step-by-step Solution:</strong> 1. Verify PKCE implementation in client: <div class="language-javascript highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=c1>// Generate code verifier</span>
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a><span class=kd>const</span><span class=w> </span><span class=nx>codeVerifier</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>crypto</span><span class=p>.</span><span class=nx>randomBytes</span><span class=p>(</span><span class=mf>32</span><span class=p>).</span><span class=nx>toString</span><span class=p>(</span><span class=s1>&#39;base64url&#39;</span><span class=p>);</span>
</span><span id=__span-28-3><a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a>
</span><span id=__span-28-4><a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a><span class=c1>// Generate code challenge (S256)</span>
</span><span id=__span-28-5><a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a><span class=kd>const</span><span class=w> </span><span class=nx>codeChallenge</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>crypto</span>
</span><span id=__span-28-6><a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a><span class=w>  </span><span class=p>.</span><span class=nx>createHash</span><span class=p>(</span><span class=s1>&#39;sha256&#39;</span><span class=p>)</span>
</span><span id=__span-28-7><a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a><span class=w>  </span><span class=p>.</span><span class=nx>update</span><span class=p>(</span><span class=nx>codeVerifier</span><span class=p>)</span>
</span><span id=__span-28-8><a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a><span class=w>  </span><span class=p>.</span><span class=nx>digest</span><span class=p>(</span><span class=s1>&#39;base64url&#39;</span><span class=p>);</span>
</span></code></pre></div></p> <ol> <li> <p>Check authorization request includes PKCE: <div class="language-http highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=err>GET /oauth/authorize?</span>
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=err>  response_type=code&amp;</span>
</span><span id=__span-29-3><a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=err>  client_id=your-client-id&amp;</span>
</span><span id=__span-29-4><a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=err>  redirect_uri=http://localhost:8080/callback&amp;</span>
</span><span id=__span-29-5><a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a><span class=err>  code_challenge=CODE_CHALLENGE&amp;</span>
</span><span id=__span-29-6><a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a><span class=err>  code_challenge_method=S256</span>
</span></code></pre></div></p> </li> <li> <p>Include code_verifier in token request: <div class="language-http highlight"><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=err>POST /api/oauth/token</span>
</span><span id=__span-30-2><a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a><span class=err>Content-Type: application/x-www-form-urlencoded</span>
</span><span id=__span-30-3><a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a>
</span><span id=__span-30-4><a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a><span class=err>grant_type=authorization_code&amp;</span>
</span><span id=__span-30-5><a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a><span class=err>code=AUTH_CODE&amp;</span>
</span><span id=__span-30-6><a id=__codelineno-30-6 name=__codelineno-30-6 href=#__codelineno-30-6></a><span class=err>client_id=CLIENT_ID&amp;</span>
</span><span id=__span-30-7><a id=__codelineno-30-7 name=__codelineno-30-7 href=#__codelineno-30-7></a><span class=err>redirect_uri=REDIRECT_URI&amp;</span>
</span><span id=__span-30-8><a id=__codelineno-30-8 name=__codelineno-30-8 href=#__codelineno-30-8></a><span class=err>code_verifier=CODE_VERIFIER</span>
</span></code></pre></div></p> </li> <li> <p>Debug PKCE validation in server logs: <div class="language-bash highlight"><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=c1># Check server console output during token exchange</span>
</span><span id=__span-31-2><a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a>tail<span class=w> </span>-f<span class=w> </span>logs/oauth.log
</span></code></pre></div></p> </li> </ol> <p><strong>Prevention Tips:</strong> - Use established OAuth libraries for PKCE - Test PKCE flow with different clients - Implement comprehensive PKCE logging</p> <hr> <h2 id=mcp-client-integration-issues>MCP Client Integration Issues<a class=headerlink href=#mcp-client-integration-issues title="Permanent link">&para;</a></h2> <h3 id=issue-mcp-client-authentication-fails>Issue: MCP Client Authentication Fails<a class=headerlink href=#issue-mcp-client-authentication-fails title="Permanent link">&para;</a></h3> <p><strong>Problem Description:</strong> MCP client cannot authenticate with the server using OAuth tokens.</p> <p><strong>Symptoms:</strong> <div class="language-json highlight"><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=p>{</span>
</span><span id=__span-32-2><a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a><span class=w>  </span><span class=nt>&quot;error&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Unauthorized&quot;</span><span class=p>,</span>
</span><span id=__span-32-3><a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a><span class=w>  </span><span class=nt>&quot;status&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>401</span>
</span><span id=__span-32-4><a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a><span class=p>}</span>
</span></code></pre></div></p> <p><strong>Root Cause Analysis:</strong> - Invalid or expired access token - Missing Authorization header - Token audience mismatch - Incorrect token format</p> <p><strong>Step-by-step Solution:</strong> 1. Verify token is included in request: <div class="language-bash highlight"><pre><span></span><code><span id=__span-33-1><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a>curl<span class=w> </span>-X<span class=w> </span>POST<span class=w> </span>http://localhost:3000/mcp/sse<span class=w> </span><span class=se>\</span>
</span><span id=__span-33-2><a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a><span class=w>  </span>-H<span class=w> </span><span class=s2>&quot;Authorization: Bearer YOUR_ACCESS_TOKEN&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-33-3><a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a><span class=w>  </span>-H<span class=w> </span><span class=s2>&quot;Content-Type: application/json&quot;</span>
</span></code></pre></div></p> <ol> <li> <p>Check token validity in database: <div class="language-sql highlight"><pre><span></span><code><span id=__span-34-1><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=k>SELECT</span><span class=w> </span><span class=n>token</span><span class=p>,</span><span class=w> </span><span class=n>expiresAt</span><span class=p>,</span><span class=w> </span><span class=n>resource</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>AccessToken</span><span class=w> </span>
</span><span id=__span-34-2><a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a><span class=k>WHERE</span><span class=w> </span><span class=n>token</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;your-access-token&#39;</span><span class=p>;</span>
</span></code></pre></div></p> </li> <li> <p>Verify token audience/resource: <div class="language-javascript highlight"><pre><span></span><code><span id=__span-35-1><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=c1>// Token should be issued for correct resource</span>
</span><span id=__span-35-2><a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a><span class=kd>const</span><span class=w> </span><span class=nx>expectedResource</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;http://localhost:3000&quot;</span><span class=p>;</span>
</span></code></pre></div></p> </li> <li> <p>Check MCP server logs: <div class="language-bash highlight"><pre><span></span><code><span id=__span-36-1><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=c1># Look for authentication debug logs</span>
</span><span id=__span-36-2><a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a><span class=o>[</span>MCP<span class=o>]</span><span class=w> </span>Auth<span class=w> </span>header<span class=w> </span>present:<span class=w> </span><span class=nb>true</span>
</span><span id=__span-36-3><a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a><span class=o>[</span>MCP<span class=o>]</span><span class=w> </span>Token<span class=w> </span>extracted:<span class=w> </span>present
</span><span id=__span-36-4><a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a><span class=o>[</span>MCP<span class=o>]</span><span class=w> </span>Access<span class=w> </span>token<span class=w> </span>found:<span class=w> </span><span class=nb>true</span>
</span><span id=__span-36-5><a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a><span class=o>[</span>MCP<span class=o>]</span><span class=w> </span>Authentication<span class=w> </span>successful,<span class=w> </span>audience<span class=w> </span>validated
</span></code></pre></div></p> </li> <li> <p>Test with fresh token: <div class="language-bash highlight"><pre><span></span><code><span id=__span-37-1><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=c1># Get new token through OAuth flow</span>
</span><span id=__span-37-2><a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a><span class=c1># Or use test endpoint if available</span>
</span></code></pre></div></p> </li> </ol> <p><strong>Prevention Tips:</strong> - Implement token refresh logic in MCP client - Use proper token storage and retrieval - Monitor token expiration times</p> <p><strong>Related Issues:</strong> - <a href=#authentication-failures>Authentication Failures</a> - <a href=#oauth-flow-errors>OAuth Flow Errors</a></p> <hr> <h3 id=issue-mcp-transport-configuration>Issue: MCP Transport Configuration<a class=headerlink href=#issue-mcp-transport-configuration title="Permanent link">&para;</a></h3> <p><strong>Problem Description:</strong> MCP client cannot establish connection using SSE or HTTP transport.</p> <p><strong>Symptoms:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-38-1><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a>Connection<span class=w> </span>failed:<span class=w> </span>ERR_CONNECTION_REFUSED
</span><span id=__span-38-2><a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a>WebSocket<span class=w> </span>connection<span class=w> </span>failed
</span><span id=__span-38-3><a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a>SSE<span class=w> </span>connection<span class=w> </span>timeout
</span></code></pre></div></p> <p><strong>Root Cause Analysis:</strong> - Incorrect transport URL - CORS configuration issues - Network connectivity problems - Server not supporting requested transport</p> <p><strong>Step-by-step Solution:</strong> 1. Verify MCP server endpoints: <div class="language-bash highlight"><pre><span></span><code><span id=__span-39-1><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=c1># SSE transport</span>
</span><span id=__span-39-2><a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a>curl<span class=w> </span>http://localhost:3000/mcp/sse
</span><span id=__span-39-3><a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a>
</span><span id=__span-39-4><a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a><span class=c1># HTTP transport  </span>
</span><span id=__span-39-5><a id=__codelineno-39-5 name=__codelineno-39-5 href=#__codelineno-39-5></a>curl<span class=w> </span>http://localhost:3000/mcp/mcp
</span></code></pre></div></p> <ol> <li> <p>Check CORS headers: <div class="language-bash highlight"><pre><span></span><code><span id=__span-40-1><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a>curl<span class=w> </span>-H<span class=w> </span><span class=s2>&quot;Origin: http://localhost:8080&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-40-2><a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a><span class=w>     </span>-H<span class=w> </span><span class=s2>&quot;Access-Control-Request-Method: POST&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-40-3><a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a><span class=w>     </span>-H<span class=w> </span><span class=s2>&quot;Access-Control-Request-Headers: Content-Type,Authorization&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-40-4><a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a><span class=w>     </span>-X<span class=w> </span>OPTIONS<span class=w> </span><span class=se>\</span>
</span><span id=__span-40-5><a id=__codelineno-40-5 name=__codelineno-40-5 href=#__codelineno-40-5></a><span class=w>     </span>http://localhost:3000/mcp/sse
</span></code></pre></div></p> </li> <li> <p>Test transport with authentication: <div class="language-bash highlight"><pre><span></span><code><span id=__span-41-1><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a>curl<span class=w> </span>-X<span class=w> </span>POST<span class=w> </span>http://localhost:3000/mcp/sse<span class=w> </span><span class=se>\</span>
</span><span id=__span-41-2><a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a><span class=w>  </span>-H<span class=w> </span><span class=s2>&quot;Authorization: Bearer TOKEN&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-41-3><a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a><span class=w>  </span>-H<span class=w> </span><span class=s2>&quot;Content-Type: application/json&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-41-4><a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a><span class=w>  </span>-d<span class=w> </span><span class=s1>&#39;{&quot;method&quot;: &quot;tools/list&quot;, &quot;params&quot;: {}}&#39;</span>
</span></code></pre></div></p> </li> <li> <p>Configure client transport properly: <div class="language-javascript highlight"><pre><span></span><code><span id=__span-42-1><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=c1>// SSE transport</span>
</span><span id=__span-42-2><a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a><span class=kd>const</span><span class=w> </span><span class=nx>transport</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>StdioServerTransport</span><span class=p>({</span>
</span><span id=__span-42-3><a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a><span class=w>  </span><span class=nx>command</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;curl&#39;</span><span class=p>,</span>
</span><span id=__span-42-4><a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a><span class=w>  </span><span class=nx>args</span><span class=o>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;-N&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;-H&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Authorization: Bearer TOKEN&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;http://localhost:3000/mcp/sse&#39;</span><span class=p>]</span>
</span><span id=__span-42-5><a id=__codelineno-42-5 name=__codelineno-42-5 href=#__codelineno-42-5></a><span class=p>});</span>
</span><span id=__span-42-6><a id=__codelineno-42-6 name=__codelineno-42-6 href=#__codelineno-42-6></a>
</span><span id=__span-42-7><a id=__codelineno-42-7 name=__codelineno-42-7 href=#__codelineno-42-7></a><span class=c1>// HTTP transport</span>
</span><span id=__span-42-8><a id=__codelineno-42-8 name=__codelineno-42-8 href=#__codelineno-42-8></a><span class=kd>const</span><span class=w> </span><span class=nx>client</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>Client</span><span class=p>({</span>
</span><span id=__span-42-9><a id=__codelineno-42-9 name=__codelineno-42-9 href=#__codelineno-42-9></a><span class=w>  </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;test-client&#39;</span><span class=p>,</span>
</span><span id=__span-42-10><a id=__codelineno-42-10 name=__codelineno-42-10 href=#__codelineno-42-10></a><span class=w>  </span><span class=nx>version</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;1.0.0&#39;</span>
</span><span id=__span-42-11><a id=__codelineno-42-11 name=__codelineno-42-11 href=#__codelineno-42-11></a><span class=p>},</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-42-12><a id=__codelineno-42-12 name=__codelineno-42-12 href=#__codelineno-42-12></a><span class=w>  </span><span class=nx>capabilities</span><span class=o>:</span><span class=w> </span><span class=p>{}</span>
</span><span id=__span-42-13><a id=__codelineno-42-13 name=__codelineno-42-13 href=#__codelineno-42-13></a><span class=p>});</span>
</span></code></pre></div></p> </li> </ol> <p><strong>Prevention Tips:</strong> - Test both SSE and HTTP transports - Implement proper error handling in client - Use connection pooling for HTTP transport</p> <hr> <h2 id=authentication-failures>Authentication Failures<a class=headerlink href=#authentication-failures title="Permanent link">&para;</a></h2> <h3 id=issue-nextauth-google-oauth-not-working>Issue: NextAuth Google OAuth Not Working<a class=headerlink href=#issue-nextauth-google-oauth-not-working title="Permanent link">&para;</a></h3> <p><strong>Problem Description:</strong> Users cannot sign in with Google OAuth provider.</p> <p><strong>Symptoms:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-43-1><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a>OAuthCallbackError:<span class=w> </span>OAuth<span class=w> </span>account<span class=w> </span>was<span class=w> </span>not<span class=w> </span>linked
</span><span id=__span-43-2><a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a>Error:<span class=w> </span>Configuration<span class=w> </span>is<span class=w> </span>invalid
</span></code></pre></div></p> <p><strong>Root Cause Analysis:</strong> - Invalid Google OAuth credentials - Incorrect redirect URI configuration - Missing OAuth consent screen setup - Domain verification issues</p> <p><strong>Step-by-step Solution:</strong> 1. Verify Google OAuth configuration: <div class="language-bash highlight"><pre><span></span><code><span id=__span-44-1><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=c1># Check environment variables</span>
</span><span id=__span-44-2><a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a><span class=nb>echo</span><span class=w> </span><span class=nv>$GOOGLE_CLIENT_ID</span>
</span><span id=__span-44-3><a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a><span class=nb>echo</span><span class=w> </span><span class=nv>$GOOGLE_CLIENT_SECRET</span>
</span></code></pre></div></p> <ol> <li>Check Google Cloud Console settings:</li> <li>OAuth 2.0 Client IDs properly configured</li> <li>Authorized redirect URIs include: <code>http://localhost:3000/api/auth/callback/google</code></li> <li> <p>OAuth consent screen configured</p> </li> <li> <p>Verify NextAuth configuration: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-45-1><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a><span class=c1>// app/auth.ts</span>
</span><span id=__span-45-2><a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a><span class=k>export</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>handlers</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>GET</span><span class=p>,</span><span class=w> </span><span class=nx>POST</span><span class=w> </span><span class=p>},</span><span class=w> </span><span class=nx>auth</span><span class=p>,</span><span class=w> </span><span class=nx>signIn</span><span class=p>,</span><span class=w> </span><span class=nx>signOut</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>NextAuth</span><span class=p>({</span>
</span><span id=__span-45-3><a id=__codelineno-45-3 name=__codelineno-45-3 href=#__codelineno-45-3></a><span class=w>  </span><span class=nx>adapter</span><span class=o>:</span><span class=w> </span><span class=kt>PrismaAdapter</span><span class=p>(</span><span class=nx>prisma</span><span class=p>),</span>
</span><span id=__span-45-4><a id=__codelineno-45-4 name=__codelineno-45-4 href=#__codelineno-45-4></a><span class=w>  </span><span class=nx>providers</span><span class=o>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-45-5><a id=__codelineno-45-5 name=__codelineno-45-5 href=#__codelineno-45-5></a><span class=w>    </span><span class=nx>Google</span><span class=p>({</span>
</span><span id=__span-45-6><a id=__codelineno-45-6 name=__codelineno-45-6 href=#__codelineno-45-6></a><span class=w>      </span><span class=nx>clientId</span><span class=o>:</span><span class=w> </span><span class=kt>process.env.GOOGLE_CLIENT_ID</span><span class=o>!</span><span class=p>,</span>
</span><span id=__span-45-7><a id=__codelineno-45-7 name=__codelineno-45-7 href=#__codelineno-45-7></a><span class=w>      </span><span class=nx>clientSecret</span><span class=o>:</span><span class=w> </span><span class=kt>process.env.GOOGLE_CLIENT_SECRET</span><span class=o>!</span><span class=p>,</span>
</span><span id=__span-45-8><a id=__codelineno-45-8 name=__codelineno-45-8 href=#__codelineno-45-8></a><span class=w>    </span><span class=p>}),</span>
</span><span id=__span-45-9><a id=__codelineno-45-9 name=__codelineno-45-9 href=#__codelineno-45-9></a><span class=w>  </span><span class=p>],</span>
</span><span id=__span-45-10><a id=__codelineno-45-10 name=__codelineno-45-10 href=#__codelineno-45-10></a><span class=w>  </span><span class=nx>trustHost</span><span class=o>:</span><span class=w> </span><span class=kt>true</span><span class=p>,</span><span class=w> </span><span class=c1>// Important for localhost</span>
</span><span id=__span-45-11><a id=__codelineno-45-11 name=__codelineno-45-11 href=#__codelineno-45-11></a><span class=p>});</span>
</span></code></pre></div></p> </li> <li> <p>Test OAuth flow manually: <div class="language-bash highlight"><pre><span></span><code><span id=__span-46-1><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a><span class=c1># Visit in browser</span>
</span><span id=__span-46-2><a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a>http://localhost:3000/api/auth/signin
</span></code></pre></div></p> </li> <li> <p>Check NextAuth debug logs: <div class="language-bash highlight"><pre><span></span><code><span id=__span-47-1><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a><span class=c1># Set debug mode</span>
</span><span id=__span-47-2><a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a><span class=nb>export</span><span class=w> </span><span class=nv>NEXTAUTH_DEBUG</span><span class=o>=</span><span class=nb>true</span>
</span><span id=__span-47-3><a id=__codelineno-47-3 name=__codelineno-47-3 href=#__codelineno-47-3></a>pnpm<span class=w> </span>dev
</span></code></pre></div></p> </li> </ol> <p><strong>Prevention Tips:</strong> - Keep OAuth credentials secure and up to date - Test OAuth flow in different environments - Monitor Google Cloud Console for API usage</p> <p><strong>Related Issues:</strong> - <a href=#environment-variable-problems>Environment Variable Problems</a> - <a href=#security-related-errors>Security-Related Errors</a></p> <hr> <h3 id=issue-session-management-problems>Issue: Session Management Problems<a class=headerlink href=#issue-session-management-problems title="Permanent link">&para;</a></h3> <p><strong>Problem Description:</strong> User sessions not persisting or invalid session errors.</p> <p><strong>Symptoms:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-48-1><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a>SessionRequiredError:<span class=w> </span>Please<span class=w> </span>add<span class=w> </span>a<span class=w> </span><span class=sb>`</span>session<span class=sb>`</span><span class=w> </span>callback
</span><span id=__span-48-2><a id=__codelineno-48-2 name=__codelineno-48-2 href=#__codelineno-48-2></a>Invalid<span class=w> </span>session<span class=w> </span>token
</span><span id=__span-48-3><a id=__codelineno-48-3 name=__codelineno-48-3 href=#__codelineno-48-3></a>User<span class=w> </span>session<span class=w> </span>expired<span class=w> </span>unexpectedly
</span></code></pre></div></p> <p><strong>Root Cause Analysis:</strong> - Database session storage issues - Session token corruption - Clock synchronization problems - Session cleanup job removing active sessions</p> <p><strong>Step-by-step Solution:</strong> 1. Check session in database: <div class="language-sql highlight"><pre><span></span><code><span id=__span-49-1><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a><span class=k>SELECT</span><span class=w> </span><span class=n>sessionToken</span><span class=p>,</span><span class=w> </span><span class=n>expires</span><span class=p>,</span><span class=w> </span><span class=n>userId</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>Session</span><span class=w> </span>
</span><span id=__span-49-2><a id=__codelineno-49-2 name=__codelineno-49-2 href=#__codelineno-49-2></a><span class=k>WHERE</span><span class=w> </span><span class=n>sessionToken</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;session-token&#39;</span><span class=p>;</span>
</span></code></pre></div></p> <ol> <li> <p>Verify session callback: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-50-1><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a><span class=c1>// app/auth.ts</span>
</span><span id=__span-50-2><a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a><span class=k>export</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>...</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>NextAuth</span><span class=p>({</span>
</span><span id=__span-50-3><a id=__codelineno-50-3 name=__codelineno-50-3 href=#__codelineno-50-3></a><span class=w>  </span><span class=c1>// ... other config</span>
</span><span id=__span-50-4><a id=__codelineno-50-4 name=__codelineno-50-4 href=#__codelineno-50-4></a><span class=w>  </span><span class=nx>callbacks</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-50-5><a id=__codelineno-50-5 name=__codelineno-50-5 href=#__codelineno-50-5></a><span class=w>    </span><span class=nx>session</span><span class=o>:</span><span class=w> </span><span class=kt>async</span><span class=w> </span><span class=p>({</span><span class=w> </span><span class=nx>session</span><span class=p>,</span><span class=w> </span><span class=nx>token</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-50-6><a id=__codelineno-50-6 name=__codelineno-50-6 href=#__codelineno-50-6></a><span class=w>      </span><span class=k>return</span><span class=w> </span><span class=nx>session</span><span class=p>;</span>
</span><span id=__span-50-7><a id=__codelineno-50-7 name=__codelineno-50-7 href=#__codelineno-50-7></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-50-8><a id=__codelineno-50-8 name=__codelineno-50-8 href=#__codelineno-50-8></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-50-9><a id=__codelineno-50-9 name=__codelineno-50-9 href=#__codelineno-50-9></a><span class=p>});</span>
</span></code></pre></div></p> </li> <li> <p>Check system clock: <div class="language-bash highlight"><pre><span></span><code><span id=__span-51-1><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a>date
</span><span id=__span-51-2><a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a><span class=c1># Ensure server time is correct</span>
</span></code></pre></div></p> </li> <li> <p>Monitor session cleanup: <div class="language-bash highlight"><pre><span></span><code><span id=__span-52-1><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a><span class=c1># Check if cleanup job is too aggressive</span>
</span><span id=__span-52-2><a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a>tail<span class=w> </span>-f<span class=w> </span>logs/cleanup.log
</span></code></pre></div></p> </li> </ol> <p><strong>Prevention Tips:</strong> - Implement proper session monitoring - Use appropriate session expiration times - Handle session refresh gracefully</p> <hr> <h2 id=api-endpoint-errors>API Endpoint Errors<a class=headerlink href=#api-endpoint-errors title="Permanent link">&para;</a></h2> <h3 id=issue-cors-errors-in-browser>Issue: CORS Errors in Browser<a class=headerlink href=#issue-cors-errors-in-browser title="Permanent link">&para;</a></h3> <p><strong>Problem Description:</strong> Browser requests to API endpoints fail with CORS errors.</p> <p><strong>Symptoms:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-53-1><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a>Access<span class=w> </span>to<span class=w> </span>fetch<span class=w> </span>at<span class=w> </span><span class=s1>&#39;http://localhost:3000/api/oauth/token&#39;</span><span class=w> </span>from<span class=w> </span>origin<span class=w> </span><span class=s1>&#39;http://localhost:8080&#39;</span><span class=w> </span>has<span class=w> </span>been<span class=w> </span>blocked<span class=w> </span>by<span class=w> </span>CORS<span class=w> </span>policy
</span></code></pre></div></p> <p><strong>Root Cause Analysis:</strong> - Missing CORS headers - Incorrect CORS configuration - Preflight request failures - Origin not allowed</p> <p><strong>Step-by-step Solution:</strong> 1. Check CORS headers in API response: <div class="language-bash highlight"><pre><span></span><code><span id=__span-54-1><a id=__codelineno-54-1 name=__codelineno-54-1 href=#__codelineno-54-1></a>curl<span class=w> </span>-I<span class=w> </span>-H<span class=w> </span><span class=s2>&quot;Origin: http://localhost:8080&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-54-2><a id=__codelineno-54-2 name=__codelineno-54-2 href=#__codelineno-54-2></a><span class=w>     </span>http://localhost:3000/api/oauth/token
</span></code></pre></div></p> <ol> <li> <p>Verify OPTIONS method handler: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-55-1><a id=__codelineno-55-1 name=__codelineno-55-1 href=#__codelineno-55-1></a><span class=c1>// In API route</span>
</span><span id=__span-55-2><a id=__codelineno-55-2 name=__codelineno-55-2 href=#__codelineno-55-2></a><span class=k>export</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>OPTIONS</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-55-3><a id=__codelineno-55-3 name=__codelineno-55-3 href=#__codelineno-55-3></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>NextResponse</span><span class=p>(</span><span class=s2>&quot;OK&quot;</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-55-4><a id=__codelineno-55-4 name=__codelineno-55-4 href=#__codelineno-55-4></a><span class=w>    </span><span class=nx>status</span><span class=o>:</span><span class=w> </span><span class=kt>200</span><span class=p>,</span>
</span><span id=__span-55-5><a id=__codelineno-55-5 name=__codelineno-55-5 href=#__codelineno-55-5></a><span class=w>    </span><span class=nx>headers</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-55-6><a id=__codelineno-55-6 name=__codelineno-55-6 href=#__codelineno-55-6></a><span class=w>      </span><span class=s1>&#39;Access-Control-Allow-Origin&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;*&#39;</span><span class=p>,</span>
</span><span id=__span-55-7><a id=__codelineno-55-7 name=__codelineno-55-7 href=#__codelineno-55-7></a><span class=w>      </span><span class=s1>&#39;Access-Control-Allow-Methods&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;POST, OPTIONS&#39;</span><span class=p>,</span>
</span><span id=__span-55-8><a id=__codelineno-55-8 name=__codelineno-55-8 href=#__codelineno-55-8></a><span class=w>      </span><span class=s1>&#39;Access-Control-Allow-Headers&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Content-Type, Authorization&#39;</span><span class=p>,</span>
</span><span id=__span-55-9><a id=__codelineno-55-9 name=__codelineno-55-9 href=#__codelineno-55-9></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-55-10><a id=__codelineno-55-10 name=__codelineno-55-10 href=#__codelineno-55-10></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-55-11><a id=__codelineno-55-11 name=__codelineno-55-11 href=#__codelineno-55-11></a><span class=p>}</span>
</span></code></pre></div></p> </li> <li> <p>Add CORS to all responses: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-56-1><a id=__codelineno-56-1 name=__codelineno-56-1 href=#__codelineno-56-1></a><span class=kd>function</span><span class=w> </span><span class=nx>getCorsHeaders</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-56-2><a id=__codelineno-56-2 name=__codelineno-56-2 href=#__codelineno-56-2></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-56-3><a id=__codelineno-56-3 name=__codelineno-56-3 href=#__codelineno-56-3></a><span class=w>    </span><span class=s1>&#39;Access-Control-Allow-Origin&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;*&#39;</span><span class=p>,</span>
</span><span id=__span-56-4><a id=__codelineno-56-4 name=__codelineno-56-4 href=#__codelineno-56-4></a><span class=w>    </span><span class=s1>&#39;Access-Control-Allow-Methods&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;POST, GET, OPTIONS&#39;</span><span class=p>,</span>
</span><span id=__span-56-5><a id=__codelineno-56-5 name=__codelineno-56-5 href=#__codelineno-56-5></a><span class=w>    </span><span class=s1>&#39;Access-Control-Allow-Headers&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Content-Type, Authorization&#39;</span><span class=p>,</span>
</span><span id=__span-56-6><a id=__codelineno-56-6 name=__codelineno-56-6 href=#__codelineno-56-6></a><span class=w>  </span><span class=p>};</span>
</span><span id=__span-56-7><a id=__codelineno-56-7 name=__codelineno-56-7 href=#__codelineno-56-7></a><span class=p>}</span>
</span></code></pre></div></p> </li> <li> <p>Test preflight request: <div class="language-bash highlight"><pre><span></span><code><span id=__span-57-1><a id=__codelineno-57-1 name=__codelineno-57-1 href=#__codelineno-57-1></a>curl<span class=w> </span>-X<span class=w> </span>OPTIONS<span class=w> </span><span class=se>\</span>
</span><span id=__span-57-2><a id=__codelineno-57-2 name=__codelineno-57-2 href=#__codelineno-57-2></a><span class=w>     </span>-H<span class=w> </span><span class=s2>&quot;Origin: http://localhost:8080&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-57-3><a id=__codelineno-57-3 name=__codelineno-57-3 href=#__codelineno-57-3></a><span class=w>     </span>-H<span class=w> </span><span class=s2>&quot;Access-Control-Request-Method: POST&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-57-4><a id=__codelineno-57-4 name=__codelineno-57-4 href=#__codelineno-57-4></a><span class=w>     </span>-H<span class=w> </span><span class=s2>&quot;Access-Control-Request-Headers: Content-Type,Authorization&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-57-5><a id=__codelineno-57-5 name=__codelineno-57-5 href=#__codelineno-57-5></a><span class=w>     </span>http://localhost:3000/api/oauth/token
</span></code></pre></div></p> </li> </ol> <p><strong>Prevention Tips:</strong> - Use middleware for consistent CORS handling - Test API endpoints from different origins - Document CORS requirements for clients</p> <p><strong>Related Issues:</strong> - <a href=#mcp-client-integration-issues>MCP Client Integration Issues</a> - <a href=#production-deployment-issues>Production Deployment Issues</a></p> <hr> <h3 id=issue-api-rate-limiting-errors>Issue: API Rate Limiting Errors<a class=headerlink href=#issue-api-rate-limiting-errors title="Permanent link">&para;</a></h3> <p><strong>Problem Description:</strong> API requests fail due to rate limiting restrictions.</p> <p><strong>Symptoms:</strong> <div class="language-json highlight"><pre><span></span><code><span id=__span-58-1><a id=__codelineno-58-1 name=__codelineno-58-1 href=#__codelineno-58-1></a><span class=p>{</span>
</span><span id=__span-58-2><a id=__codelineno-58-2 name=__codelineno-58-2 href=#__codelineno-58-2></a><span class=w>  </span><span class=nt>&quot;error&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;rate_limit_exceeded&quot;</span><span class=p>,</span>
</span><span id=__span-58-3><a id=__codelineno-58-3 name=__codelineno-58-3 href=#__codelineno-58-3></a><span class=w>  </span><span class=nt>&quot;retry_after&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>60</span>
</span><span id=__span-58-4><a id=__codelineno-58-4 name=__codelineno-58-4 href=#__codelineno-58-4></a><span class=p>}</span>
</span></code></pre></div></p> <p><strong>Root Cause Analysis:</strong> - Too many requests from single IP - Client not implementing backoff - Rate limiting configuration too strict - Distributed rate limiting sync issues</p> <p><strong>Step-by-step Solution:</strong> 1. Check rate limiting configuration: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-59-1><a id=__codelineno-59-1 name=__codelineno-59-1 href=#__codelineno-59-1></a><span class=c1>// Typical rate limiting setup</span>
</span><span id=__span-59-2><a id=__codelineno-59-2 name=__codelineno-59-2 href=#__codelineno-59-2></a><span class=kd>const</span><span class=w> </span><span class=nx>rateLimiter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>RateLimiter</span><span class=p>({</span>
</span><span id=__span-59-3><a id=__codelineno-59-3 name=__codelineno-59-3 href=#__codelineno-59-3></a><span class=w>  </span><span class=nx>windowMs</span><span class=o>:</span><span class=w> </span><span class=kt>15</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mf>60</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mf>1000</span><span class=p>,</span><span class=w> </span><span class=c1>// 15 minutes</span>
</span><span id=__span-59-4><a id=__codelineno-59-4 name=__codelineno-59-4 href=#__codelineno-59-4></a><span class=w>  </span><span class=nx>max</span><span class=o>:</span><span class=w> </span><span class=kt>100</span><span class=p>,</span><span class=w> </span><span class=c1>// limit each IP to 100 requests per windowMs</span>
</span><span id=__span-59-5><a id=__codelineno-59-5 name=__codelineno-59-5 href=#__codelineno-59-5></a><span class=p>});</span>
</span></code></pre></div></p> <ol> <li> <p>Implement exponential backoff in client: <div class="language-javascript highlight"><pre><span></span><code><span id=__span-60-1><a id=__codelineno-60-1 name=__codelineno-60-1 href=#__codelineno-60-1></a><span class=k>async</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>apiRequest</span><span class=p>(</span><span class=nx>url</span><span class=p>,</span><span class=w> </span><span class=nx>options</span><span class=p>,</span><span class=w> </span><span class=nx>retries</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>3</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-60-2><a id=__codelineno-60-2 name=__codelineno-60-2 href=#__codelineno-60-2></a><span class=w>  </span><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-60-3><a id=__codelineno-60-3 name=__codelineno-60-3 href=#__codelineno-60-3></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>fetch</span><span class=p>(</span><span class=nx>url</span><span class=p>,</span><span class=w> </span><span class=nx>options</span><span class=p>);</span>
</span><span id=__span-60-4><a id=__codelineno-60-4 name=__codelineno-60-4 href=#__codelineno-60-4></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>status</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=mf>429</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-60-5><a id=__codelineno-60-5 name=__codelineno-60-5 href=#__codelineno-60-5></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>retryAfter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>response</span><span class=p>.</span><span class=nx>headers</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;Retry-After&#39;</span><span class=p>);</span>
</span><span id=__span-60-6><a id=__codelineno-60-6 name=__codelineno-60-6 href=#__codelineno-60-6></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>delay</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>retryAfter</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=nb>parseInt</span><span class=p>(</span><span class=nx>retryAfter</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mf>1000</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=nb>Math</span><span class=p>.</span><span class=nx>pow</span><span class=p>(</span><span class=mf>2</span><span class=p>,</span><span class=w> </span><span class=mf>4</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=nx>retries</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mf>1000</span><span class=p>;</span>
</span><span id=__span-60-7><a id=__codelineno-60-7 name=__codelineno-60-7 href=#__codelineno-60-7></a><span class=w>      </span><span class=k>await</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nb>Promise</span><span class=p>(</span><span class=nx>resolve</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setTimeout</span><span class=p>(</span><span class=nx>resolve</span><span class=p>,</span><span class=w> </span><span class=nx>delay</span><span class=p>));</span>
</span><span id=__span-60-8><a id=__codelineno-60-8 name=__codelineno-60-8 href=#__codelineno-60-8></a><span class=w>      </span><span class=k>return</span><span class=w> </span><span class=nx>apiRequest</span><span class=p>(</span><span class=nx>url</span><span class=p>,</span><span class=w> </span><span class=nx>options</span><span class=p>,</span><span class=w> </span><span class=nx>retries</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mf>1</span><span class=p>);</span>
</span><span id=__span-60-9><a id=__codelineno-60-9 name=__codelineno-60-9 href=#__codelineno-60-9></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-60-10><a id=__codelineno-60-10 name=__codelineno-60-10 href=#__codelineno-60-10></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>response</span><span class=p>;</span>
</span><span id=__span-60-11><a id=__codelineno-60-11 name=__codelineno-60-11 href=#__codelineno-60-11></a><span class=w>  </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=nx>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-60-12><a id=__codelineno-60-12 name=__codelineno-60-12 href=#__codelineno-60-12></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>retries</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-60-13><a id=__codelineno-60-13 name=__codelineno-60-13 href=#__codelineno-60-13></a><span class=w>      </span><span class=k>await</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nb>Promise</span><span class=p>(</span><span class=nx>resolve</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setTimeout</span><span class=p>(</span><span class=nx>resolve</span><span class=p>,</span><span class=w> </span><span class=mf>1000</span><span class=p>));</span>
</span><span id=__span-60-14><a id=__codelineno-60-14 name=__codelineno-60-14 href=#__codelineno-60-14></a><span class=w>      </span><span class=k>return</span><span class=w> </span><span class=nx>apiRequest</span><span class=p>(</span><span class=nx>url</span><span class=p>,</span><span class=w> </span><span class=nx>options</span><span class=p>,</span><span class=w> </span><span class=nx>retries</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mf>1</span><span class=p>);</span>
</span><span id=__span-60-15><a id=__codelineno-60-15 name=__codelineno-60-15 href=#__codelineno-60-15></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-60-16><a id=__codelineno-60-16 name=__codelineno-60-16 href=#__codelineno-60-16></a><span class=w>    </span><span class=k>throw</span><span class=w> </span><span class=nx>error</span><span class=p>;</span>
</span><span id=__span-60-17><a id=__codelineno-60-17 name=__codelineno-60-17 href=#__codelineno-60-17></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-60-18><a id=__codelineno-60-18 name=__codelineno-60-18 href=#__codelineno-60-18></a><span class=p>}</span>
</span></code></pre></div></p> </li> <li> <p>Monitor rate limiting metrics: <div class="language-bash highlight"><pre><span></span><code><span id=__span-61-1><a id=__codelineno-61-1 name=__codelineno-61-1 href=#__codelineno-61-1></a><span class=c1># Check rate limiting logs</span>
</span><span id=__span-61-2><a id=__codelineno-61-2 name=__codelineno-61-2 href=#__codelineno-61-2></a>grep<span class=w> </span><span class=s2>&quot;rate_limit&quot;</span><span class=w> </span>logs/api.log
</span></code></pre></div></p> </li> <li> <p>Whitelist trusted IPs if needed: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-62-1><a id=__codelineno-62-1 name=__codelineno-62-1 href=#__codelineno-62-1></a><span class=kd>const</span><span class=w> </span><span class=nx>trustedIPs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;192.168.1.0/24&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;10.0.0.0/8&#39;</span><span class=p>];</span>
</span></code></pre></div></p> </li> </ol> <p><strong>Prevention Tips:</strong> - Implement client-side request queuing - Use appropriate rate limiting windows - Monitor API usage patterns</p> <hr> <h2 id=analytics-dashboard-problems>Analytics Dashboard Problems<a class=headerlink href=#analytics-dashboard-problems title="Permanent link">&para;</a></h2> <h3 id=issue-dashboard-data-not-loading>Issue: Dashboard Data Not Loading<a class=headerlink href=#issue-dashboard-data-not-loading title="Permanent link">&para;</a></h3> <p><strong>Problem Description:</strong> Analytics dashboard shows no data or loading errors.</p> <p><strong>Symptoms:</strong> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-63-1><a id=__codelineno-63-1 name=__codelineno-63-1 href=#__codelineno-63-1></a><span class=nx>Failed</span><span class=w> </span><span class=nx>to</span><span class=w> </span><span class=nx>fetch</span><span class=w> </span><span class=nx>analytics</span><span class=w> </span><span class=nx>data</span>
</span><span id=__span-63-2><a id=__codelineno-63-2 name=__codelineno-63-2 href=#__codelineno-63-2></a><span class=nx>ChartJS</span><span class=w> </span><span class=nx>error</span><span class=o>:</span><span class=w> </span><span class=nx>Dataset</span><span class=w> </span><span class=nx>is</span><span class=w> </span><span class=nx>empty</span>
</span><span id=__span-63-3><a id=__codelineno-63-3 name=__codelineno-63-3 href=#__codelineno-63-3></a><span class=nx>Dashboard</span><span class=w> </span><span class=nx>components</span><span class=w> </span><span class=nx>showing</span><span class=w> </span><span class=nx>loading</span><span class=w> </span><span class=nx>state</span><span class=w> </span><span class=nx>indefinitely</span>
</span></code></pre></div></p> <p><strong>Root Cause Analysis:</strong> - Analytics collection not working - Database query failures - Frontend data fetching issues - Date range filtering problems</p> <p><strong>Step-by-step Solution:</strong> 1. Check analytics data in database: <div class="language-sql highlight"><pre><span></span><code><span id=__span-64-1><a id=__codelineno-64-1 name=__codelineno-64-1 href=#__codelineno-64-1></a><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>AnalyticsRequest</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>timestamp</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>NOW</span><span class=p>()</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=nb>INTERVAL</span><span class=w> </span><span class=s1>&#39;1 day&#39;</span><span class=p>;</span>
</span><span id=__span-64-2><a id=__codelineno-64-2 name=__codelineno-64-2 href=#__codelineno-64-2></a><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>AnalyticsSecurity</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>timestamp</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>NOW</span><span class=p>()</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=nb>INTERVAL</span><span class=w> </span><span class=s1>&#39;1 day&#39;</span><span class=p>;</span>
</span></code></pre></div></p> <ol> <li> <p>Verify analytics collection endpoint: <div class="language-bash highlight"><pre><span></span><code><span id=__span-65-1><a id=__codelineno-65-1 name=__codelineno-65-1 href=#__codelineno-65-1></a>curl<span class=w> </span>-X<span class=w> </span>POST<span class=w> </span>http://localhost:3000/api/analytics/collect<span class=w> </span><span class=se>\</span>
</span><span id=__span-65-2><a id=__codelineno-65-2 name=__codelineno-65-2 href=#__codelineno-65-2></a><span class=w>  </span>-H<span class=w> </span><span class=s2>&quot;Content-Type: application/json&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-65-3><a id=__codelineno-65-3 name=__codelineno-65-3 href=#__codelineno-65-3></a><span class=w>  </span>-d<span class=w> </span><span class=s1>&#39;{</span>
</span><span id=__span-65-4><a id=__codelineno-65-4 name=__codelineno-65-4 href=#__codelineno-65-4></a><span class=s1>    &quot;timestamp&quot;: &quot;2024-01-01T00:00:00Z&quot;,</span>
</span><span id=__span-65-5><a id=__codelineno-65-5 name=__codelineno-65-5 href=#__codelineno-65-5></a><span class=s1>    &quot;endpoint&quot;: &quot;/test&quot;,</span>
</span><span id=__span-65-6><a id=__codelineno-65-6 name=__codelineno-65-6 href=#__codelineno-65-6></a><span class=s1>    &quot;method&quot;: &quot;GET&quot;,</span>
</span><span id=__span-65-7><a id=__codelineno-65-7 name=__codelineno-65-7 href=#__codelineno-65-7></a><span class=s1>    &quot;statusCode&quot;: 200,</span>
</span><span id=__span-65-8><a id=__codelineno-65-8 name=__codelineno-65-8 href=#__codelineno-65-8></a><span class=s1>    &quot;responseTime&quot;: 100,</span>
</span><span id=__span-65-9><a id=__codelineno-65-9 name=__codelineno-65-9 href=#__codelineno-65-9></a><span class=s1>    &quot;ipAddress&quot;: &quot;127.0.0.1&quot;,</span>
</span><span id=__span-65-10><a id=__codelineno-65-10 name=__codelineno-65-10 href=#__codelineno-65-10></a><span class=s1>    &quot;userAgent&quot;: &quot;test&quot;</span>
</span><span id=__span-65-11><a id=__codelineno-65-11 name=__codelineno-65-11 href=#__codelineno-65-11></a><span class=s1>  }&#39;</span>
</span></code></pre></div></p> </li> <li> <p>Test analytics API endpoints: <div class="language-bash highlight"><pre><span></span><code><span id=__span-66-1><a id=__codelineno-66-1 name=__codelineno-66-1 href=#__codelineno-66-1></a><span class=c1># Test main analytics endpoint</span>
</span><span id=__span-66-2><a id=__codelineno-66-2 name=__codelineno-66-2 href=#__codelineno-66-2></a>curl<span class=w> </span>http://localhost:3000/api/analytics
</span><span id=__span-66-3><a id=__codelineno-66-3 name=__codelineno-66-3 href=#__codelineno-66-3></a>
</span><span id=__span-66-4><a id=__codelineno-66-4 name=__codelineno-66-4 href=#__codelineno-66-4></a><span class=c1># Test security analytics</span>
</span><span id=__span-66-5><a id=__codelineno-66-5 name=__codelineno-66-5 href=#__codelineno-66-5></a>curl<span class=w> </span>http://localhost:3000/api/analytics/security
</span></code></pre></div></p> </li> <li> <p>Check browser console for errors: <div class="language-javascript highlight"><pre><span></span><code><span id=__span-67-1><a id=__codelineno-67-1 name=__codelineno-67-1 href=#__codelineno-67-1></a><span class=c1>// Look for network errors, CORS issues, or JavaScript errors</span>
</span><span id=__span-67-2><a id=__codelineno-67-2 name=__codelineno-67-2 href=#__codelineno-67-2></a><span class=c1>// in browser developer tools</span>
</span></code></pre></div></p> </li> <li> <p>Verify data transformation: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-68-1><a id=__codelineno-68-1 name=__codelineno-68-1 href=#__codelineno-68-1></a><span class=c1>// Check if chart data is properly formatted</span>
</span><span id=__span-68-2><a id=__codelineno-68-2 name=__codelineno-68-2 href=#__codelineno-68-2></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Chart data:&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>chartData</span><span class=p>);</span>
</span></code></pre></div></p> </li> </ol> <p><strong>Prevention Tips:</strong> - Implement analytics data validation - Add error boundaries to dashboard components - Monitor analytics collection health</p> <p><strong>Related Issues:</strong> - <a href=#database-connection-problems>Database Connection Problems</a> - <a href=#api-endpoint-errors>API Endpoint Errors</a></p> <hr> <h3 id=issue-chart-rendering-problems>Issue: Chart Rendering Problems<a class=headerlink href=#issue-chart-rendering-problems title="Permanent link">&para;</a></h3> <p><strong>Problem Description:</strong> Charts in analytics dashboard not rendering correctly or showing errors.</p> <p><strong>Symptoms:</strong> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-69-1><a id=__codelineno-69-1 name=__codelineno-69-1 href=#__codelineno-69-1></a><span class=nx>Canvas</span><span class=w> </span><span class=nx>error</span><span class=o>:</span><span class=w> </span><span class=nx>Cannot</span><span class=w> </span><span class=nx>read</span><span class=w> </span><span class=nx>property</span><span class=w> </span><span class=s1>&#39;getContext&#39;</span><span class=w> </span><span class=k>of</span><span class=w> </span><span class=kc>null</span>
</span><span id=__span-69-2><a id=__codelineno-69-2 name=__codelineno-69-2 href=#__codelineno-69-2></a><span class=nx>Recharts</span><span class=w> </span><span class=nx>warning</span><span class=o>:</span><span class=w> </span><span class=nx>Failed</span><span class=w> </span><span class=nx>to</span><span class=w> </span><span class=nx>parse</span><span class=w> </span><span class=nx>the</span><span class=w> </span><span class=nx>data</span>
</span><span id=__span-69-3><a id=__codelineno-69-3 name=__codelineno-69-3 href=#__codelineno-69-3></a><span class=nx>Chart</span><span class=w> </span><span class=nx>displays</span><span class=w> </span><span class=s2>&quot;No data available&quot;</span>
</span></code></pre></div></p> <p><strong>Root Cause Analysis:</strong> - Invalid chart data format - Missing chart dependencies - CSS conflicts affecting chart rendering - Responsive layout issues</p> <p><strong>Step-by-step Solution:</strong> 1. Verify chart data structure: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-70-1><a id=__codelineno-70-1 name=__codelineno-70-1 href=#__codelineno-70-1></a><span class=c1>// Example valid data for Recharts</span>
</span><span id=__span-70-2><a id=__codelineno-70-2 name=__codelineno-70-2 href=#__codelineno-70-2></a><span class=kd>const</span><span class=w> </span><span class=nx>chartData</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-70-3><a id=__codelineno-70-3 name=__codelineno-70-3 href=#__codelineno-70-3></a><span class=w>  </span><span class=p>{</span><span class=w> </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Jan&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>value</span><span class=o>:</span><span class=w> </span><span class=kt>100</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-70-4><a id=__codelineno-70-4 name=__codelineno-70-4 href=#__codelineno-70-4></a><span class=w>  </span><span class=p>{</span><span class=w> </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Feb&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>value</span><span class=o>:</span><span class=w> </span><span class=kt>200</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-70-5><a id=__codelineno-70-5 name=__codelineno-70-5 href=#__codelineno-70-5></a><span class=p>];</span>
</span></code></pre></div></p> <ol> <li> <p>Check chart component props: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-71-1><a id=__codelineno-71-1 name=__codelineno-71-1 href=#__codelineno-71-1></a><span class=o>&lt;</span><span class=nx>ResponsiveContainer</span><span class=w> </span><span class=nx>width</span><span class=o>=</span><span class=s2>&quot;100%&quot;</span><span class=w> </span><span class=nx>height</span><span class=o>=</span><span class=p>{</span><span class=mf>300</span><span class=p>}</span><span class=o>&gt;</span>
</span><span id=__span-71-2><a id=__codelineno-71-2 name=__codelineno-71-2 href=#__codelineno-71-2></a><span class=w>  </span><span class=o>&lt;</span><span class=nx>LineChart</span><span class=w> </span><span class=nx>data</span><span class=o>=</span><span class=p>{</span><span class=nx>chartData</span><span class=p>}</span><span class=o>&gt;</span>
</span><span id=__span-71-3><a id=__codelineno-71-3 name=__codelineno-71-3 href=#__codelineno-71-3></a><span class=w>    </span><span class=o>&lt;</span><span class=nx>XAxis</span><span class=w> </span><span class=nx>dataKey</span><span class=o>=</span><span class=s2>&quot;name&quot;</span><span class=w> </span><span class=o>/&gt;</span>
</span><span id=__span-71-4><a id=__codelineno-71-4 name=__codelineno-71-4 href=#__codelineno-71-4></a><span class=w>    </span><span class=o>&lt;</span><span class=nx>YAxis</span><span class=w> </span><span class=o>/&gt;</span>
</span><span id=__span-71-5><a id=__codelineno-71-5 name=__codelineno-71-5 href=#__codelineno-71-5></a><span class=w>    </span><span class=o>&lt;</span><span class=nx>Line</span><span class=w> </span><span class=kr>type</span><span class=o>=</span><span class=s2>&quot;monotone&quot;</span><span class=w> </span><span class=nx>dataKey</span><span class=o>=</span><span class=s2>&quot;value&quot;</span><span class=w> </span><span class=nx>stroke</span><span class=o>=</span><span class=s2>&quot;#8884d8&quot;</span><span class=w> </span><span class=o>/&gt;</span>
</span><span id=__span-71-6><a id=__codelineno-71-6 name=__codelineno-71-6 href=#__codelineno-71-6></a><span class=w>  </span><span class=o>&lt;</span><span class=err>/LineChart&gt;</span>
</span><span id=__span-71-7><a id=__codelineno-71-7 name=__codelineno-71-7 href=#__codelineno-71-7></a><span class=o>&lt;</span><span class=err>/ResponsiveContainer&gt;</span>
</span></code></pre></div></p> </li> <li> <p>Verify chart container dimensions: <div class="language-css highlight"><pre><span></span><code><span id=__span-72-1><a id=__codelineno-72-1 name=__codelineno-72-1 href=#__codelineno-72-1></a><span class=p>.</span><span class=nc>chart-container</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-72-2><a id=__codelineno-72-2 name=__codelineno-72-2 href=#__codelineno-72-2></a><span class=w>  </span><span class=k>width</span><span class=p>:</span><span class=w> </span><span class=mi>100</span><span class=kt>%</span><span class=p>;</span>
</span><span id=__span-72-3><a id=__codelineno-72-3 name=__codelineno-72-3 href=#__codelineno-72-3></a><span class=w>  </span><span class=k>height</span><span class=p>:</span><span class=w> </span><span class=mi>300</span><span class=kt>px</span><span class=p>;</span>
</span><span id=__span-72-4><a id=__codelineno-72-4 name=__codelineno-72-4 href=#__codelineno-72-4></a><span class=w>  </span><span class=k>min-height</span><span class=p>:</span><span class=w> </span><span class=mi>300</span><span class=kt>px</span><span class=p>;</span>
</span><span id=__span-72-5><a id=__codelineno-72-5 name=__codelineno-72-5 href=#__codelineno-72-5></a><span class=p>}</span>
</span></code></pre></div></p> </li> <li> <p>Test with static data: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-73-1><a id=__codelineno-73-1 name=__codelineno-73-1 href=#__codelineno-73-1></a><span class=c1>// Replace dynamic data with static data to isolate issue</span>
</span><span id=__span-73-2><a id=__codelineno-73-2 name=__codelineno-73-2 href=#__codelineno-73-2></a><span class=kd>const</span><span class=w> </span><span class=nx>testData</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-73-3><a id=__codelineno-73-3 name=__codelineno-73-3 href=#__codelineno-73-3></a><span class=w>  </span><span class=p>{</span><span class=w> </span><span class=nx>timestamp</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;2024-01-01&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>requests</span><span class=o>:</span><span class=w> </span><span class=kt>100</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-73-4><a id=__codelineno-73-4 name=__codelineno-73-4 href=#__codelineno-73-4></a><span class=w>  </span><span class=p>{</span><span class=w> </span><span class=nx>timestamp</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;2024-01-02&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>requests</span><span class=o>:</span><span class=w> </span><span class=kt>150</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-73-5><a id=__codelineno-73-5 name=__codelineno-73-5 href=#__codelineno-73-5></a><span class=p>];</span>
</span></code></pre></div></p> </li> </ol> <p><strong>Prevention Tips:</strong> - Validate chart data before rendering - Use chart component error boundaries - Test charts with various data scenarios</p> <hr> <h2 id=performance-issues>Performance Issues<a class=headerlink href=#performance-issues title="Permanent link">&para;</a></h2> <h3 id=issue-slow-database-queries>Issue: Slow Database Queries<a class=headerlink href=#issue-slow-database-queries title="Permanent link">&para;</a></h3> <p><strong>Problem Description:</strong> Database operations taking too long, affecting API response times.</p> <p><strong>Symptoms:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-74-1><a id=__codelineno-74-1 name=__codelineno-74-1 href=#__codelineno-74-1></a>API<span class=w> </span>response<span class=w> </span><span class=nb>time</span><span class=w> </span>&gt;<span class=w> </span><span class=m>5</span><span class=w> </span>seconds
</span><span id=__span-74-2><a id=__codelineno-74-2 name=__codelineno-74-2 href=#__codelineno-74-2></a>Database<span class=w> </span>connection<span class=w> </span>pool<span class=w> </span>exhausted
</span><span id=__span-74-3><a id=__codelineno-74-3 name=__codelineno-74-3 href=#__codelineno-74-3></a>Timeout<span class=w> </span>errors<span class=w> </span><span class=k>in</span><span class=w> </span>application<span class=w> </span>logs
</span></code></pre></div></p> <p><strong>Root Cause Analysis:</strong> - Missing database indexes - Inefficient query patterns - Large dataset without pagination - Database connection pool issues</p> <p><strong>Step-by-step Solution:</strong> 1. Identify slow queries: <div class="language-sql highlight"><pre><span></span><code><span id=__span-75-1><a id=__codelineno-75-1 name=__codelineno-75-1 href=#__codelineno-75-1></a><span class=c1>-- PostgreSQL slow query analysis</span>
</span><span id=__span-75-2><a id=__codelineno-75-2 name=__codelineno-75-2 href=#__codelineno-75-2></a><span class=k>SELECT</span><span class=w> </span><span class=n>query</span><span class=p>,</span><span class=w> </span><span class=n>mean_time</span><span class=p>,</span><span class=w> </span><span class=n>calls</span><span class=p>,</span><span class=w> </span><span class=n>total_time</span>
</span><span id=__span-75-3><a id=__codelineno-75-3 name=__codelineno-75-3 href=#__codelineno-75-3></a><span class=k>FROM</span><span class=w> </span><span class=n>pg_stat_statements</span>
</span><span id=__span-75-4><a id=__codelineno-75-4 name=__codelineno-75-4 href=#__codelineno-75-4></a><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>mean_time</span><span class=w> </span><span class=k>DESC</span>
</span><span id=__span-75-5><a id=__codelineno-75-5 name=__codelineno-75-5 href=#__codelineno-75-5></a><span class=k>LIMIT</span><span class=w> </span><span class=mi>10</span><span class=p>;</span>
</span></code></pre></div></p> <ol> <li> <p>Add missing indexes: <div class="language-sql highlight"><pre><span></span><code><span id=__span-76-1><a id=__codelineno-76-1 name=__codelineno-76-1 href=#__codelineno-76-1></a><span class=c1>-- Common indexes for analytics</span>
</span><span id=__span-76-2><a id=__codelineno-76-2 name=__codelineno-76-2 href=#__codelineno-76-2></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_analytics_timestamp</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>AnalyticsRequest</span><span class=p>(</span><span class=k>timestamp</span><span class=p>);</span>
</span><span id=__span-76-3><a id=__codelineno-76-3 name=__codelineno-76-3 href=#__codelineno-76-3></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_analytics_client</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>AnalyticsRequest</span><span class=p>(</span><span class=n>clientId</span><span class=p>,</span><span class=w> </span><span class=k>timestamp</span><span class=p>);</span>
</span><span id=__span-76-4><a id=__codelineno-76-4 name=__codelineno-76-4 href=#__codelineno-76-4></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_security_events</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>AnalyticsSecurity</span><span class=p>(</span><span class=k>timestamp</span><span class=p>,</span><span class=w> </span><span class=n>eventType</span><span class=p>);</span>
</span></code></pre></div></p> </li> <li> <p>Optimize Prisma queries: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-77-1><a id=__codelineno-77-1 name=__codelineno-77-1 href=#__codelineno-77-1></a><span class=c1>// Use proper pagination</span>
</span><span id=__span-77-2><a id=__codelineno-77-2 name=__codelineno-77-2 href=#__codelineno-77-2></a><span class=kd>const</span><span class=w> </span><span class=nx>requests</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>prisma</span><span class=p>.</span><span class=nx>analyticsRequest</span><span class=p>.</span><span class=nx>findMany</span><span class=p>({</span>
</span><span id=__span-77-3><a id=__codelineno-77-3 name=__codelineno-77-3 href=#__codelineno-77-3></a><span class=w>  </span><span class=nx>take</span><span class=o>:</span><span class=w> </span><span class=kt>100</span><span class=p>,</span>
</span><span id=__span-77-4><a id=__codelineno-77-4 name=__codelineno-77-4 href=#__codelineno-77-4></a><span class=w>  </span><span class=nx>skip</span><span class=o>:</span><span class=w> </span><span class=kt>page</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mf>100</span><span class=p>,</span>
</span><span id=__span-77-5><a id=__codelineno-77-5 name=__codelineno-77-5 href=#__codelineno-77-5></a><span class=w>  </span><span class=nx>orderBy</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>timestamp</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;desc&#39;</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-77-6><a id=__codelineno-77-6 name=__codelineno-77-6 href=#__codelineno-77-6></a><span class=w>  </span><span class=nx>where</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-77-7><a id=__codelineno-77-7 name=__codelineno-77-7 href=#__codelineno-77-7></a><span class=w>    </span><span class=nx>timestamp</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-77-8><a id=__codelineno-77-8 name=__codelineno-77-8 href=#__codelineno-77-8></a><span class=w>      </span><span class=nx>gte</span><span class=o>:</span><span class=w> </span><span class=kt>startDate</span><span class=p>,</span>
</span><span id=__span-77-9><a id=__codelineno-77-9 name=__codelineno-77-9 href=#__codelineno-77-9></a><span class=w>      </span><span class=nx>lte</span><span class=o>:</span><span class=w> </span><span class=kt>endDate</span>
</span><span id=__span-77-10><a id=__codelineno-77-10 name=__codelineno-77-10 href=#__codelineno-77-10></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-77-11><a id=__codelineno-77-11 name=__codelineno-77-11 href=#__codelineno-77-11></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-77-12><a id=__codelineno-77-12 name=__codelineno-77-12 href=#__codelineno-77-12></a><span class=p>});</span>
</span></code></pre></div></p> </li> <li> <p>Configure connection pooling: <div class="language-bash highlight"><pre><span></span><code><span id=__span-78-1><a id=__codelineno-78-1 name=__codelineno-78-1 href=#__codelineno-78-1></a><span class=c1># Database URL with connection pool settings</span>
</span><span id=__span-78-2><a id=__codelineno-78-2 name=__codelineno-78-2 href=#__codelineno-78-2></a><span class=nv>DATABASE_URL</span><span class=o>=</span><span class=s2>&quot;postgresql://user:pass@localhost:5432/db?connection_limit=10&amp;pool_timeout=20&quot;</span>
</span></code></pre></div></p> </li> <li> <p>Use database query optimization: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-79-1><a id=__codelineno-79-1 name=__codelineno-79-1 href=#__codelineno-79-1></a><span class=c1>// Use select to limit fields</span>
</span><span id=__span-79-2><a id=__codelineno-79-2 name=__codelineno-79-2 href=#__codelineno-79-2></a><span class=kd>const</span><span class=w> </span><span class=nx>analytics</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>prisma</span><span class=p>.</span><span class=nx>analyticsRequest</span><span class=p>.</span><span class=nx>findMany</span><span class=p>({</span>
</span><span id=__span-79-3><a id=__codelineno-79-3 name=__codelineno-79-3 href=#__codelineno-79-3></a><span class=w>  </span><span class=nx>select</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-79-4><a id=__codelineno-79-4 name=__codelineno-79-4 href=#__codelineno-79-4></a><span class=w>    </span><span class=nx>id</span><span class=o>:</span><span class=w> </span><span class=kt>true</span><span class=p>,</span>
</span><span id=__span-79-5><a id=__codelineno-79-5 name=__codelineno-79-5 href=#__codelineno-79-5></a><span class=w>    </span><span class=nx>timestamp</span><span class=o>:</span><span class=w> </span><span class=kt>true</span><span class=p>,</span>
</span><span id=__span-79-6><a id=__codelineno-79-6 name=__codelineno-79-6 href=#__codelineno-79-6></a><span class=w>    </span><span class=nx>endpoint</span><span class=o>:</span><span class=w> </span><span class=kt>true</span><span class=p>,</span>
</span><span id=__span-79-7><a id=__codelineno-79-7 name=__codelineno-79-7 href=#__codelineno-79-7></a><span class=w>    </span><span class=nx>statusCode</span><span class=o>:</span><span class=w> </span><span class=kt>true</span>
</span><span id=__span-79-8><a id=__codelineno-79-8 name=__codelineno-79-8 href=#__codelineno-79-8></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-79-9><a id=__codelineno-79-9 name=__codelineno-79-9 href=#__codelineno-79-9></a><span class=p>});</span>
</span></code></pre></div></p> </li> </ol> <p><strong>Prevention Tips:</strong> - Monitor query performance regularly - Use database query analyzers - Implement proper caching strategies</p> <p><strong>Related Issues:</strong> - <a href=#database-connection-problems>Database Connection Problems</a> - <a href=#analytics-dashboard-problems>Analytics Dashboard Problems</a></p> <hr> <h3 id=issue-memory-leaks-and-high-cpu-usage>Issue: Memory Leaks and High CPU Usage<a class=headerlink href=#issue-memory-leaks-and-high-cpu-usage title="Permanent link">&para;</a></h3> <p><strong>Problem Description:</strong> Application consuming excessive memory or CPU resources.</p> <p><strong>Symptoms:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-80-1><a id=__codelineno-80-1 name=__codelineno-80-1 href=#__codelineno-80-1></a>Node.js<span class=w> </span>heap<span class=w> </span>out<span class=w> </span>of<span class=w> </span>memory
</span><span id=__span-80-2><a id=__codelineno-80-2 name=__codelineno-80-2 href=#__codelineno-80-2></a>High<span class=w> </span>CPU<span class=w> </span>usage<span class=w> </span><span class=o>(</span>&gt;80%<span class=o>)</span>
</span><span id=__span-80-3><a id=__codelineno-80-3 name=__codelineno-80-3 href=#__codelineno-80-3></a>Application<span class=w> </span>becomes<span class=w> </span>unresponsive
</span></code></pre></div></p> <p><strong>Root Cause Analysis:</strong> - Memory leaks in event handlers - Inefficient algorithms - Large data processing without streaming - Unhandled promise rejections</p> <p><strong>Step-by-step Solution:</strong> 1. Monitor memory usage: <div class="language-bash highlight"><pre><span></span><code><span id=__span-81-1><a id=__codelineno-81-1 name=__codelineno-81-1 href=#__codelineno-81-1></a><span class=c1># Use Node.js built-in profiler</span>
</span><span id=__span-81-2><a id=__codelineno-81-2 name=__codelineno-81-2 href=#__codelineno-81-2></a>node<span class=w> </span>--inspect-brk<span class=w> </span>server.js
</span><span id=__span-81-3><a id=__codelineno-81-3 name=__codelineno-81-3 href=#__codelineno-81-3></a>
</span><span id=__span-81-4><a id=__codelineno-81-4 name=__codelineno-81-4 href=#__codelineno-81-4></a><span class=c1># Or use external tools</span>
</span><span id=__span-81-5><a id=__codelineno-81-5 name=__codelineno-81-5 href=#__codelineno-81-5></a>npm<span class=w> </span>install<span class=w> </span>-g<span class=w> </span>clinic
</span><span id=__span-81-6><a id=__codelineno-81-6 name=__codelineno-81-6 href=#__codelineno-81-6></a>clinic<span class=w> </span>flame<span class=w> </span>--<span class=w> </span>node<span class=w> </span>server.js
</span></code></pre></div></p> <ol> <li> <p>Check for memory leaks: <div class="language-javascript highlight"><pre><span></span><code><span id=__span-82-1><a id=__codelineno-82-1 name=__codelineno-82-1 href=#__codelineno-82-1></a><span class=c1>// Add memory monitoring</span>
</span><span id=__span-82-2><a id=__codelineno-82-2 name=__codelineno-82-2 href=#__codelineno-82-2></a><span class=nx>setInterval</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-82-3><a id=__codelineno-82-3 name=__codelineno-82-3 href=#__codelineno-82-3></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>used</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>process</span><span class=p>.</span><span class=nx>memoryUsage</span><span class=p>();</span>
</span><span id=__span-82-4><a id=__codelineno-82-4 name=__codelineno-82-4 href=#__codelineno-82-4></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Memory usage: </span><span class=si>${</span><span class=nb>Math</span><span class=p>.</span><span class=nx>round</span><span class=p>(</span><span class=nx>used</span><span class=p>.</span><span class=nx>rss</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mf>1024</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mf>1024</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mf>100</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mf>100</span><span class=si>}</span><span class=sb> MB`</span><span class=p>);</span>
</span><span id=__span-82-5><a id=__codelineno-82-5 name=__codelineno-82-5 href=#__codelineno-82-5></a><span class=p>},</span><span class=w> </span><span class=mf>30000</span><span class=p>);</span>
</span></code></pre></div></p> </li> <li> <p>Optimize data processing: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-83-1><a id=__codelineno-83-1 name=__codelineno-83-1 href=#__codelineno-83-1></a><span class=c1>// Use streaming for large datasets</span>
</span><span id=__span-83-2><a id=__codelineno-83-2 name=__codelineno-83-2 href=#__codelineno-83-2></a><span class=kd>const</span><span class=w> </span><span class=nx>stream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>prisma</span><span class=p>.</span><span class=nx>analyticsRequest</span><span class=p>.</span><span class=nx>findManyStream</span><span class=p>({</span>
</span><span id=__span-83-3><a id=__codelineno-83-3 name=__codelineno-83-3 href=#__codelineno-83-3></a><span class=w>  </span><span class=nx>where</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>timestamp</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>gte</span><span class=o>:</span><span class=w> </span><span class=kt>startDate</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-83-4><a id=__codelineno-83-4 name=__codelineno-83-4 href=#__codelineno-83-4></a><span class=p>});</span>
</span><span id=__span-83-5><a id=__codelineno-83-5 name=__codelineno-83-5 href=#__codelineno-83-5></a>
</span><span id=__span-83-6><a id=__codelineno-83-6 name=__codelineno-83-6 href=#__codelineno-83-6></a><span class=k>for</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=p>(</span><span class=kd>const</span><span class=w> </span><span class=nx>record</span><span class=w> </span><span class=k>of</span><span class=w> </span><span class=nx>stream</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-83-7><a id=__codelineno-83-7 name=__codelineno-83-7 href=#__codelineno-83-7></a><span class=w>  </span><span class=nx>processRecord</span><span class=p>(</span><span class=nx>record</span><span class=p>);</span>
</span><span id=__span-83-8><a id=__codelineno-83-8 name=__codelineno-83-8 href=#__codelineno-83-8></a><span class=p>}</span>
</span></code></pre></div></p> </li> <li> <p>Fix promise rejection handlers: <div class="language-javascript highlight"><pre><span></span><code><span id=__span-84-1><a id=__codelineno-84-1 name=__codelineno-84-1 href=#__codelineno-84-1></a><span class=nx>process</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;unhandledRejection&#39;</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=nx>reason</span><span class=p>,</span><span class=w> </span><span class=nx>promise</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-84-2><a id=__codelineno-84-2 name=__codelineno-84-2 href=#__codelineno-84-2></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Unhandled Rejection at:&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>promise</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;reason:&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>reason</span><span class=p>);</span>
</span><span id=__span-84-3><a id=__codelineno-84-3 name=__codelineno-84-3 href=#__codelineno-84-3></a><span class=p>});</span>
</span></code></pre></div></p> </li> </ol> <p><strong>Prevention Tips:</strong> - Use memory profiling in development - Implement proper cleanup in components - Monitor resource usage in production</p> <hr> <h2 id=security-related-errors>Security-Related Errors<a class=headerlink href=#security-related-errors title="Permanent link">&para;</a></h2> <h3 id=issue-token-security-violations>Issue: Token Security Violations<a class=headerlink href=#issue-token-security-violations title="Permanent link">&para;</a></h3> <p><strong>Problem Description:</strong> Security events being triggered due to token misuse or attacks.</p> <p><strong>Symptoms:</strong> <div class="language-json highlight"><pre><span></span><code><span id=__span-85-1><a id=__codelineno-85-1 name=__codelineno-85-1 href=#__codelineno-85-1></a><span class=p>{</span>
</span><span id=__span-85-2><a id=__codelineno-85-2 name=__codelineno-85-2 href=#__codelineno-85-2></a><span class=w>  </span><span class=nt>&quot;eventType&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;TOKEN_REUSE&quot;</span><span class=p>,</span>
</span><span id=__span-85-3><a id=__codelineno-85-3 name=__codelineno-85-3 href=#__codelineno-85-3></a><span class=w>  </span><span class=nt>&quot;severity&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;high&quot;</span><span class=p>,</span>
</span><span id=__span-85-4><a id=__codelineno-85-4 name=__codelineno-85-4 href=#__codelineno-85-4></a><span class=w>  </span><span class=nt>&quot;details&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Access token used multiple times&quot;</span>
</span><span id=__span-85-5><a id=__codelineno-85-5 name=__codelineno-85-5 href=#__codelineno-85-5></a><span class=p>}</span>
</span></code></pre></div></p> <p><strong>Root Cause Analysis:</strong> - Token replay attacks - Client not properly managing tokens - Token storage vulnerabilities - Insufficient token validation</p> <p><strong>Step-by-step Solution:</strong> 1. Review security events: <div class="language-sql highlight"><pre><span></span><code><span id=__span-86-1><a id=__codelineno-86-1 name=__codelineno-86-1 href=#__codelineno-86-1></a><span class=k>SELECT</span><span class=w> </span><span class=n>eventType</span><span class=p>,</span><span class=w> </span><span class=n>severity</span><span class=p>,</span><span class=w> </span><span class=n>details</span><span class=p>,</span><span class=w> </span><span class=k>timestamp</span><span class=p>,</span><span class=w> </span><span class=n>ipAddress</span>
</span><span id=__span-86-2><a id=__codelineno-86-2 name=__codelineno-86-2 href=#__codelineno-86-2></a><span class=k>FROM</span><span class=w> </span><span class=n>AnalyticsSecurity</span>
</span><span id=__span-86-3><a id=__codelineno-86-3 name=__codelineno-86-3 href=#__codelineno-86-3></a><span class=k>WHERE</span><span class=w> </span><span class=n>eventType</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;TOKEN_REUSE&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;INVALID_TOKEN&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;SUSPICIOUS_ACTIVITY&#39;</span><span class=p>)</span>
</span><span id=__span-86-4><a id=__codelineno-86-4 name=__codelineno-86-4 href=#__codelineno-86-4></a><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=k>timestamp</span><span class=w> </span><span class=k>DESC</span><span class=p>;</span>
</span></code></pre></div></p> <ol> <li> <p>Implement token binding: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-87-1><a id=__codelineno-87-1 name=__codelineno-87-1 href=#__codelineno-87-1></a><span class=c1>// Bind token to client characteristics</span>
</span><span id=__span-87-2><a id=__codelineno-87-2 name=__codelineno-87-2 href=#__codelineno-87-2></a><span class=kd>const</span><span class=w> </span><span class=nx>tokenBinding</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-87-3><a id=__codelineno-87-3 name=__codelineno-87-3 href=#__codelineno-87-3></a><span class=w>  </span><span class=nx>userAgent</span><span class=o>:</span><span class=w> </span><span class=kt>request.headers.get</span><span class=p>(</span><span class=s1>&#39;user-agent&#39;</span><span class=p>),</span>
</span><span id=__span-87-4><a id=__codelineno-87-4 name=__codelineno-87-4 href=#__codelineno-87-4></a><span class=w>  </span><span class=nx>ipAddress</span><span class=o>:</span><span class=w> </span><span class=kt>getClientIP</span><span class=p>(</span><span class=nx>request</span><span class=p>),</span>
</span><span id=__span-87-5><a id=__codelineno-87-5 name=__codelineno-87-5 href=#__codelineno-87-5></a><span class=p>};</span>
</span></code></pre></div></p> </li> <li> <p>Add token introspection: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-88-1><a id=__codelineno-88-1 name=__codelineno-88-1 href=#__codelineno-88-1></a><span class=c1>// Validate token properties</span>
</span><span id=__span-88-2><a id=__codelineno-88-2 name=__codelineno-88-2 href=#__codelineno-88-2></a><span class=k>async</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>validateToken</span><span class=p>(</span><span class=nx>token</span><span class=o>:</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>request</span><span class=o>:</span><span class=w> </span><span class=kt>NextRequest</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-88-3><a id=__codelineno-88-3 name=__codelineno-88-3 href=#__codelineno-88-3></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>accessToken</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>prisma</span><span class=p>.</span><span class=nx>accessToken</span><span class=p>.</span><span class=nx>findUnique</span><span class=p>({</span>
</span><span id=__span-88-4><a id=__codelineno-88-4 name=__codelineno-88-4 href=#__codelineno-88-4></a><span class=w>    </span><span class=nx>where</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>token</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-88-5><a id=__codelineno-88-5 name=__codelineno-88-5 href=#__codelineno-88-5></a><span class=w>    </span><span class=nx>include</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>client</span><span class=o>:</span><span class=w> </span><span class=kt>true</span><span class=p>,</span><span class=w> </span><span class=nx>user</span><span class=o>:</span><span class=w> </span><span class=kt>true</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-88-6><a id=__codelineno-88-6 name=__codelineno-88-6 href=#__codelineno-88-6></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-88-7><a id=__codelineno-88-7 name=__codelineno-88-7 href=#__codelineno-88-7></a>
</span><span id=__span-88-8><a id=__codelineno-88-8 name=__codelineno-88-8 href=#__codelineno-88-8></a><span class=w>  </span><span class=c1>// Validate audience</span>
</span><span id=__span-88-9><a id=__codelineno-88-9 name=__codelineno-88-9 href=#__codelineno-88-9></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>accessToken</span><span class=p>.</span><span class=nx>resource</span><span class=w> </span><span class=o>!==</span><span class=w> </span><span class=nx>expectedResource</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-88-10><a id=__codelineno-88-10 name=__codelineno-88-10 href=#__codelineno-88-10></a><span class=w>    </span><span class=k>throw</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=ne>Error</span><span class=p>(</span><span class=s1>&#39;Token audience mismatch&#39;</span><span class=p>);</span>
</span><span id=__span-88-11><a id=__codelineno-88-11 name=__codelineno-88-11 href=#__codelineno-88-11></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-88-12><a id=__codelineno-88-12 name=__codelineno-88-12 href=#__codelineno-88-12></a>
</span><span id=__span-88-13><a id=__codelineno-88-13 name=__codelineno-88-13 href=#__codelineno-88-13></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>accessToken</span><span class=p>;</span>
</span><span id=__span-88-14><a id=__codelineno-88-14 name=__codelineno-88-14 href=#__codelineno-88-14></a><span class=p>}</span>
</span></code></pre></div></p> </li> <li> <p>Monitor unusual patterns: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-89-1><a id=__codelineno-89-1 name=__codelineno-89-1 href=#__codelineno-89-1></a><span class=c1>// Track token usage patterns</span>
</span><span id=__span-89-2><a id=__codelineno-89-2 name=__codelineno-89-2 href=#__codelineno-89-2></a><span class=kd>const</span><span class=w> </span><span class=nx>recentUsage</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>prisma</span><span class=p>.</span><span class=nx>analyticsRequest</span><span class=p>.</span><span class=nx>count</span><span class=p>({</span>
</span><span id=__span-89-3><a id=__codelineno-89-3 name=__codelineno-89-3 href=#__codelineno-89-3></a><span class=w>  </span><span class=nx>where</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-89-4><a id=__codelineno-89-4 name=__codelineno-89-4 href=#__codelineno-89-4></a><span class=w>    </span><span class=nx>clientId</span><span class=o>:</span><span class=w> </span><span class=kt>accessToken.clientId</span><span class=p>,</span>
</span><span id=__span-89-5><a id=__codelineno-89-5 name=__codelineno-89-5 href=#__codelineno-89-5></a><span class=w>    </span><span class=nx>timestamp</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>gte</span><span class=o>:</span><span class=w> </span><span class=kt>new</span><span class=w> </span><span class=nb>Date</span><span class=p>(</span><span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mf>60000</span><span class=p>)</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=c1>// Last minute</span>
</span><span id=__span-89-6><a id=__codelineno-89-6 name=__codelineno-89-6 href=#__codelineno-89-6></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-89-7><a id=__codelineno-89-7 name=__codelineno-89-7 href=#__codelineno-89-7></a><span class=p>});</span>
</span><span id=__span-89-8><a id=__codelineno-89-8 name=__codelineno-89-8 href=#__codelineno-89-8></a>
</span><span id=__span-89-9><a id=__codelineno-89-9 name=__codelineno-89-9 href=#__codelineno-89-9></a><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>recentUsage</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=nx>RATE_LIMIT</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-89-10><a id=__codelineno-89-10 name=__codelineno-89-10 href=#__codelineno-89-10></a><span class=w>  </span><span class=k>await</span><span class=w> </span><span class=nx>logSecurityEvent</span><span class=p>(</span><span class=nx>request</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;RATE_LIMIT_EXCEEDED&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Unusual token usage pattern&#39;</span><span class=p>);</span>
</span><span id=__span-89-11><a id=__codelineno-89-11 name=__codelineno-89-11 href=#__codelineno-89-11></a><span class=p>}</span>
</span></code></pre></div></p> </li> </ol> <p><strong>Prevention Tips:</strong> - Implement comprehensive token validation - Use short-lived access tokens - Monitor security events continuously</p> <p><strong>Related Issues:</strong> - <a href=#authentication-failures>Authentication Failures</a> - <a href=#oauth-flow-errors>OAuth Flow Errors</a></p> <hr> <h3 id=issue-csrf-and-xss-vulnerabilities>Issue: CSRF and XSS Vulnerabilities<a class=headerlink href=#issue-csrf-and-xss-vulnerabilities title="Permanent link">&para;</a></h3> <p><strong>Problem Description:</strong> Security vulnerabilities in web application components.</p> <p><strong>Symptoms:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-90-1><a id=__codelineno-90-1 name=__codelineno-90-1 href=#__codelineno-90-1></a>Security<span class=w> </span>scanner<span class=w> </span>reports<span class=w> </span>CSRF<span class=w> </span>vulnerability
</span><span id=__span-90-2><a id=__codelineno-90-2 name=__codelineno-90-2 href=#__codelineno-90-2></a>XSS<span class=w> </span>attack<span class=w> </span>detected<span class=w> </span><span class=k>in</span><span class=w> </span>logs
</span><span id=__span-90-3><a id=__codelineno-90-3 name=__codelineno-90-3 href=#__codelineno-90-3></a>Content<span class=w> </span>Security<span class=w> </span>Policy<span class=w> </span>violations
</span></code></pre></div></p> <p><strong>Root Cause Analysis:</strong> - Missing CSRF protection - Inadequate input sanitization<br> - Unsafe HTML rendering - Weak Content Security Policy</p> <p><strong>Step-by-step Solution:</strong> 1. Implement CSRF protection: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-91-1><a id=__codelineno-91-1 name=__codelineno-91-1 href=#__codelineno-91-1></a><span class=c1>// Use NextAuth&#39;s built-in CSRF protection</span>
</span><span id=__span-91-2><a id=__codelineno-91-2 name=__codelineno-91-2 href=#__codelineno-91-2></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>auth</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s1>&#39;./auth&#39;</span><span class=p>;</span>
</span><span id=__span-91-3><a id=__codelineno-91-3 name=__codelineno-91-3 href=#__codelineno-91-3></a>
</span><span id=__span-91-4><a id=__codelineno-91-4 name=__codelineno-91-4 href=#__codelineno-91-4></a><span class=k>export</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>POST</span><span class=p>(</span><span class=nx>request</span><span class=o>:</span><span class=w> </span><span class=kt>NextRequest</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-91-5><a id=__codelineno-91-5 name=__codelineno-91-5 href=#__codelineno-91-5></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>session</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>auth</span><span class=p>();</span>
</span><span id=__span-91-6><a id=__codelineno-91-6 name=__codelineno-91-6 href=#__codelineno-91-6></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=nx>session</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-91-7><a id=__codelineno-91-7 name=__codelineno-91-7 href=#__codelineno-91-7></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>Response</span><span class=p>(</span><span class=s1>&#39;Unauthorized&#39;</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>status</span><span class=o>:</span><span class=w> </span><span class=kt>401</span><span class=w> </span><span class=p>});</span>
</span><span id=__span-91-8><a id=__codelineno-91-8 name=__codelineno-91-8 href=#__codelineno-91-8></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-91-9><a id=__codelineno-91-9 name=__codelineno-91-9 href=#__codelineno-91-9></a><span class=w>  </span><span class=c1>// ... handle authenticated request</span>
</span><span id=__span-91-10><a id=__codelineno-91-10 name=__codelineno-91-10 href=#__codelineno-91-10></a><span class=p>}</span>
</span></code></pre></div></p> <ol> <li> <p>Sanitize user inputs: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-92-1><a id=__codelineno-92-1 name=__codelineno-92-1 href=#__codelineno-92-1></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>z</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s1>&#39;zod&#39;</span><span class=p>;</span>
</span><span id=__span-92-2><a id=__codelineno-92-2 name=__codelineno-92-2 href=#__codelineno-92-2></a>
</span><span id=__span-92-3><a id=__codelineno-92-3 name=__codelineno-92-3 href=#__codelineno-92-3></a><span class=kd>const</span><span class=w> </span><span class=nx>inputSchema</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>z</span><span class=p>.</span><span class=nx>object</span><span class=p>({</span>
</span><span id=__span-92-4><a id=__codelineno-92-4 name=__codelineno-92-4 href=#__codelineno-92-4></a><span class=w>  </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=kt>z.string</span><span class=p>().</span><span class=nx>max</span><span class=p>(</span><span class=mf>100</span><span class=p>).</span><span class=nx>regex</span><span class=p>(</span><span class=sr>/^[a-zA-Z0-9\s]+$/</span><span class=p>),</span>
</span><span id=__span-92-5><a id=__codelineno-92-5 name=__codelineno-92-5 href=#__codelineno-92-5></a><span class=w>  </span><span class=nx>description</span><span class=o>:</span><span class=w> </span><span class=kt>z.string</span><span class=p>().</span><span class=nx>max</span><span class=p>(</span><span class=mf>500</span><span class=p>),</span>
</span><span id=__span-92-6><a id=__codelineno-92-6 name=__codelineno-92-6 href=#__codelineno-92-6></a><span class=p>});</span>
</span><span id=__span-92-7><a id=__codelineno-92-7 name=__codelineno-92-7 href=#__codelineno-92-7></a>
</span><span id=__span-92-8><a id=__codelineno-92-8 name=__codelineno-92-8 href=#__codelineno-92-8></a><span class=kd>const</span><span class=w> </span><span class=nx>validatedInput</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>inputSchema</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>userInput</span><span class=p>);</span>
</span></code></pre></div></p> </li> <li> <p>Configure Content Security Policy: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-93-1><a id=__codelineno-93-1 name=__codelineno-93-1 href=#__codelineno-93-1></a><span class=c1>// next.config.ts</span>
</span><span id=__span-93-2><a id=__codelineno-93-2 name=__codelineno-93-2 href=#__codelineno-93-2></a><span class=kd>const</span><span class=w> </span><span class=nx>securityHeaders</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-93-3><a id=__codelineno-93-3 name=__codelineno-93-3 href=#__codelineno-93-3></a><span class=w>  </span><span class=p>{</span>
</span><span id=__span-93-4><a id=__codelineno-93-4 name=__codelineno-93-4 href=#__codelineno-93-4></a><span class=w>    </span><span class=nx>key</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Content-Security-Policy&#39;</span><span class=p>,</span>
</span><span id=__span-93-5><a id=__codelineno-93-5 name=__codelineno-93-5 href=#__codelineno-93-5></a><span class=w>    </span><span class=nx>value</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;default-src &#39;self&#39;; script-src &#39;self&#39; &#39;unsafe-eval&#39;; style-src &#39;self&#39; &#39;unsafe-inline&#39;&quot;</span>
</span><span id=__span-93-6><a id=__codelineno-93-6 name=__codelineno-93-6 href=#__codelineno-93-6></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-93-7><a id=__codelineno-93-7 name=__codelineno-93-7 href=#__codelineno-93-7></a><span class=p>];</span>
</span></code></pre></div></p> </li> <li> <p>Use secure headers: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-94-1><a id=__codelineno-94-1 name=__codelineno-94-1 href=#__codelineno-94-1></a><span class=kd>const</span><span class=w> </span><span class=nx>secureHeaders</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-94-2><a id=__codelineno-94-2 name=__codelineno-94-2 href=#__codelineno-94-2></a><span class=w>  </span><span class=s1>&#39;X-Frame-Options&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;DENY&#39;</span><span class=p>,</span>
</span><span id=__span-94-3><a id=__codelineno-94-3 name=__codelineno-94-3 href=#__codelineno-94-3></a><span class=w>  </span><span class=s1>&#39;X-Content-Type-Options&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;nosniff&#39;</span><span class=p>,</span>
</span><span id=__span-94-4><a id=__codelineno-94-4 name=__codelineno-94-4 href=#__codelineno-94-4></a><span class=w>  </span><span class=s1>&#39;Referrer-Policy&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;strict-origin-when-cross-origin&#39;</span><span class=p>,</span>
</span><span id=__span-94-5><a id=__codelineno-94-5 name=__codelineno-94-5 href=#__codelineno-94-5></a><span class=w>  </span><span class=s1>&#39;Permissions-Policy&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;camera=(), microphone=(), geolocation=()&#39;</span><span class=p>,</span>
</span><span id=__span-94-6><a id=__codelineno-94-6 name=__codelineno-94-6 href=#__codelineno-94-6></a><span class=p>};</span>
</span></code></pre></div></p> </li> </ol> <p><strong>Prevention Tips:</strong> - Use security linting tools - Regular security audits - Keep dependencies updated</p> <hr> <h2 id=production-deployment-issues>Production Deployment Issues<a class=headerlink href=#production-deployment-issues title="Permanent link">&para;</a></h2> <h3 id=issue-environment-specific-configuration-errors>Issue: Environment-Specific Configuration Errors<a class=headerlink href=#issue-environment-specific-configuration-errors title="Permanent link">&para;</a></h3> <p><strong>Problem Description:</strong> Application works in development but fails in production environment.</p> <p><strong>Symptoms:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-95-1><a id=__codelineno-95-1 name=__codelineno-95-1 href=#__codelineno-95-1></a>Database<span class=w> </span>connection<span class=w> </span>failed<span class=w> </span><span class=k>in</span><span class=w> </span>production
</span><span id=__span-95-2><a id=__codelineno-95-2 name=__codelineno-95-2 href=#__codelineno-95-2></a>OAuth<span class=w> </span>callbacks<span class=w> </span>failing<span class=w> </span>with<span class=w> </span>wrong<span class=w> </span>URL
</span><span id=__span-95-3><a id=__codelineno-95-3 name=__codelineno-95-3 href=#__codelineno-95-3></a>HTTPS<span class=w> </span>redirect<span class=w> </span>loops
</span></code></pre></div></p> <p><strong>Root Cause Analysis:</strong> - Environment variable differences - HTTPS/HTTP configuration issues - Database connection string differences - Firewall or networking restrictions</p> <p><strong>Step-by-step Solution:</strong> 1. Compare environment variables: <div class="language-bash highlight"><pre><span></span><code><span id=__span-96-1><a id=__codelineno-96-1 name=__codelineno-96-1 href=#__codelineno-96-1></a><span class=c1># Development</span>
</span><span id=__span-96-2><a id=__codelineno-96-2 name=__codelineno-96-2 href=#__codelineno-96-2></a>cat<span class=w> </span>.env.local
</span><span id=__span-96-3><a id=__codelineno-96-3 name=__codelineno-96-3 href=#__codelineno-96-3></a>
</span><span id=__span-96-4><a id=__codelineno-96-4 name=__codelineno-96-4 href=#__codelineno-96-4></a><span class=c1># Production  </span>
</span><span id=__span-96-5><a id=__codelineno-96-5 name=__codelineno-96-5 href=#__codelineno-96-5></a><span class=nb>echo</span><span class=w> </span><span class=nv>$DATABASE_URL</span>
</span><span id=__span-96-6><a id=__codelineno-96-6 name=__codelineno-96-6 href=#__codelineno-96-6></a><span class=nb>echo</span><span class=w> </span><span class=nv>$NEXTAUTH_URL</span>
</span><span id=__span-96-7><a id=__codelineno-96-7 name=__codelineno-96-7 href=#__codelineno-96-7></a><span class=nb>echo</span><span class=w> </span><span class=nv>$AUTH_SECRET</span>
</span></code></pre></div></p> <ol> <li> <p>Verify production database access: <div class="language-bash highlight"><pre><span></span><code><span id=__span-97-1><a id=__codelineno-97-1 name=__codelineno-97-1 href=#__codelineno-97-1></a><span class=c1># Test database connection from production server</span>
</span><span id=__span-97-2><a id=__codelineno-97-2 name=__codelineno-97-2 href=#__codelineno-97-2></a>psql<span class=w> </span><span class=nv>$DATABASE_URL</span><span class=w> </span>-c<span class=w> </span><span class=s2>&quot;SELECT 1;&quot;</span>
</span></code></pre></div></p> </li> <li> <p>Check OAuth redirect URIs: <div class="language-bash highlight"><pre><span></span><code><span id=__span-98-1><a id=__codelineno-98-1 name=__codelineno-98-1 href=#__codelineno-98-1></a><span class=c1># Ensure production URLs are registered in OAuth provider</span>
</span><span id=__span-98-2><a id=__codelineno-98-2 name=__codelineno-98-2 href=#__codelineno-98-2></a><span class=c1># Google: https://console.cloud.google.com/</span>
</span><span id=__span-98-3><a id=__codelineno-98-3 name=__codelineno-98-3 href=#__codelineno-98-3></a><span class=c1># Callback URL should be: https://yourdomain.com/api/auth/callback/google</span>
</span></code></pre></div></p> </li> <li> <p>Test HTTPS configuration: <div class="language-bash highlight"><pre><span></span><code><span id=__span-99-1><a id=__codelineno-99-1 name=__codelineno-99-1 href=#__codelineno-99-1></a>curl<span class=w> </span>-I<span class=w> </span>https://yourdomain.com/api/auth/signin
</span></code></pre></div></p> </li> <li> <p>Verify database migrations: <div class="language-bash highlight"><pre><span></span><code><span id=__span-100-1><a id=__codelineno-100-1 name=__codelineno-100-1 href=#__codelineno-100-1></a>pnpm<span class=w> </span>prisma<span class=w> </span>migrate<span class=w> </span>deploy
</span></code></pre></div></p> </li> </ol> <p><strong>Prevention Tips:</strong> - Use environment-specific configurations - Test production builds locally - Implement health check endpoints</p> <p><strong>Related Issues:</strong> - <a href=#environment-variable-problems>Environment Variable Problems</a> - <a href=#database-connection-problems>Database Connection Problems</a></p> <hr> <h3 id=issue-docker-deployment-problems>Issue: Docker Deployment Problems<a class=headerlink href=#issue-docker-deployment-problems title="Permanent link">&para;</a></h3> <p><strong>Problem Description:</strong> Application fails to start or function correctly in Docker containers.</p> <p><strong>Symptoms:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-101-1><a id=__codelineno-101-1 name=__codelineno-101-1 href=#__codelineno-101-1></a>Container<span class=w> </span>exits<span class=w> </span>with<span class=w> </span>code<span class=w> </span><span class=m>1</span>
</span><span id=__span-101-2><a id=__codelineno-101-2 name=__codelineno-101-2 href=#__codelineno-101-2></a>Port<span class=w> </span>binding<span class=w> </span>failures
</span><span id=__span-101-3><a id=__codelineno-101-3 name=__codelineno-101-3 href=#__codelineno-101-3></a>Database<span class=w> </span>connection<span class=w> </span>timeouts
</span></code></pre></div></p> <p><strong>Root Cause Analysis:</strong> - Incorrect Dockerfile configuration - Network connectivity issues between containers - Missing build dependencies - File permission problems</p> <p><strong>Step-by-step Solution:</strong> 1. Verify Dockerfile: <div class="language-dockerfile highlight"><pre><span></span><code><span id=__span-102-1><a id=__codelineno-102-1 name=__codelineno-102-1 href=#__codelineno-102-1></a><span class=k>FROM</span><span class=w> </span><span class=s>node:18-alpine</span>
</span><span id=__span-102-2><a id=__codelineno-102-2 name=__codelineno-102-2 href=#__codelineno-102-2></a>
</span><span id=__span-102-3><a id=__codelineno-102-3 name=__codelineno-102-3 href=#__codelineno-102-3></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/app</span>
</span><span id=__span-102-4><a id=__codelineno-102-4 name=__codelineno-102-4 href=#__codelineno-102-4></a>
</span><span id=__span-102-5><a id=__codelineno-102-5 name=__codelineno-102-5 href=#__codelineno-102-5></a><span class=c># Copy package files first for better caching</span>
</span><span id=__span-102-6><a id=__codelineno-102-6 name=__codelineno-102-6 href=#__codelineno-102-6></a><span class=k>COPY</span><span class=w> </span>package*.json<span class=w> </span>./
</span><span id=__span-102-7><a id=__codelineno-102-7 name=__codelineno-102-7 href=#__codelineno-102-7></a><span class=k>COPY</span><span class=w> </span>pnpm-lock.yaml<span class=w> </span>./
</span><span id=__span-102-8><a id=__codelineno-102-8 name=__codelineno-102-8 href=#__codelineno-102-8></a>
</span><span id=__span-102-9><a id=__codelineno-102-9 name=__codelineno-102-9 href=#__codelineno-102-9></a><span class=c># Install dependencies</span>
</span><span id=__span-102-10><a id=__codelineno-102-10 name=__codelineno-102-10 href=#__codelineno-102-10></a><span class=k>RUN</span><span class=w> </span>npm<span class=w> </span>install<span class=w> </span>-g<span class=w> </span>pnpm
</span><span id=__span-102-11><a id=__codelineno-102-11 name=__codelineno-102-11 href=#__codelineno-102-11></a><span class=k>RUN</span><span class=w> </span>pnpm<span class=w> </span>install<span class=w> </span>--frozen-lockfile
</span><span id=__span-102-12><a id=__codelineno-102-12 name=__codelineno-102-12 href=#__codelineno-102-12></a>
</span><span id=__span-102-13><a id=__codelineno-102-13 name=__codelineno-102-13 href=#__codelineno-102-13></a><span class=c># Copy source code</span>
</span><span id=__span-102-14><a id=__codelineno-102-14 name=__codelineno-102-14 href=#__codelineno-102-14></a><span class=k>COPY</span><span class=w> </span>.<span class=w> </span>.
</span><span id=__span-102-15><a id=__codelineno-102-15 name=__codelineno-102-15 href=#__codelineno-102-15></a>
</span><span id=__span-102-16><a id=__codelineno-102-16 name=__codelineno-102-16 href=#__codelineno-102-16></a><span class=c># Generate Prisma client</span>
</span><span id=__span-102-17><a id=__codelineno-102-17 name=__codelineno-102-17 href=#__codelineno-102-17></a><span class=k>RUN</span><span class=w> </span>pnpm<span class=w> </span>prisma<span class=w> </span>generate
</span><span id=__span-102-18><a id=__codelineno-102-18 name=__codelineno-102-18 href=#__codelineno-102-18></a>
</span><span id=__span-102-19><a id=__codelineno-102-19 name=__codelineno-102-19 href=#__codelineno-102-19></a><span class=c># Build application</span>
</span><span id=__span-102-20><a id=__codelineno-102-20 name=__codelineno-102-20 href=#__codelineno-102-20></a><span class=k>RUN</span><span class=w> </span>pnpm<span class=w> </span>build
</span><span id=__span-102-21><a id=__codelineno-102-21 name=__codelineno-102-21 href=#__codelineno-102-21></a>
</span><span id=__span-102-22><a id=__codelineno-102-22 name=__codelineno-102-22 href=#__codelineno-102-22></a><span class=k>EXPOSE</span><span class=w> </span><span class=s>3000</span>
</span><span id=__span-102-23><a id=__codelineno-102-23 name=__codelineno-102-23 href=#__codelineno-102-23></a><span class=k>CMD</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;pnpm&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;start&quot;</span><span class=p>]</span>
</span></code></pre></div></p> <ol> <li> <p>Check Docker Compose configuration: <div class="language-yaml highlight"><pre><span></span><code><span id=__span-103-1><a id=__codelineno-103-1 name=__codelineno-103-1 href=#__codelineno-103-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-103-2><a id=__codelineno-103-2 name=__codelineno-103-2 href=#__codelineno-103-2></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-103-3><a id=__codelineno-103-3 name=__codelineno-103-3 href=#__codelineno-103-3></a><span class=w>  </span><span class=nt>app</span><span class=p>:</span>
</span><span id=__span-103-4><a id=__codelineno-103-4 name=__codelineno-103-4 href=#__codelineno-103-4></a><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
</span><span id=__span-103-5><a id=__codelineno-103-5 name=__codelineno-103-5 href=#__codelineno-103-5></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-103-6><a id=__codelineno-103-6 name=__codelineno-103-6 href=#__codelineno-103-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;3000:3000&quot;</span>
</span><span id=__span-103-7><a id=__codelineno-103-7 name=__codelineno-103-7 href=#__codelineno-103-7></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-103-8><a id=__codelineno-103-8 name=__codelineno-103-8 href=#__codelineno-103-8></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URL=postgresql://user:pass@db:5432/oauth</span>
</span><span id=__span-103-9><a id=__codelineno-103-9 name=__codelineno-103-9 href=#__codelineno-103-9></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span>
</span><span id=__span-103-10><a id=__codelineno-103-10 name=__codelineno-103-10 href=#__codelineno-103-10></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
</span><span id=__span-103-11><a id=__codelineno-103-11 name=__codelineno-103-11 href=#__codelineno-103-11></a>
</span><span id=__span-103-12><a id=__codelineno-103-12 name=__codelineno-103-12 href=#__codelineno-103-12></a><span class=w>  </span><span class=nt>db</span><span class=p>:</span>
</span><span id=__span-103-13><a id=__codelineno-103-13 name=__codelineno-103-13 href=#__codelineno-103-13></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres:14</span>
</span><span id=__span-103-14><a id=__codelineno-103-14 name=__codelineno-103-14 href=#__codelineno-103-14></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-103-15><a id=__codelineno-103-15 name=__codelineno-103-15 href=#__codelineno-103-15></a><span class=w>      </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">oauth</span>
</span><span id=__span-103-16><a id=__codelineno-103-16 name=__codelineno-103-16 href=#__codelineno-103-16></a><span class=w>      </span><span class=nt>POSTGRES_USER</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id=__span-103-17><a id=__codelineno-103-17 name=__codelineno-103-17 href=#__codelineno-103-17></a><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">pass</span>
</span><span id=__span-103-18><a id=__codelineno-103-18 name=__codelineno-103-18 href=#__codelineno-103-18></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-103-19><a id=__codelineno-103-19 name=__codelineno-103-19 href=#__codelineno-103-19></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres_data:/var/lib/postgresql/data</span>
</span><span id=__span-103-20><a id=__codelineno-103-20 name=__codelineno-103-20 href=#__codelineno-103-20></a>
</span><span id=__span-103-21><a id=__codelineno-103-21 name=__codelineno-103-21 href=#__codelineno-103-21></a><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-103-22><a id=__codelineno-103-22 name=__codelineno-103-22 href=#__codelineno-103-22></a><span class=w>  </span><span class=nt>postgres_data</span><span class=p>:</span>
</span></code></pre></div></p> </li> <li> <p>Test container networking: <div class="language-bash highlight"><pre><span></span><code><span id=__span-104-1><a id=__codelineno-104-1 name=__codelineno-104-1 href=#__codelineno-104-1></a><span class=c1># From within app container</span>
</span><span id=__span-104-2><a id=__codelineno-104-2 name=__codelineno-104-2 href=#__codelineno-104-2></a>ping<span class=w> </span>db
</span><span id=__span-104-3><a id=__codelineno-104-3 name=__codelineno-104-3 href=#__codelineno-104-3></a>telnet<span class=w> </span>db<span class=w> </span><span class=m>5432</span>
</span></code></pre></div></p> </li> <li> <p>Check container logs: <div class="language-bash highlight"><pre><span></span><code><span id=__span-105-1><a id=__codelineno-105-1 name=__codelineno-105-1 href=#__codelineno-105-1></a>docker<span class=w> </span>logs<span class=w> </span>container-name
</span><span id=__span-105-2><a id=__codelineno-105-2 name=__codelineno-105-2 href=#__codelineno-105-2></a>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>-it<span class=w> </span>container-name<span class=w> </span>sh
</span></code></pre></div></p> </li> </ol> <p><strong>Prevention Tips:</strong> - Use multi-stage Docker builds - Test Docker builds locally - Implement proper health checks</p> <hr> <h2 id=environment-variable-problems>Environment Variable Problems<a class=headerlink href=#environment-variable-problems title="Permanent link">&para;</a></h2> <h3 id=issue-missing-or-invalid-environment-variables>Issue: Missing or Invalid Environment Variables<a class=headerlink href=#issue-missing-or-invalid-environment-variables title="Permanent link">&para;</a></h3> <p><strong>Problem Description:</strong> Application fails to start due to missing or incorrectly configured environment variables.</p> <p><strong>Symptoms:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-106-1><a id=__codelineno-106-1 name=__codelineno-106-1 href=#__codelineno-106-1></a>Error:<span class=w> </span>GOOGLE_CLIENT_ID<span class=w> </span>is<span class=w> </span>required
</span><span id=__span-106-2><a id=__codelineno-106-2 name=__codelineno-106-2 href=#__codelineno-106-2></a>Database<span class=w> </span>connection<span class=w> </span>string<span class=w> </span>is<span class=w> </span>invalid
</span><span id=__span-106-3><a id=__codelineno-106-3 name=__codelineno-106-3 href=#__codelineno-106-3></a>AUTH_SECRET<span class=w> </span>must<span class=w> </span>be<span class=w> </span>at<span class=w> </span>least<span class=w> </span><span class=m>32</span><span class=w> </span>characters
</span></code></pre></div></p> <p><strong>Root Cause Analysis:</strong> - Environment variables not loaded - Incorrect variable names - Invalid variable values - Environment file not found</p> <p><strong>Step-by-step Solution:</strong> 1. Create environment file template: <div class="language-bash highlight"><pre><span></span><code><span id=__span-107-1><a id=__codelineno-107-1 name=__codelineno-107-1 href=#__codelineno-107-1></a><span class=c1># .env.example</span>
</span><span id=__span-107-2><a id=__codelineno-107-2 name=__codelineno-107-2 href=#__codelineno-107-2></a><span class=nv>DATABASE_URL</span><span class=o>=</span><span class=s2>&quot;postgresql://username:password@localhost:5432/database_name&quot;</span>
</span><span id=__span-107-3><a id=__codelineno-107-3 name=__codelineno-107-3 href=#__codelineno-107-3></a><span class=nv>AUTH_SECRET</span><span class=o>=</span><span class=s2>&quot;your-auth-secret-at-least-32-characters-long&quot;</span>
</span><span id=__span-107-4><a id=__codelineno-107-4 name=__codelineno-107-4 href=#__codelineno-107-4></a><span class=nv>GOOGLE_CLIENT_ID</span><span class=o>=</span><span class=s2>&quot;your-google-client-id.apps.googleusercontent.com&quot;</span>
</span><span id=__span-107-5><a id=__codelineno-107-5 name=__codelineno-107-5 href=#__codelineno-107-5></a><span class=nv>GOOGLE_CLIENT_SECRET</span><span class=o>=</span><span class=s2>&quot;your-google-client-secret&quot;</span>
</span><span id=__span-107-6><a id=__codelineno-107-6 name=__codelineno-107-6 href=#__codelineno-107-6></a><span class=nv>NEXTAUTH_URL</span><span class=o>=</span><span class=s2>&quot;http://localhost:3000&quot;</span>
</span><span id=__span-107-7><a id=__codelineno-107-7 name=__codelineno-107-7 href=#__codelineno-107-7></a><span class=nv>REDIS_URL</span><span class=o>=</span><span class=s2>&quot;redis://localhost:6379&quot;</span><span class=w> </span><span class=c1># Optional</span>
</span></code></pre></div></p> <ol> <li> <p>Validate environment variables: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-108-1><a id=__codelineno-108-1 name=__codelineno-108-1 href=#__codelineno-108-1></a><span class=c1>// lib/env.ts</span>
</span><span id=__span-108-2><a id=__codelineno-108-2 name=__codelineno-108-2 href=#__codelineno-108-2></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>z</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s1>&#39;zod&#39;</span><span class=p>;</span>
</span><span id=__span-108-3><a id=__codelineno-108-3 name=__codelineno-108-3 href=#__codelineno-108-3></a>
</span><span id=__span-108-4><a id=__codelineno-108-4 name=__codelineno-108-4 href=#__codelineno-108-4></a><span class=kd>const</span><span class=w> </span><span class=nx>envSchema</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>z</span><span class=p>.</span><span class=nx>object</span><span class=p>({</span>
</span><span id=__span-108-5><a id=__codelineno-108-5 name=__codelineno-108-5 href=#__codelineno-108-5></a><span class=w>  </span><span class=nx>DATABASE_URL</span><span class=o>:</span><span class=w> </span><span class=kt>z.string</span><span class=p>().</span><span class=nx>url</span><span class=p>(),</span>
</span><span id=__span-108-6><a id=__codelineno-108-6 name=__codelineno-108-6 href=#__codelineno-108-6></a><span class=w>  </span><span class=nx>AUTH_SECRET</span><span class=o>:</span><span class=w> </span><span class=kt>z.string</span><span class=p>().</span><span class=nx>min</span><span class=p>(</span><span class=mf>32</span><span class=p>),</span>
</span><span id=__span-108-7><a id=__codelineno-108-7 name=__codelineno-108-7 href=#__codelineno-108-7></a><span class=w>  </span><span class=nx>GOOGLE_CLIENT_ID</span><span class=o>:</span><span class=w> </span><span class=kt>z.string</span><span class=p>().</span><span class=nx>min</span><span class=p>(</span><span class=mf>1</span><span class=p>),</span>
</span><span id=__span-108-8><a id=__codelineno-108-8 name=__codelineno-108-8 href=#__codelineno-108-8></a><span class=w>  </span><span class=nx>GOOGLE_CLIENT_SECRET</span><span class=o>:</span><span class=w> </span><span class=kt>z.string</span><span class=p>().</span><span class=nx>min</span><span class=p>(</span><span class=mf>1</span><span class=p>),</span>
</span><span id=__span-108-9><a id=__codelineno-108-9 name=__codelineno-108-9 href=#__codelineno-108-9></a><span class=w>  </span><span class=nx>NEXTAUTH_URL</span><span class=o>:</span><span class=w> </span><span class=kt>z.string</span><span class=p>().</span><span class=nx>url</span><span class=p>().</span><span class=nx>optional</span><span class=p>(),</span>
</span><span id=__span-108-10><a id=__codelineno-108-10 name=__codelineno-108-10 href=#__codelineno-108-10></a><span class=w>  </span><span class=nx>REDIS_URL</span><span class=o>:</span><span class=w> </span><span class=kt>z.string</span><span class=p>().</span><span class=nx>url</span><span class=p>().</span><span class=nx>optional</span><span class=p>(),</span>
</span><span id=__span-108-11><a id=__codelineno-108-11 name=__codelineno-108-11 href=#__codelineno-108-11></a><span class=p>});</span>
</span><span id=__span-108-12><a id=__codelineno-108-12 name=__codelineno-108-12 href=#__codelineno-108-12></a>
</span><span id=__span-108-13><a id=__codelineno-108-13 name=__codelineno-108-13 href=#__codelineno-108-13></a><span class=k>export</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=nx>env</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>envSchema</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>);</span>
</span></code></pre></div></p> </li> <li> <p>Check environment loading: <div class="language-bash highlight"><pre><span></span><code><span id=__span-109-1><a id=__codelineno-109-1 name=__codelineno-109-1 href=#__codelineno-109-1></a><span class=c1># Verify variables are loaded</span>
</span><span id=__span-109-2><a id=__codelineno-109-2 name=__codelineno-109-2 href=#__codelineno-109-2></a>node<span class=w> </span>-e<span class=w> </span><span class=s2>&quot;console.log(process.env.DATABASE_URL)&quot;</span>
</span></code></pre></div></p> </li> <li> <p>Test database connection string: <div class="language-bash highlight"><pre><span></span><code><span id=__span-110-1><a id=__codelineno-110-1 name=__codelineno-110-1 href=#__codelineno-110-1></a><span class=c1># Parse and validate DATABASE_URL</span>
</span><span id=__span-110-2><a id=__codelineno-110-2 name=__codelineno-110-2 href=#__codelineno-110-2></a>node<span class=w> </span>-e<span class=w> </span><span class=s2>&quot;</span>
</span><span id=__span-110-3><a id=__codelineno-110-3 name=__codelineno-110-3 href=#__codelineno-110-3></a><span class=s2>const url = new URL(process.env.DATABASE_URL);</span>
</span><span id=__span-110-4><a id=__codelineno-110-4 name=__codelineno-110-4 href=#__codelineno-110-4></a><span class=s2>console.log(&#39;Host:&#39;, url.hostname);</span>
</span><span id=__span-110-5><a id=__codelineno-110-5 name=__codelineno-110-5 href=#__codelineno-110-5></a><span class=s2>console.log(&#39;Database:&#39;, url.pathname.slice(1));</span>
</span><span id=__span-110-6><a id=__codelineno-110-6 name=__codelineno-110-6 href=#__codelineno-110-6></a><span class=s2>console.log(&#39;User:&#39;, url.username);</span>
</span><span id=__span-110-7><a id=__codelineno-110-7 name=__codelineno-110-7 href=#__codelineno-110-7></a><span class=s2>&quot;</span>
</span></code></pre></div></p> </li> </ol> <p><strong>Prevention Tips:</strong> - Use environment variable validation - Document all required variables - Use development-specific defaults where safe</p> <p><strong>Related Issues:</strong> - <a href=#common-setup-issues>Common Setup Issues</a> - <a href=#production-deployment-issues>Production Deployment Issues</a></p> <hr> <h3 id=issue-environment-variable-security>Issue: Environment Variable Security<a class=headerlink href=#issue-environment-variable-security title="Permanent link">&para;</a></h3> <p><strong>Problem Description:</strong> Sensitive environment variables exposed or not properly secured.</p> <p><strong>Symptoms:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-111-1><a id=__codelineno-111-1 name=__codelineno-111-1 href=#__codelineno-111-1></a>Secrets<span class=w> </span>visible<span class=w> </span><span class=k>in</span><span class=w> </span>logs
</span><span id=__span-111-2><a id=__codelineno-111-2 name=__codelineno-111-2 href=#__codelineno-111-2></a>Environment<span class=w> </span>variables<span class=w> </span><span class=k>in</span><span class=w> </span>version<span class=w> </span>control
</span><span id=__span-111-3><a id=__codelineno-111-3 name=__codelineno-111-3 href=#__codelineno-111-3></a>Unauthorized<span class=w> </span>access<span class=w> </span>to<span class=w> </span>configuration
</span></code></pre></div></p> <p><strong>Root Cause Analysis:</strong> - Environment files committed to version control - Secrets logged in plain text - Insufficient access controls - Shared development environments</p> <p><strong>Step-by-step Solution:</strong> 1. Audit version control: <div class="language-bash highlight"><pre><span></span><code><span id=__span-112-1><a id=__codelineno-112-1 name=__codelineno-112-1 href=#__codelineno-112-1></a><span class=c1># Check if .env files are in git</span>
</span><span id=__span-112-2><a id=__codelineno-112-2 name=__codelineno-112-2 href=#__codelineno-112-2></a>git<span class=w> </span>ls-files<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-E<span class=w> </span><span class=s1>&#39;\.(env|secret)&#39;</span>
</span><span id=__span-112-3><a id=__codelineno-112-3 name=__codelineno-112-3 href=#__codelineno-112-3></a>
</span><span id=__span-112-4><a id=__codelineno-112-4 name=__codelineno-112-4 href=#__codelineno-112-4></a><span class=c1># Remove from version control if found</span>
</span><span id=__span-112-5><a id=__codelineno-112-5 name=__codelineno-112-5 href=#__codelineno-112-5></a>git<span class=w> </span>rm<span class=w> </span>--cached<span class=w> </span>.env
</span><span id=__span-112-6><a id=__codelineno-112-6 name=__codelineno-112-6 href=#__codelineno-112-6></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;.env*&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>.gitignore
</span></code></pre></div></p> <ol> <li> <p>Scan for secrets in logs: <div class="language-bash highlight"><pre><span></span><code><span id=__span-113-1><a id=__codelineno-113-1 name=__codelineno-113-1 href=#__codelineno-113-1></a><span class=c1># Search for potential secrets in logs</span>
</span><span id=__span-113-2><a id=__codelineno-113-2 name=__codelineno-113-2 href=#__codelineno-113-2></a>grep<span class=w> </span>-r<span class=w> </span><span class=s2>&quot;client_secret\|password\|key&quot;</span><span class=w> </span>logs/
</span></code></pre></div></p> </li> <li> <p>Use secret management: <div class="language-bash highlight"><pre><span></span><code><span id=__span-114-1><a id=__codelineno-114-1 name=__codelineno-114-1 href=#__codelineno-114-1></a><span class=c1># Use external secret management</span>
</span><span id=__span-114-2><a id=__codelineno-114-2 name=__codelineno-114-2 href=#__codelineno-114-2></a><span class=c1># AWS Secrets Manager, HashiCorp Vault, etc.</span>
</span><span id=__span-114-3><a id=__codelineno-114-3 name=__codelineno-114-3 href=#__codelineno-114-3></a><span class=nb>export</span><span class=w> </span><span class=nv>DATABASE_URL</span><span class=o>=</span><span class=k>$(</span>aws<span class=w> </span>secretsmanager<span class=w> </span>get-secret-value<span class=w> </span>--secret-id<span class=w> </span>prod/database<span class=w> </span>--query<span class=w> </span>SecretString<span class=w> </span>--output<span class=w> </span>text<span class=k>)</span>
</span></code></pre></div></p> </li> <li> <p>Implement secret rotation: <div class="language-typescript highlight"><pre><span></span><code><span id=__span-115-1><a id=__codelineno-115-1 name=__codelineno-115-1 href=#__codelineno-115-1></a><span class=c1>// Implement regular secret rotation</span>
</span><span id=__span-115-2><a id=__codelineno-115-2 name=__codelineno-115-2 href=#__codelineno-115-2></a><span class=k>async</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>rotateSecrets</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-115-3><a id=__codelineno-115-3 name=__codelineno-115-3 href=#__codelineno-115-3></a><span class=w>  </span><span class=c1>// Generate new secrets</span>
</span><span id=__span-115-4><a id=__codelineno-115-4 name=__codelineno-115-4 href=#__codelineno-115-4></a><span class=w>  </span><span class=c1>// Update external services</span>
</span><span id=__span-115-5><a id=__codelineno-115-5 name=__codelineno-115-5 href=#__codelineno-115-5></a><span class=w>  </span><span class=c1>// Update application configuration</span>
</span><span id=__span-115-6><a id=__codelineno-115-6 name=__codelineno-115-6 href=#__codelineno-115-6></a><span class=p>}</span>
</span></code></pre></div></p> </li> </ol> <p><strong>Prevention Tips:</strong> - Use secret scanning tools - Implement least privilege access - Regular secret rotation - Audit access logs</p> <hr> <h2 id=debugging-tools-and-techniques>Debugging Tools and Techniques<a class=headerlink href=#debugging-tools-and-techniques title="Permanent link">&para;</a></h2> <h3 id=development-debugging-tools>Development Debugging Tools<a class=headerlink href=#development-debugging-tools title="Permanent link">&para;</a></h3> <p><strong>Next.js Debug Mode:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-116-1><a id=__codelineno-116-1 name=__codelineno-116-1 href=#__codelineno-116-1></a><span class=c1># Enable Next.js debugging</span>
</span><span id=__span-116-2><a id=__codelineno-116-2 name=__codelineno-116-2 href=#__codelineno-116-2></a><span class=nv>NODE_OPTIONS</span><span class=o>=</span><span class=s1>&#39;--inspect&#39;</span><span class=w> </span>pnpm<span class=w> </span>dev
</span><span id=__span-116-3><a id=__codelineno-116-3 name=__codelineno-116-3 href=#__codelineno-116-3></a>
</span><span id=__span-116-4><a id=__codelineno-116-4 name=__codelineno-116-4 href=#__codelineno-116-4></a><span class=c1># With specific debug port</span>
</span><span id=__span-116-5><a id=__codelineno-116-5 name=__codelineno-116-5 href=#__codelineno-116-5></a><span class=nv>NODE_OPTIONS</span><span class=o>=</span><span class=s1>&#39;--inspect=9229&#39;</span><span class=w> </span>pnpm<span class=w> </span>dev
</span></code></pre></div></p> <p><strong>Database Debugging:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-117-1><a id=__codelineno-117-1 name=__codelineno-117-1 href=#__codelineno-117-1></a><span class=c1># Prisma Studio for database inspection</span>
</span><span id=__span-117-2><a id=__codelineno-117-2 name=__codelineno-117-2 href=#__codelineno-117-2></a>pnpm<span class=w> </span>prisma<span class=w> </span>studio
</span><span id=__span-117-3><a id=__codelineno-117-3 name=__codelineno-117-3 href=#__codelineno-117-3></a>
</span><span id=__span-117-4><a id=__codelineno-117-4 name=__codelineno-117-4 href=#__codelineno-117-4></a><span class=c1># Database query logging</span>
</span><span id=__span-117-5><a id=__codelineno-117-5 name=__codelineno-117-5 href=#__codelineno-117-5></a><span class=nb>export</span><span class=w> </span><span class=nv>DEBUG</span><span class=o>=</span><span class=s2>&quot;prisma:query&quot;</span>
</span><span id=__span-117-6><a id=__codelineno-117-6 name=__codelineno-117-6 href=#__codelineno-117-6></a>pnpm<span class=w> </span>dev
</span></code></pre></div></p> <p><strong>Network Debugging:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-118-1><a id=__codelineno-118-1 name=__codelineno-118-1 href=#__codelineno-118-1></a><span class=c1># Monitor HTTP requests</span>
</span><span id=__span-118-2><a id=__codelineno-118-2 name=__codelineno-118-2 href=#__codelineno-118-2></a>curl<span class=w> </span>-v<span class=w> </span>http://localhost:3000/api/oauth/token
</span><span id=__span-118-3><a id=__codelineno-118-3 name=__codelineno-118-3 href=#__codelineno-118-3></a>
</span><span id=__span-118-4><a id=__codelineno-118-4 name=__codelineno-118-4 href=#__codelineno-118-4></a><span class=c1># WebSocket/SSE debugging</span>
</span><span id=__span-118-5><a id=__codelineno-118-5 name=__codelineno-118-5 href=#__codelineno-118-5></a>websocat<span class=w> </span>ws://localhost:3000/mcp/sse
</span></code></pre></div></p> <h3 id=production-monitoring>Production Monitoring<a class=headerlink href=#production-monitoring title="Permanent link">&para;</a></h3> <p><strong>Health Check Endpoints:</strong> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-119-1><a id=__codelineno-119-1 name=__codelineno-119-1 href=#__codelineno-119-1></a><span class=c1>// app/api/health/route.ts</span>
</span><span id=__span-119-2><a id=__codelineno-119-2 name=__codelineno-119-2 href=#__codelineno-119-2></a><span class=k>export</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>GET</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-119-3><a id=__codelineno-119-3 name=__codelineno-119-3 href=#__codelineno-119-3></a><span class=w>  </span><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-119-4><a id=__codelineno-119-4 name=__codelineno-119-4 href=#__codelineno-119-4></a><span class=w>    </span><span class=c1>// Test database connectivity</span>
</span><span id=__span-119-5><a id=__codelineno-119-5 name=__codelineno-119-5 href=#__codelineno-119-5></a><span class=w>    </span><span class=k>await</span><span class=w> </span><span class=nx>prisma</span><span class=p>.</span><span class=nx>$queryRaw</span><span class=sb>`SELECT 1`</span><span class=p>;</span>
</span><span id=__span-119-6><a id=__codelineno-119-6 name=__codelineno-119-6 href=#__codelineno-119-6></a>
</span><span id=__span-119-7><a id=__codelineno-119-7 name=__codelineno-119-7 href=#__codelineno-119-7></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>NextResponse</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span>
</span><span id=__span-119-8><a id=__codelineno-119-8 name=__codelineno-119-8 href=#__codelineno-119-8></a><span class=w>      </span><span class=nx>status</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;healthy&#39;</span><span class=p>,</span>
</span><span id=__span-119-9><a id=__codelineno-119-9 name=__codelineno-119-9 href=#__codelineno-119-9></a><span class=w>      </span><span class=nx>timestamp</span><span class=o>:</span><span class=w> </span><span class=kt>new</span><span class=w> </span><span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>(),</span>
</span><span id=__span-119-10><a id=__codelineno-119-10 name=__codelineno-119-10 href=#__codelineno-119-10></a><span class=w>      </span><span class=nx>services</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-119-11><a id=__codelineno-119-11 name=__codelineno-119-11 href=#__codelineno-119-11></a><span class=w>        </span><span class=nx>database</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;up&#39;</span><span class=p>,</span>
</span><span id=__span-119-12><a id=__codelineno-119-12 name=__codelineno-119-12 href=#__codelineno-119-12></a><span class=w>        </span><span class=nx>oauth</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;up&#39;</span>
</span><span id=__span-119-13><a id=__codelineno-119-13 name=__codelineno-119-13 href=#__codelineno-119-13></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-119-14><a id=__codelineno-119-14 name=__codelineno-119-14 href=#__codelineno-119-14></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-119-15><a id=__codelineno-119-15 name=__codelineno-119-15 href=#__codelineno-119-15></a><span class=w>  </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=nx>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-119-16><a id=__codelineno-119-16 name=__codelineno-119-16 href=#__codelineno-119-16></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>NextResponse</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span>
</span><span id=__span-119-17><a id=__codelineno-119-17 name=__codelineno-119-17 href=#__codelineno-119-17></a><span class=w>      </span><span class=nx>status</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;unhealthy&#39;</span><span class=p>,</span>
</span><span id=__span-119-18><a id=__codelineno-119-18 name=__codelineno-119-18 href=#__codelineno-119-18></a><span class=w>      </span><span class=nx>error</span><span class=o>:</span><span class=w> </span><span class=kt>error.message</span>
</span><span id=__span-119-19><a id=__codelineno-119-19 name=__codelineno-119-19 href=#__codelineno-119-19></a><span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>status</span><span class=o>:</span><span class=w> </span><span class=kt>503</span><span class=w> </span><span class=p>});</span>
</span><span id=__span-119-20><a id=__codelineno-119-20 name=__codelineno-119-20 href=#__codelineno-119-20></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-119-21><a id=__codelineno-119-21 name=__codelineno-119-21 href=#__codelineno-119-21></a><span class=p>}</span>
</span></code></pre></div></p> <p><strong>Logging Configuration:</strong> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-120-1><a id=__codelineno-120-1 name=__codelineno-120-1 href=#__codelineno-120-1></a><span class=c1>// lib/logger.ts</span>
</span><span id=__span-120-2><a id=__codelineno-120-2 name=__codelineno-120-2 href=#__codelineno-120-2></a><span class=k>export</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=nx>logger</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-120-3><a id=__codelineno-120-3 name=__codelineno-120-3 href=#__codelineno-120-3></a><span class=w>  </span><span class=nx>info</span><span class=o>:</span><span class=w> </span><span class=p>(</span><span class=nx>message</span><span class=o>:</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>meta?</span><span class=o>:</span><span class=w> </span><span class=kt>any</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-120-4><a id=__codelineno-120-4 name=__codelineno-120-4 href=#__codelineno-120-4></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nb>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span>
</span><span id=__span-120-5><a id=__codelineno-120-5 name=__codelineno-120-5 href=#__codelineno-120-5></a><span class=w>      </span><span class=nx>timestamp</span><span class=o>:</span><span class=w> </span><span class=kt>new</span><span class=w> </span><span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>(),</span>
</span><span id=__span-120-6><a id=__codelineno-120-6 name=__codelineno-120-6 href=#__codelineno-120-6></a><span class=w>      </span><span class=nx>level</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;info&#39;</span><span class=p>,</span>
</span><span id=__span-120-7><a id=__codelineno-120-7 name=__codelineno-120-7 href=#__codelineno-120-7></a><span class=w>      </span><span class=nx>message</span><span class=p>,</span>
</span><span id=__span-120-8><a id=__codelineno-120-8 name=__codelineno-120-8 href=#__codelineno-120-8></a><span class=w>      </span><span class=p>...</span><span class=nx>meta</span>
</span><span id=__span-120-9><a id=__codelineno-120-9 name=__codelineno-120-9 href=#__codelineno-120-9></a><span class=w>    </span><span class=p>}));</span>
</span><span id=__span-120-10><a id=__codelineno-120-10 name=__codelineno-120-10 href=#__codelineno-120-10></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-120-11><a id=__codelineno-120-11 name=__codelineno-120-11 href=#__codelineno-120-11></a><span class=w>  </span><span class=nx>error</span><span class=o>:</span><span class=w> </span><span class=p>(</span><span class=nx>message</span><span class=o>:</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>error?</span><span class=o>:</span><span class=w> </span><span class=kt>Error</span><span class=p>,</span><span class=w> </span><span class=nx>meta?</span><span class=o>:</span><span class=w> </span><span class=kt>any</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-120-12><a id=__codelineno-120-12 name=__codelineno-120-12 href=#__codelineno-120-12></a><span class=w>    </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nb>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span>
</span><span id=__span-120-13><a id=__codelineno-120-13 name=__codelineno-120-13 href=#__codelineno-120-13></a><span class=w>      </span><span class=nx>timestamp</span><span class=o>:</span><span class=w> </span><span class=kt>new</span><span class=w> </span><span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>(),</span>
</span><span id=__span-120-14><a id=__codelineno-120-14 name=__codelineno-120-14 href=#__codelineno-120-14></a><span class=w>      </span><span class=nx>level</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;error&#39;</span><span class=p>,</span>
</span><span id=__span-120-15><a id=__codelineno-120-15 name=__codelineno-120-15 href=#__codelineno-120-15></a><span class=w>      </span><span class=nx>message</span><span class=p>,</span>
</span><span id=__span-120-16><a id=__codelineno-120-16 name=__codelineno-120-16 href=#__codelineno-120-16></a><span class=w>      </span><span class=nx>error</span><span class=o>:</span><span class=w> </span><span class=kt>error?.stack</span><span class=p>,</span>
</span><span id=__span-120-17><a id=__codelineno-120-17 name=__codelineno-120-17 href=#__codelineno-120-17></a><span class=w>      </span><span class=p>...</span><span class=nx>meta</span>
</span><span id=__span-120-18><a id=__codelineno-120-18 name=__codelineno-120-18 href=#__codelineno-120-18></a><span class=w>    </span><span class=p>}));</span>
</span><span id=__span-120-19><a id=__codelineno-120-19 name=__codelineno-120-19 href=#__codelineno-120-19></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-120-20><a id=__codelineno-120-20 name=__codelineno-120-20 href=#__codelineno-120-20></a><span class=p>};</span>
</span></code></pre></div></p> <p><strong>Performance Monitoring:</strong> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-121-1><a id=__codelineno-121-1 name=__codelineno-121-1 href=#__codelineno-121-1></a><span class=c1>// middleware.ts</span>
</span><span id=__span-121-2><a id=__codelineno-121-2 name=__codelineno-121-2 href=#__codelineno-121-2></a><span class=k>export</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>middleware</span><span class=p>(</span><span class=nx>request</span><span class=o>:</span><span class=w> </span><span class=kt>NextRequest</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-121-3><a id=__codelineno-121-3 name=__codelineno-121-3 href=#__codelineno-121-3></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>start</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span><span id=__span-121-4><a id=__codelineno-121-4 name=__codelineno-121-4 href=#__codelineno-121-4></a>
</span><span id=__span-121-5><a id=__codelineno-121-5 name=__codelineno-121-5 href=#__codelineno-121-5></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>NextResponse</span><span class=p>.</span><span class=nx>next</span><span class=p>();</span>
</span><span id=__span-121-6><a id=__codelineno-121-6 name=__codelineno-121-6 href=#__codelineno-121-6></a>
</span><span id=__span-121-7><a id=__codelineno-121-7 name=__codelineno-121-7 href=#__codelineno-121-7></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>duration</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=nx>start</span><span class=p>;</span>
</span><span id=__span-121-8><a id=__codelineno-121-8 name=__codelineno-121-8 href=#__codelineno-121-8></a><span class=w>  </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>request</span><span class=p>.</span><span class=nx>method</span><span class=si>}</span><span class=sb> </span><span class=si>${</span><span class=nx>request</span><span class=p>.</span><span class=nx>url</span><span class=si>}</span><span class=sb> - </span><span class=si>${</span><span class=nx>duration</span><span class=si>}</span><span class=sb>ms`</span><span class=p>);</span>
</span><span id=__span-121-9><a id=__codelineno-121-9 name=__codelineno-121-9 href=#__codelineno-121-9></a>
</span><span id=__span-121-10><a id=__codelineno-121-10 name=__codelineno-121-10 href=#__codelineno-121-10></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>response</span><span class=p>;</span>
</span><span id=__span-121-11><a id=__codelineno-121-11 name=__codelineno-121-11 href=#__codelineno-121-11></a><span class=p>}</span>
</span></code></pre></div></p> <h3 id=debugging-checklist>Debugging Checklist<a class=headerlink href=#debugging-checklist title="Permanent link">&para;</a></h3> <p><strong>When Encountering Issues:</strong> 1. Check application logs first 2. Verify environment variables 3. Test database connectivity 4. Validate API endpoints manually 5. Review recent code changes 6. Check external service status 7. Monitor resource usage 8. Test in isolated environment</p> <p><strong>Log Analysis Commands:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-122-1><a id=__codelineno-122-1 name=__codelineno-122-1 href=#__codelineno-122-1></a><span class=c1># Search for errors</span>
</span><span id=__span-122-2><a id=__codelineno-122-2 name=__codelineno-122-2 href=#__codelineno-122-2></a>grep<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;error\|exception\|fail&quot;</span><span class=w> </span>logs/app.log
</span><span id=__span-122-3><a id=__codelineno-122-3 name=__codelineno-122-3 href=#__codelineno-122-3></a>
</span><span id=__span-122-4><a id=__codelineno-122-4 name=__codelineno-122-4 href=#__codelineno-122-4></a><span class=c1># Monitor logs in real-time</span>
</span><span id=__span-122-5><a id=__codelineno-122-5 name=__codelineno-122-5 href=#__codelineno-122-5></a>tail<span class=w> </span>-f<span class=w> </span>logs/app.log<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;oauth\|mcp&quot;</span>
</span><span id=__span-122-6><a id=__codelineno-122-6 name=__codelineno-122-6 href=#__codelineno-122-6></a>
</span><span id=__span-122-7><a id=__codelineno-122-7 name=__codelineno-122-7 href=#__codelineno-122-7></a><span class=c1># Analyze request patterns</span>
</span><span id=__span-122-8><a id=__codelineno-122-8 name=__codelineno-122-8 href=#__codelineno-122-8></a>awk<span class=w> </span><span class=s1>&#39;{print $1}&#39;</span><span class=w> </span>access.log<span class=w> </span><span class=p>|</span><span class=w> </span>sort<span class=w> </span><span class=p>|</span><span class=w> </span>uniq<span class=w> </span>-c<span class=w> </span><span class=p>|</span><span class=w> </span>sort<span class=w> </span>-nr
</span><span id=__span-122-9><a id=__codelineno-122-9 name=__codelineno-122-9 href=#__codelineno-122-9></a>
</span><span id=__span-122-10><a id=__codelineno-122-10 name=__codelineno-122-10 href=#__codelineno-122-10></a><span class=c1># Check response times</span>
</span><span id=__span-122-11><a id=__codelineno-122-11 name=__codelineno-122-11 href=#__codelineno-122-11></a>awk<span class=w> </span><span class=s1>&#39;{if($NF &gt; 1000) print $0}&#39;</span><span class=w> </span>access.log
</span></code></pre></div></p> <p><strong>Testing Commands:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-123-1><a id=__codelineno-123-1 name=__codelineno-123-1 href=#__codelineno-123-1></a><span class=c1># Test OAuth flow</span>
</span><span id=__span-123-2><a id=__codelineno-123-2 name=__codelineno-123-2 href=#__codelineno-123-2></a>curl<span class=w> </span>-X<span class=w> </span>POST<span class=w> </span>http://localhost:3000/api/oauth/register<span class=w> </span><span class=se>\</span>
</span><span id=__span-123-3><a id=__codelineno-123-3 name=__codelineno-123-3 href=#__codelineno-123-3></a><span class=w>  </span>-H<span class=w> </span><span class=s2>&quot;Content-Type: application/json&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-123-4><a id=__codelineno-123-4 name=__codelineno-123-4 href=#__codelineno-123-4></a><span class=w>  </span>-d<span class=w> </span><span class=s1>&#39;{&quot;name&quot;:&quot;Test Client&quot;,&quot;redirectUris&quot;:[&quot;http://localhost:8080/callback&quot;]}&#39;</span>
</span><span id=__span-123-5><a id=__codelineno-123-5 name=__codelineno-123-5 href=#__codelineno-123-5></a>
</span><span id=__span-123-6><a id=__codelineno-123-6 name=__codelineno-123-6 href=#__codelineno-123-6></a><span class=c1># Test MCP authentication</span>
</span><span id=__span-123-7><a id=__codelineno-123-7 name=__codelineno-123-7 href=#__codelineno-123-7></a>curl<span class=w> </span>-X<span class=w> </span>POST<span class=w> </span>http://localhost:3000/mcp/sse<span class=w> </span><span class=se>\</span>
</span><span id=__span-123-8><a id=__codelineno-123-8 name=__codelineno-123-8 href=#__codelineno-123-8></a><span class=w>  </span>-H<span class=w> </span><span class=s2>&quot;Authorization: Bearer your-token&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-123-9><a id=__codelineno-123-9 name=__codelineno-123-9 href=#__codelineno-123-9></a><span class=w>  </span>-H<span class=w> </span><span class=s2>&quot;Content-Type: application/json&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-123-10><a id=__codelineno-123-10 name=__codelineno-123-10 href=#__codelineno-123-10></a><span class=w>  </span>-d<span class=w> </span><span class=s1>&#39;{&quot;method&quot;:&quot;tools/list&quot;,&quot;params&quot;:{}}&#39;</span>
</span><span id=__span-123-11><a id=__codelineno-123-11 name=__codelineno-123-11 href=#__codelineno-123-11></a>
</span><span id=__span-123-12><a id=__codelineno-123-12 name=__codelineno-123-12 href=#__codelineno-123-12></a><span class=c1># Test database queries</span>
</span><span id=__span-123-13><a id=__codelineno-123-13 name=__codelineno-123-13 href=#__codelineno-123-13></a>psql<span class=w> </span><span class=nv>$DATABASE_URL</span><span class=w> </span>-c<span class=w> </span><span class=s2>&quot;SELECT COUNT(*) FROM \&quot;User\&quot;;&quot;</span>
</span></code></pre></div></p> <hr> <h2 id=quick-reference>Quick Reference<a class=headerlink href=#quick-reference title="Permanent link">&para;</a></h2> <h3 id=common-error-codes>Common Error Codes<a class=headerlink href=#common-error-codes title="Permanent link">&para;</a></h3> <ul> <li><code>invalid_client</code>: OAuth client not found or invalid credentials</li> <li><code>invalid_grant</code>: Authorization code or refresh token invalid</li> <li><code>unsupported_grant_type</code>: Grant type not supported</li> <li><code>rate_limit_exceeded</code>: Too many requests</li> <li><code>server_error</code>: Internal server error</li> </ul> <h3 id=important-log-locations>Important Log Locations<a class=headerlink href=#important-log-locations title="Permanent link">&para;</a></h3> <ul> <li>Application logs: <code>console.log</code> output</li> <li>Database logs: PostgreSQL logs</li> <li>OAuth flows: API route console output</li> <li>MCP requests: MCP handler debug logs</li> <li>Security events: Analytics security table</li> </ul> <h3 id=emergency-procedures>Emergency Procedures<a class=headerlink href=#emergency-procedures title="Permanent link">&para;</a></h3> <ol> <li><strong>Database Issues</strong>: Check PostgreSQL service, connection string, schema sync</li> <li><strong>Authentication Failures</strong>: Verify OAuth configuration, check token validity</li> <li><strong>Performance Problems</strong>: Monitor CPU/memory, check database queries</li> <li><strong>Security Events</strong>: Review security logs, check for attacks</li> <li><strong>Deployment Issues</strong>: Verify environment variables, test connectivity</li> </ol> <h3 id=support-resources>Support Resources<a class=headerlink href=#support-resources title="Permanent link">&para;</a></h3> <ul> <li>PostgreSQL Documentation: <a href=https://www.postgresql.org/docs/ >https://www.postgresql.org/docs/</a></li> <li>NextAuth.js Guide: <a href=https://next-auth.js.org/ >https://next-auth.js.org/</a></li> <li>Prisma Documentation: <a href=https://www.prisma.io/docs/ >https://www.prisma.io/docs/</a></li> <li>OAuth 2.1 Specification: <a href=https://tools.ietf.org/html/draft-ietf-oauth-v2-1>https://tools.ietf.org/html/draft-ietf-oauth-v2-1</a></li> <li>MCP Specification: <a href=https://modelcontextprotocol.io/ >https://modelcontextprotocol.io/</a></li> </ul> <p>This troubleshooting guide should be regularly updated as new issues are discovered and resolved in the MCP OAuth server implementation.</p> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../development/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Development"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Development </div> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024 raxIT AI – <a href=#__consent>Change cookie settings</a> </div> </div> <div class=md-social> <a href=https://github.com/raxITai/mcp-oauth-sample target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://www.linkedin.com/company/raxit-ai target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> <a href=https://x.com/raxit_ai target=_blank rel=noopener title=x.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9zm-24.8 373.8h39.1L151.1 88h-42z"/></svg> </a> <a href=https://bsky.app/profile/raxit.ai target=_blank rel=noopener title=bsky.app class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M111.8 62.2C170.2 105.9 233 194.7 256 242.4c23-47.6 85.8-136.4 144.2-180.2 42.1-31.6 110.3-56 110.3 21.8 0 15.5-8.9 130.5-14.1 149.2-18.2 64.8-84.4 81.4-143.3 71.3C456 322 482.2 380 425.6 438c-107.4 110.2-154.3-27.6-166.3-62.9-1.7-4.9-2.6-7.8-3.3-7.8s-1.6 3-3.3 7.8c-12 35.3-59 173.1-166.3 62.9-56.5-58-30.4-116 72.5-133.5C100 314.6 33.8 298 15.7 233.1 10.4 214.4 1.5 99.4 1.5 83.9c0-77.8 68.2-53.4 110.3-21.8z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"base": "..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "content.tabs.link", "content.tooltips", "header.autohide", "navigation.expand", "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.prune", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow", "toc.integrate"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../assets/javascripts/bundle.56ea9cef.min.js></script> <script src=../javascripts/mathjax.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>